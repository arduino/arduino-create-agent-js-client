!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tty"),require("util"),require("os"),require("fs"),require("url"),require("child_process"),require("http"),require("https"),require("events"),require("crypto"),require("net"),require("tls"),require("zlib"),require("bufferutil"),require("stream"),require("utf-8-validate")):"function"==typeof define&&define.amd?define(["exports","tty","util","os","fs","url","child_process","http","https","events","crypto","net","tls","zlib","bufferutil","stream","utf-8-validate"],t):t((e=e||self).CreatePlugin={},e.tty,e.util,e.os,e.fs,e.url$1,e.child_process,e.http,e.https,e.events,e.crypto,e.net,e.tls,e.zlib,e.bufferutil,e.stream,e.utf8Validate)}(this,function(e,t,n,r,s,o,i,a,c,u,h,l,p,f,d,y,m){"use strict";function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){O(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;t.length>n;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t,n){return t&&_(e.prototype,t),n&&_(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S(e,t)}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=k(e);if(t){var s=k(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return x(this,n)}}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,s,o=[],i=!0,a=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){a=!0,s=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw s}}return o}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=[];t>n;n++)r[n]=e[n];return r}t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r,s=s&&s.hasOwnProperty("default")?s.default:s,o=o&&o.hasOwnProperty("default")?o.default:o,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,c=c&&c.hasOwnProperty("default")?c.default:c,u=u&&u.hasOwnProperty("default")?u.default:u,h=h&&h.hasOwnProperty("default")?h.default:h,l=l&&l.hasOwnProperty("default")?l.default:l,p=p&&p.hasOwnProperty("default")?p.default:p,f=f&&f.hasOwnProperty("default")?f.default:f,d=d&&d.hasOwnProperty("default")?d.default:d,y=y&&y.hasOwnProperty("default")?y.default:y,m=m&&m.hasOwnProperty("default")?m.default:m;var N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function D(e,t){return e(t={exports:{}},t.exports),t.exports}var L=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,F=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],B=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var s=L.exec(e||""),o={},i=14;i--;)o[F[i]]=s[i]||"";return-1!=n&&-1!=r&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o},M=1e3,I=60*M,U=60*I,j=24*U,q=7*j,W=365.25*j,V=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e+="").length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*W;case"weeks":case"week":case"w":return n*q;case"days":case"day":case"d":return n*j;case"hours":case"hour":case"hrs":case"hr":case"h":return n*U;case"minutes":case"minute":case"mins":case"min":case"m":return n*I;case"seconds":case"second":case"secs":case"sec":case"s":return n*M;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=j)return $(e,t,j,"day");if(t>=U)return $(e,t,U,"hour");if(t>=I)return $(e,t,I,"minute");if(t>=M)return $(e,t,M,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=j)return Math.round(e/j)+"d";if(t>=U)return Math.round(e/U)+"h";if(t>=I)return Math.round(e/I)+"m";if(t>=M)return Math.round(e/M)+"s";return e+"ms"}(e);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function $(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}var G=function(e){function t(e){let t=0;for(let n=0;e.length>n;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let o;function i(...e){if(!i.enabled)return;const t=i,r=+new Date;t.diff=r-(o||r),t.prev=o,t.curr=r,o=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;s++;const i=n.formatters[o];return"function"==typeof i&&(r=i.call(t,e[s]),e.splice(s,1),s--),r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=t(e),i.destroy=r,i.extend=s,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function r(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function s(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function o(e){return(""+e).substring(2,(""+e).length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){const e=[...n.names.map(o),...n.skips.map(o).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(t=0;s>t;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(RegExp("^"+e.substr(1)+"$")):n.names.push(RegExp("^"+e+"$")));for(t=0;n.instances.length>t;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;r>t;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;r>t;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=V,Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},H=D(function(e,t){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))}),t.splice(s,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=G(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}),z=(e,t)=>{t=t||process.argv;const n=e.startsWith("-")?"":1===e.length?"-":"--",r=t.indexOf(n+e),s=t.indexOf("--");return-1!==r&&(-1===s||s>r)};const Y=process.env;let X;function J(e){return function(e){return 0!==e&&{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}(function(e){if(!1===X)return 0;if(z("color=16m")||z("color=full")||z("color=truecolor"))return 3;if(z("color=256"))return 2;if(e&&!e.isTTY&&!0!==X)return 0;const t=X?1:0;if("win32"===process.platform){const e=r.release().split(".");return 8>+process.versions.node.split(".")[0]||10>+e[0]||10586>+e[2]?1:14931>+e[2]?2:3}if("CI"in Y)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(e=>e in Y)||"codeship"===Y.CI_NAME?1:t;if("TEAMCITY_VERSION"in Y)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Y.TEAMCITY_VERSION)?1:0;if("truecolor"===Y.COLORTERM)return 3;if("TERM_PROGRAM"in Y){const e=parseInt((Y.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Y.TERM_PROGRAM){case"iTerm.app":return 3>e?2:3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Y.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Y.TERM)?1:"COLORTERM"in Y?1:t}(e))}z("no-color")||z("no-colors")||z("color=false")?X=!1:(z("color")||z("colors")||z("color=true")||z("color=always"))&&(X=!0),"FORCE_COLOR"in Y&&(X=0===Y.FORCE_COLOR.length||0!==parseInt(Y.FORCE_COLOR,10));var K={supportsColor:J,stdout:J(process.stdout),stderr:J(process.stderr)},Q=D(function(e,r){r.init=function(e){e.inspectOpts={};const t=Object.keys(r.inspectOpts);for(let n=0;t.length>n;n++)e.inspectOpts[t[n]]=r.inspectOpts[t[n]]},r.log=function(...e){return process.stderr.write(n.format(...e)+"\n")},r.formatArgs=function(t){const{namespace:n,useColors:s}=this;if(s){const r=this.color,s="[3"+(8>r?r:"8;5;"+r),o=`  ${s};1m${n} [0m`;t[0]=o+t[0].split("\n").join("\n"+o),t.push(s+"m+"+e.exports.humanize(this.diff)+"[0m")}else t[0]=function(){if(r.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+n+" "+t[0]},r.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},r.load=function(){return process.env.DEBUG},r.useColors=function(){return"colors"in r.inspectOpts?!!r.inspectOpts.colors:t.isatty(process.stderr.fd)},r.colors=[6,2,3,4,5,1];try{const e=K;e&&(e.stderr||e).level>=2&&(r.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}r.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{const n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(e,t)=>t.toUpperCase());let r=process.env[t];return e[n]=r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:+r),e},{}),e.exports=G(r);const{formatters:s}=e.exports;s.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).replace(/\s*\n\s*/g," ")},s.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)}}),Z=D(function(e){e.exports="undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?H:Q}),ee=Z("socket.io-client:url"),te=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(ee("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),ee("parse %s",e),n=B(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n};var ne=1e3,re=60*ne,se=60*re,oe=24*se,ie=365.25*oe,ae=function(e,t){t=t||{};var n,r=typeof e;if("string"===r&&e.length>0)return function(e){if((e+="").length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*ie;case"days":case"day":case"d":return n*oe;case"hours":case"hour":case"hrs":case"hr":case"h":return n*se;case"minutes":case"minute":case"mins":case"min":case"m":return n*re;case"seconds":case"second":case"secs":case"sec":case"s":return n*ne;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===r&&!1===isNaN(e))return t.long?ce(n=e,oe,"day")||ce(n,se,"hour")||ce(n,re,"minute")||ce(n,ne,"second")||n+" ms":function(e){if(e>=oe)return Math.round(e/oe)+"d";if(e>=se)return Math.round(e/se)+"h";if(e>=re)return Math.round(e/re)+"m";if(e>=ne)return Math.round(e/ne)+"s";return e+"ms"}(e);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function ce(e,t,n){if(e>=t)return 1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var ue=D(function(e,t){function n(e){var n;function s(){if(s.enabled){var e=s,r=+new Date;e.diff=r-(n||r),e.prev=n,e.curr=r,n=r;for(var o=[],i=0;o.length>i;i++)o[i]=arguments[i];o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;a++;var s=t.formatters[r];"function"==typeof s&&(n=s.call(e,o[a]),o.splice(a,1),a--);return n}),t.formatArgs.call(e,o),(s.log||t.log||console.log.bind(console)).apply(e,o)}}return s.namespace=e,s.enabled=t.enabled(e),s.useColors=t.useColors(),s.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),s.destroy=r,"function"==typeof t.init&&t.init(s),t.instances.push(s),s}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),s=r.length;for(n=0;s>n;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(RegExp("^"+e.substr(1)+"$")):t.names.push(RegExp("^"+e+"$")));for(n=0;t.instances.length>n;n++){var o=t.instances[n];o.enabled=t.enabled(o.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;r>n;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;r>n;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=ae,t.instances=[],t.names=[],t.skips=[],t.formatters={}}),he=D(function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=ue).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var s=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(s++,"%c"===e&&(o=s))}),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}),le=D(function(e,r){(r=e.exports=ue).init=function(e){e.inspectOpts={};for(var t=Object.keys(r.inspectOpts),n=0;t.length>n;n++)e.inspectOpts[t[n]]=r.inspectOpts[t[n]]},r.log=function(){return process.stderr.write(n.format.apply(n,arguments)+"\n")},r.formatArgs=function(e){var t=this.namespace;if(this.useColors){var n=this.color,s="[3"+(8>n?n:"8;5;"+n),o="  "+s+";1m"+t+" [0m";e[0]=o+e[0].split("\n").join("\n"+o),e.push(s+"m+"+r.humanize(this.diff)+"[0m")}else e[0]=(r.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+t+" "+e[0]},r.save=function(e){null==e?delete process.env.DEBUG:process.env.DEBUG=e},r.load=s,r.useColors=function(){return"colors"in r.inspectOpts?!!r.inspectOpts.colors:t.isatty(process.stderr.fd)},r.colors=[6,2,3,4,5,1];try{K&&K.level>=2&&(r.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}function s(){return process.env.DEBUG}r.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var n=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()}),r=process.env[t];return e[n]=r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:+r),e},{}),r.formatters.o=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts).split("\n").map(function(e){return e.trim()}).join(" ")},r.formatters.O=function(e){return this.inspectOpts.colors=this.useColors,n.inspect(e,this.inspectOpts)},r.enable(s())}),pe=D(function(e){e.exports="undefined"==typeof process||"renderer"===process.type?he:le}),fe=D(function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;r.length>s;s++)if((n=r[s])===t||n.fn===t){r.splice(s,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=[],n=this._callbacks["$"+e],r=1;arguments.length>r;r++)t[r-1]=arguments[r];if(n){r=0;for(var s=(n=n.slice(0)).length;s>r;++r)n[r].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),de={}.toString,ye=Array.isArray||function(e){return"[object Array]"==de.call(e)},me=function(e){return ge&&Buffer.isBuffer(e)||be&&(e instanceof ArrayBuffer||ve(e))},ge="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,be="function"==typeof ArrayBuffer,ve=function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer};var _e=Object.prototype.toString,we="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===_e.call(Blob),Oe="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===_e.call(File);var Ee={deconstructPacket:function(e){var t=[],n=e;return n.data=function e(t,n){if(!t)return t;if(me(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(ye(t)){for(var s=[],o=0;t.length>o;o++)s[o]=e(t[o],n);return s}if("object"==typeof t&&!(t instanceof Date)){var s={};for(var i in t)s[i]=e(t[i],n);return s}return t}(e.data,t),n.attachments=t.length,{packet:n,buffers:t}},reconstructPacket:function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(ye(t))for(var r=0;t.length>r;r++)t[r]=e(t[r],n);else if("object"==typeof t)for(var s in t)t[s]=e(t[s],n);return t}(e.data,t),e.attachments=void 0,e},removeBlobs:function(e,t){var n=0,r=e;!function e(s,o,i){if(!s)return s;if(we&&s instanceof Blob||Oe&&s instanceof File){n++;var a=new FileReader;a.onload=function(){i?i[o]=this.result:r=this.result,--n||t(r)},a.readAsArrayBuffer(s)}else if(ye(s))for(var c=0;s.length>c;c++)e(s[c],c,s);else if("object"==typeof s&&!me(s))for(var u in s)e(s[u],u,s)}(r),n||t(r)}},ke=D(function(e,t){var n=pe("socket.io-parser");function r(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=i;var s=t.ERROR+'"encode error"';function o(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var o=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===o)return s;r+=o}return n("encoded %j as %s",e,r),r}function i(){this.reconstructor=null}function a(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}r.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){Ee.removeBlobs(e,function(e){var n=Ee.deconstructPacket(e),r=o(n.packet),s=n.buffers;s.unshift(r),t(s)})}(e,r):r([o(e)])},fe(i.prototype),i.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,s={type:+e.charAt(0)};if(null==t.types[s.type])return c("unknown packet type "+s.type);if(t.BINARY_EVENT===s.type||t.BINARY_ACK===s.type){for(var o=r+1;"-"!==e.charAt(++r)&&r!=e.length;);var i=e.substring(o,r);if(i!=+i||"-"!==e.charAt(r))throw Error("Illegal attachments");s.attachments=+i}if("/"===e.charAt(r+1)){for(var o=r+1;++r;){var a=e.charAt(r);if(","===a)break;if(r===e.length)break}s.nsp=e.substring(o,r)}else s.nsp="/";var u=e.charAt(r+1);if(""!==u&&+u==u){for(var o=r+1;++r;){var a=e.charAt(r);if(null==a||+a!=a){--r;break}if(r===e.length)break}s.id=+e.substring(o,r+1)}if(e.charAt(++r)){var h=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r)),l=!1!==h&&(s.type===t.ERROR||ye(h));if(!l)return c("invalid payload");s.data=h}return n("decoded %s as %j",e,s),s}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new a(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!me(e)&&!e.base64)throw Error("Unknown type: "+e);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},i.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=Ee.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}),Se=i.spawn,xe=Ce;function Ce(e){e=e||{};var t,n,r=this,i=a,u=c,h={},l=!1,p={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},f=Object.assign({},p),d=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],y=["TRACE","TRACK","CONNECT"],m=!1,g=!1,b={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;this.open=function(e,t,n,r,s){if(this.abort(),g=!1,!function(e){return e&&-1===y.indexOf(e)}(e))throw"SecurityError: Request method not allowed";h={method:e,url:""+t,async:"boolean"!=typeof n||n,user:r||null,password:s||null},v(this.OPENED)},this.setDisableHeaderCheck=function(e){l=e},this.setRequestHeader=function(e,t){if(this.readyState!=this.OPENED)throw"INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN";if(!function(e){return l||e&&-1===d.indexOf(e.toLowerCase())}(e))return console.warn('Refused to set unsafe header "'+e+'"'),!1;if(m)throw"INVALID_STATE_ERR: send flag is true";return f[e]=t,!0},this.getResponseHeader=function(e){return"string"==typeof e&&this.readyState>this.OPENED&&n.headers[e.toLowerCase()]&&!g?n.headers[e.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.HEADERS_RECEIVED>this.readyState||g)return"";var e="";for(var t in n.headers)"set-cookie"!==t&&"set-cookie2"!==t&&(e+=t+": "+n.headers[t]+"\r\n");return e.substr(0,e.length-2)},this.getRequestHeader=function(e){return"string"==typeof e&&f[e]?f[e]:""},this.send=function(a){if(this.readyState!=this.OPENED)throw"INVALID_STATE_ERR: connection must be opened before send() is called";if(m)throw"INVALID_STATE_ERR: send has already been called";var c,l=!1,p=!1,d=o.parse(h.url);switch(d.protocol){case"https:":l=!0;case"http:":c=d.hostname;break;case"file:":p=!0;break;case void 0:case"":c="localhost";break;default:throw"Protocol not supported."}if(p){if("GET"!==h.method)throw"XMLHttpRequest: Only GET method is supported";if(h.async)s.readFile(d.pathname,"utf8",function(e,t){e?r.handleError(e):(r.status=200,r.responseText=t,v(r.DONE))});else try{this.responseText=s.readFileSync(d.pathname,"utf8"),this.status=200,v(r.DONE)}catch(e){this.handleError(e)}}else{var y=d.port||(l?443:80),b=d.pathname+(d.search?d.search:"");if(f.Host=c,l&&443===y||80===y||(f.Host+=":"+d.port),h.user){void 0===h.password&&(h.password="");var _=new Buffer(h.user+":"+h.password);f.Authorization="Basic "+_.toString("base64")}"GET"===h.method||"HEAD"===h.method?a=null:a?(f["Content-Length"]=Buffer.isBuffer(a)?a.length:Buffer.byteLength(a),f["Content-Type"]||(f["Content-Type"]="text/plain;charset=UTF-8")):"POST"===h.method&&(f["Content-Length"]=0);var w={host:c,port:y,path:b,method:h.method,headers:f,agent:e.agent||!1};if(l&&(w.pfx=e.pfx,w.key=e.key,w.passphrase=e.passphrase,w.cert=e.cert,w.ca=e.ca,w.ciphers=e.ciphers,w.rejectUnauthorized=e.rejectUnauthorized),g=!1,h.async){var O=l?u.request:i.request;m=!0,r.dispatchEvent("readystatechange");var E=function(s){if(302===(n=s).statusCode||303===n.statusCode||307===n.statusCode){h.url=n.headers.location;var i=o.parse(h.url);c=i.hostname;var a={hostname:i.hostname,port:i.port,path:i.path,method:303===n.statusCode?"GET":h.method,headers:f};return l&&(a.pfx=e.pfx,a.key=e.key,a.passphrase=e.passphrase,a.cert=e.cert,a.ca=e.ca,a.ciphers=e.ciphers,a.rejectUnauthorized=e.rejectUnauthorized),void(t=O(a,E).on("error",k)).end()}n&&n.setEncoding&&n.setEncoding("utf8"),v(r.HEADERS_RECEIVED),r.status=n.statusCode,n.on("data",function(e){e&&(r.responseText+=e),m&&v(r.LOADING)}),n.on("end",function(){m&&(m=!1,v(r.DONE))}),n.on("error",function(e){r.handleError(e)})},k=function(e){r.handleError(e)};t=O(w,E).on("error",k),a&&t.write(a),t.end(),r.dispatchEvent("loadstart")}else{var S=".node-xmlhttprequest-content-"+process.pid,x=".node-xmlhttprequest-sync-"+process.pid;s.writeFileSync(x,"","utf8");for(var C="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(l?"s":"")+".request;var options = "+JSON.stringify(w)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+x+"');});response.on('error', function(error) {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+x+"');});}).on('error', function(error) {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+x+"');});"+(a?"req.write('"+a.replace(/'/g,"\\'")+"');":"")+"req.end();",R=Se(process.argv[0],["-e",C]);s.existsSync(x););if(r.responseText=s.readFileSync(S,"utf8"),R.stdin.end(),s.unlinkSync(S),r.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var P=r.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");r.handleError(P)}else r.status=r.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),r.responseText=r.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),v(r.DONE)}}},this.handleError=function(e){this.status=503,this.statusText=e,this.responseText=e.stack,g=!0,v(this.DONE)},this.abort=function(){t&&(t.abort(),t=null),f=Object.assign({},p),this.responseText="",this.responseXML="",g=!0,this.readyState===this.UNSENT||this.readyState===this.OPENED&&!m||this.readyState===this.DONE||(m=!1,v(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(e,t){e in b||(b[e]=[]),b[e].push(t)},this.removeEventListener=function(e,t){e in b&&(b[e]=b[e].filter(function(e){return e!==t}))},this.dispatchEvent=function(e){if("function"==typeof r["on"+e]&&r["on"+e](),e in b)for(var t=0,n=b[e].length;n>t;t++)b[e][t].call(r)};var v=function(e){r.readyState!==e&&(r.readyState=e,(h.async||r.OPENED>r.readyState||r.readyState===r.DONE)&&r.dispatchEvent("readystatechange"),r.readyState!==r.DONE||g||(r.dispatchEvent("load"),r.dispatchEvent("loadend")))}}Ce.XMLHttpRequest=Ce;var Re,Pe,Ae,Te=String.fromCharCode;function Ne(e){for(var t,n,r=[],s=0,o=e.length;o>s;)55296>(t=e.charCodeAt(s++))||t>56319||s>=o?r.push(t):56320==(64512&(n=e.charCodeAt(s++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),s--);return r}function De(e,t){if(e>=55296&&57343>=e){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Le(e,t){return Te(e>>t&63|128)}function Fe(e,t){if(0==(4294967168&e))return Te(e);var n="";return 0==(4294965248&e)?n=Te(e>>6&31|192):0==(4294901760&e)?(De(e,t)||(e=65533),n=Te(e>>12&15|224),n+=Le(e,6)):0==(4292870144&e)&&(n=Te(e>>18&7|240),n+=Le(e,12),n+=Le(e,6)),n+=Te(63&e|128)}function Be(){if(Ae>=Pe)throw Error("Invalid byte index");var e=255&Re[Ae];if(Ae++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function Me(e){var t,n;if(Ae>Pe)throw Error("Invalid byte index");if(Ae==Pe)return!1;if(t=255&Re[Ae],Ae++,0==(128&t))return t;if(192==(224&t)){if(128>(n=(31&t)<<6|Be()))throw Error("Invalid continuation byte");return n}if(224==(240&t)){if(2048>(n=(15&t)<<12|Be()<<6|Be()))throw Error("Invalid continuation byte");return De(n,e)?n:65533}if(240==(248&t)&&(n=(7&t)<<18|Be()<<12|Be()<<6|Be())>=65536&&1114111>=n)return n;throw Error("Invalid UTF-8 detected")}var Ie={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=Ne(e),s=r.length,o=-1,i="";++o<s;)i+=Fe(r[o],n);return i},decode:function(e,t){var n=!1!==(t=t||{}).strict;Re=Ne(e),Pe=Re.length,Ae=0;for(var r,s=[];!1!==(r=Me(n));)s.push(r);return function(e){for(var t,n=e.length,r=-1,s="";++r<n;)(t=e[r])>65535&&(s+=Te((t-=65536)>>>10&1023|55296),t=56320|1023&t),s+=Te(t);return s}(s)}},Ue={}.toString,je=Array.isArray||function(e){return"[object Array]"==Ue.call(e)},qe=Object.prototype.toString,We="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===qe.call(Blob),Ve="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===qe.call(File),$e=function e(t){if(!t||"object"!=typeof t)return!1;if(je(t)){for(var n=0,r=t.length;r>n;n++)if(e(t[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||We&&t instanceof Blob||Ve&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s]))return!0;return!1};var Ge=function(e,t,n){var r=!1;return n=n||He,s.count=e,0===e?t():s;function s(e,o){if(0>=s.count)throw Error("after called too many times");--s.count,e?(r=!0,t(e),t=n):0!==s.count||r||t(null,o)}};function He(){}var ze=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t},Ye=D(function(e,t){t.protocol=3;var n=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=ze(n),s={type:"error",data:"parser error"};const o=Buffer.concat([]);function i(e,r,s){if(!r)return t.encodeBase64Packet(e,s);var o=e.data,i=Buffer.allocUnsafe(1);return i[0]=n[e.type],s(Buffer.concat([i,o]))}function a(e,t,n){for(var r=[],s=Ge(e.length,n),o=0;e.length>o;o++)t(e[o],function(e,t){r[o]=t,s(e,r)})}function c(e){for(var t="",n=0,r=e.length;r>n;n++)t+=String.fromCharCode(e[n]);return t}function u(e){for(var t=Buffer.allocUnsafe(e.length),n=0,r=e.length;r>n;n++)t.writeUInt8(e.charCodeAt(n),n);return t}function h(e){return Buffer.from(e.buffer||e,e.byteOffset||0,e.byteLength||e.length)}function l(e,n){t.encodePacket(e,!0,!0,function(e){var t,r=""+e.length;if("string"==typeof e){(t=Buffer.allocUnsafe(r.length+2))[0]=0;for(var s=0;r.length>s;s++)t[s+1]=parseInt(r[s],10);return t[t.length-1]=255,n(null,Buffer.concat([t,u(e)]))}for((t=Buffer.allocUnsafe(r.length+2))[0]=1,s=0;r.length>s;s++)t[s+1]=parseInt(r[s],10);t[t.length-1]=255,n(null,Buffer.concat([t,e]))})}t.encodePacket=function(e,t,r,s){if("function"==typeof t&&(s=t,t=null),"function"==typeof r&&(s=r,r=null),Buffer.isBuffer(e.data))return i(e,t,s);if(e.data&&(e.data.buffer||e.data)instanceof ArrayBuffer)return i({type:e.type,data:h(e.data)},t,s);var o=n[e.type];return void 0!==e.data&&(o+=r?Ie.encode(e.data+"",{strict:!1}):e.data+""),s(""+o)},t.encodeBase64Packet=function(e,t){var r=Buffer.isBuffer(e.data)?e.data:h(e.data),s="b"+n[e.type];return t(s+=r.toString("base64"))},t.decodePacket=function(e,n,o){if(void 0===e)return s;var i;if("string"==typeof e)return"b"===(i=e.charAt(0))?t.decodeBase64Packet(e.substr(1),n):o&&!1===(e=function(e){try{e=Ie.decode(e,{strict:!1})}catch(e){return!1}return e}(e))?s:+i==i&&r[i]?e.length>1?{type:r[i],data:e.substring(1)}:{type:r[i]}:s;if("arraybuffer"===n){var a=new Uint8Array(e);return{type:r[i=a[0]],data:a.buffer.slice(1)}}return e instanceof ArrayBuffer&&(e=h(e)),{type:r[i=e[0]],data:e.slice(1)}},t.decodeBase64Packet=function(e,t){var n=r[e.charAt(0)],s=Buffer.from(e.substr(1),"base64");if("arraybuffer"===t){for(var o=new Uint8Array(s.length),i=0;o.length>i;i++)o[i]=s[i];s=o.buffer}return{type:n,data:s}},t.encodePayload=function(e,n,r){if("function"==typeof n&&(r=n,n=null),n&&$e(e))return t.encodePayloadAsBinary(e,r);if(!e.length)return r("0:");a(e,function(e,r){t.encodePacket(e,n,!1,function(e){r(null,function(e){return e.length+":"+e}(e))})},function(e,t){return r(t.join(""))})},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);if("function"==typeof n&&(r=n,n=null),""===e)return r(s,0,1);for(var o,i,a,c="",u=0,h=e.length;h>u;u++){var l=e.charAt(u);if(":"===l){if(""===c||c!=(o=+c))return r(s,0,1);if(c!=(i=e.substr(u+1,o)).length)return r(s,0,1);if(i.length){if(a=t.decodePacket(i,n,!1),s.type===a.type&&s.data===a.data)return r(s,0,1);if(!1===r(a,u+o,h))return}u+=o,c=""}else c+=l}return""!==c?r(s,0,1):void 0},t.encodePayloadAsBinary=function(e,t){if(!e.length)return t(o);a(e,l,function(e,n){return t(Buffer.concat(n))})},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var o,i=e,a=[];i.length>0;){var u="",h=0===i[0];for(o=1;255!==i[o];o++){if(u.length>310)return r(s,0,1);u+=""+i[o]}i=i.slice(u.length+1);var l=parseInt(u,10),p=i.slice(1,l+1);h&&(p=c(p)),a.push(p),i=i.slice(l+1)}var f=a.length;for(o=0;f>o;o++){r(t.decodePacket(a[o],n,!0),o,f)}}}),Xe=D(function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;r.length>s;s++)if((n=r[s])===t||n.fn===t){r.splice(s,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=[],n=this._callbacks["$"+e],r=1;arguments.length>r;r++)t[r-1]=arguments[r];if(n){r=0;for(var s=(n=n.slice(0)).length;s>r;++r)n[r].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),Je=Ke;function Ke(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}Xe(Ke.prototype),Ke.prototype.onError=function(e,t){var n=Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},Ke.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Ke.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Ke.prototype.send=function(e){if("open"!==this.readyState)throw Error("Transport not open");this.write(e)},Ke.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Ke.prototype.onData=function(e){var t=Ye.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Ke.prototype.onPacket=function(e){this.emit("packet",e)},Ke.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var Qe,Ze={encode:function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},decode:function(e){for(var t={},n=e.split("&"),r=0,s=n.length;s>r;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},et=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},tt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),nt=64,rt={},st=0,ot=0;function it(e){var t="";do{t=tt[e%nt]+t,e=Math.floor(e/nt)}while(e>0);return t}function at(){var e=it(+new Date);return e!==Qe?(st=0,Qe=e):e+"."+it(st++)}for(;nt>ot;ot++)rt[tt[ot]]=ot;at.encode=it,at.decode=function(e){var t=0;for(ot=0;e.length>ot;ot++)t=t*nt+rt[e.charAt(ot)];return t};var ct=at,ut=pe("engine.io-client:polling"),ht=pt,lt=null!=new xe({xdomain:!1}).responseType;function pt(e){lt&&!(e&&e.forceBase64)||(this.supportsBinary=!1),Je.call(this,e)}et(pt,Je),pt.prototype.name="polling",pt.prototype.doOpen=function(){this.poll()},pt.prototype.pause=function(e){var t=this;function n(){ut("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(ut("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){ut("pre-pause polling complete"),--r||n()})),this.writable||(ut("we are currently writing - waiting to pause"),r++,this.once("drain",function(){ut("pre-pause writing complete"),--r||n()}))}else n()},pt.prototype.poll=function(){ut("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},pt.prototype.onData=function(e){var t=this;ut("polling got data %s",e);Ye.decodePayload(e,this.socket.binaryType,function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():ut('ignoring poll - transport state "%s"',this.readyState))},pt.prototype.doClose=function(){var e=this;function t(){ut("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(ut("transport open - closing"),t()):(ut("transport not open - deferring close"),this.once("open",t))},pt.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};Ye.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},pt.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=ct()),this.supportsBinary||e.sid||(e.b64=1),e=Ze.encode(e),this.port&&("https"===t&&443!=+this.port||"http"===t&&80!=+this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var ft=N,dt=pe("engine.io-client:polling-xhr"),yt=bt,mt=vt;function gt(){}function bt(e){if(ht.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function vt(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(et(bt,ht),bt.prototype.supportsBinary=!0,bt.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new vt(e)},bt.prototype.doWrite=function(e,t){var n=this.request({method:"POST",data:e,isBinary:"string"!=typeof e&&void 0!==e}),r=this;n.on("success",t),n.on("error",function(e){r.onError("xhr post error",e)}),this.sendXhr=n},bt.prototype.doPoll=function(){dt("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},Xe(vt.prototype),vt.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new xe(e),n=this;try{dt("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{t.setRequestHeader("Content-type",this.isBinary?"application/octet-stream":"text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout(function(){n.onError("number"==typeof t.status?t.status:0)},0))},dt("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout(function(){n.onError(e)},0)}"undefined"!=typeof document&&(this.index=vt.requestsCount++,vt.requests[this.index]=this)},vt.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},vt.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},vt.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},vt.prototype.cleanup=function(e){if(null!=this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=gt:this.xhr.onreadystatechange=gt,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete vt.requests[this.index],this.xhr=null}},vt.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},vt.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},vt.prototype.abort=function(){this.cleanup()},vt.requestsCount=0,vt.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",_t);else if("function"==typeof addEventListener){addEventListener("onpagehide"in ft?"pagehide":"unload",_t,!1)}function _t(){for(var e in vt.requests)vt.requests.hasOwnProperty(e)&&vt.requests[e].abort()}yt.Request=mt;var wt,Ot=xt,Et=/\n/g,kt=/\\n/g;function St(){}function xt(e){ht.call(this,e),this.query=this.query||{},wt||(wt=ft.___eio=ft.___eio||[]),this.index=wt.length;var t=this;wt.push(function(e){t.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=St)},!1)}function Ct(e){if(!(this instanceof Ct))return new Ct(e);this.concurrency=(e=e||{}).concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=function(){this.pending--,this._run()}.bind(this)}et(xt,ht),xt.prototype.supportsBinary=!1,xt.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),ht.prototype.doClose.call(this)},xt.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},xt.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,s=document.createElement("form"),o=document.createElement("textarea"),i=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=i,s.method="POST",s.setAttribute("accept-charset","utf-8"),o.name="d",s.appendChild(o),document.body.appendChild(s),this.form=s,this.area=o}function a(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{r=document.createElement('<iframe src="javascript:0" name="'+n.iframeId+'">')}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),e=e.replace(kt,"\\\n"),this.area.value=e.replace(Et,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};["push","unshift","splice"].forEach(function(e){Ct.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this._run(),t}}),Object.defineProperty(Ct.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),Ct.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var e=this.jobs.shift();this.pending++,e(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var t=this.cbs.pop();process.nextTick(t)}}},Ct.prototype.onDone=function(e){"function"==typeof e&&(this.cbs.push(e),this._run())};var Rt=Ct,Pt=D(function(e){function t(e,t){const n=Buffer.allocUnsafe(t);for(var r=0,s=0;e.length>s;s++){const t=e[s];t.copy(n,r),r+=t.length}return n}function n(e,t,n,r,s){for(var o=0;s>o;o++)n[r+o]=e[o]^t[3&o]}function r(e,t){const n=e.length;for(var r=0;n>r;r++)e[r]^=t[3&r]}try{const s=d,o=s.BufferUtil||s;e.exports={mask(e,t,r,s,i){48>i?n(e,t,r,s,i):o.mask(e,t,r,s,i)},unmask(e,t){32>e.length?r(e,t):o.unmask(e,t)},concat:t}}catch(s){e.exports={concat:t,mask:n,unmask:r}}}),At={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}};const{kStatusCode:Tt,NOOP:Nt}=At,Dt=Buffer.from([0,0,255,255]),Lt=Buffer.from([0]),Ft=Symbol("permessage-deflate"),Bt=Symbol("total-length"),Mt=Symbol("callback"),It=Symbol("buffers"),Ut=Symbol("error");let jt;var qt=class{constructor(e,t,n){this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,jt||(jt=new Rt({concurrency:void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10}))}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){const t=this._options,n=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!n)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{var n=e[t];if(n.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){const e=+n;if(!Number.isInteger(e)||8>e||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){const e=+n;if(!Number.isInteger(e)||8>e||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw Error(`Unknown parameter "${t}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}e[t]=n})}),e}decompress(e,t,n){jt.push(r=>{this._decompress(e,t,(e,t)=>{r(),n(e,t)})})}compress(e,t,n){jt.push(r=>{this._compress(e,t,(e,t)=>{r(),n(e,t)})})}_decompress(e,t,n){const r=this._isServer?"client":"server";if(!this._inflate){const e=`${r}_max_window_bits`;this._inflate=f.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:"number"!=typeof this.params[e]?f.Z_DEFAULT_WINDOWBITS:this.params[e]})),this._inflate[Ft]=this,this._inflate[Bt]=0,this._inflate[It]=[],this._inflate.on("error",$t),this._inflate.on("data",Vt)}this._inflate[Mt]=n,this._inflate.write(e),t&&this._inflate.write(Dt),this._inflate.flush(()=>{const e=this._inflate[Ut];if(e)return this._inflate.close(),this._inflate=null,void n(e);const s=Pt.concat(this._inflate[It],this._inflate[Bt]);t&&this.params[`${r}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[Bt]=0,this._inflate[It]=[]),n(null,s)})}_compress(e,t,n){if(!e||0===e.length)return void process.nextTick(n,null,Lt);const r=this._isServer?"server":"client";if(!this._deflate){const e=`${r}_max_window_bits`;this._deflate=f.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:"number"!=typeof this.params[e]?f.Z_DEFAULT_WINDOWBITS:this.params[e]})),this._deflate[Bt]=0,this._deflate[It]=[],this._deflate.on("error",Nt),this._deflate.on("data",Wt)}this._deflate.write(e),this._deflate.flush(f.Z_SYNC_FLUSH,()=>{if(this._deflate){var e=Pt.concat(this._deflate[It],this._deflate[Bt]);t&&(e=e.slice(0,e.length-4)),t&&this.params[`${r}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[Bt]=0,this._deflate[It]=[]),n(null,e)}})}};function Wt(e){this[It].push(e),this[Bt]+=e.length}function Vt(e){this[Bt]+=e.length,this[Ft]._maxPayload>=1&&this[Bt]>this[Ft]._maxPayload?(this[Ut]=new RangeError("Max payload size exceeded"),this[Ut][Tt]=1009,this.removeListener("data",Vt),this.reset()):this[It].push(e)}function $t(e){this[Ft]._inflate=null,e[Tt]=1007,this[Mt](e)}class Gt{constructor(e,t){this.target=t,this.type=e}}class Ht extends Gt{constructor(e,t){super("message",t),this.data=e}}class zt extends Gt{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}}class Yt extends Gt{constructor(e){super("open",e)}}class Xt extends Gt{constructor(e,t){super("error",t),this.message=e.message,this.error=e}}var Jt={addEventListener(e,t){function n(e){t.call(this,new Ht(e,this))}function r(e,n){t.call(this,new zt(e,n,this))}function s(e){t.call(this,new Xt(e,this))}function o(){t.call(this,new Yt(this))}"function"==typeof t&&("message"===e?(n._listener=t,this.on(e,n)):"close"===e?(r._listener=t,this.on(e,r)):"error"===e?(s._listener=t,this.on(e,s)):"open"===e?(o._listener=t,this.on(e,o)):this.on(e,t))},removeEventListener(e,t){const n=this.listeners(e);for(var r=0;n.length>r;r++)n[r]!==t&&n[r]._listener!==t||this.removeListener(e,n[r])}};const Kt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Qt(e,t,n){Object.prototype.hasOwnProperty.call(e,t)?e[t].push(n):e[t]=[n]}var Zt={format:function(e){return Object.keys(e).map(t=>{var n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{var n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t={};if(void 0===e||""===e)return t;for(var n,r,s={},o=!1,i=!1,a=!1,c=-1,u=-1,h=0;e.length>h;h++){const p=e.charCodeAt(h);if(void 0===n)if(-1===u&&1===Kt[p])-1===c&&(c=h);else if(32===p||9===p)-1===u&&-1!==c&&(u=h);else{if(59!==p&&44!==p)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${h}`);-1===u&&(u=h);const r=e.slice(c,u);44===p?(Qt(t,r,s),s={}):n=r,c=u=-1}}else if(void 0===r)if(-1===u&&1===Kt[p])-1===c&&(c=h);else if(32===p||9===p)-1===u&&-1!==c&&(u=h);else if(59===p||44===p){if(-1===c)throw new SyntaxError(`Unexpected character at index ${h}`);-1===u&&(u=h),Qt(s,e.slice(c,u),!0),44===p&&(Qt(t,n,s),s={},n=void 0),c=u=-1}else{if(61!==p||-1===c||-1!==u)throw new SyntaxError(`Unexpected character at index ${h}`);r=e.slice(c,h),c=u=-1}else if(i){if(1!==Kt[p])throw new SyntaxError(`Unexpected character at index ${h}`);-1===c?c=h:o||(o=!0),i=!1}else if(a)if(1===Kt[p])-1===c&&(c=h);else if(34===p&&-1!==c)a=!1,u=h;else{if(92!==p)throw new SyntaxError(`Unexpected character at index ${h}`);i=!0}else if(34===p&&61===e.charCodeAt(h-1))a=!0;else if(-1===u&&1===Kt[p])-1===c&&(c=h);else if(-1===c||32!==p&&9!==p){if(59!==p&&44!==p)throw new SyntaxError(`Unexpected character at index ${h}`);if(-1===c)throw new SyntaxError(`Unexpected character at index ${h}`);-1===u&&(u=h);var l=e.slice(c,u);o&&(l=l.replace(/\\/g,""),o=!1),Qt(s,r,l),44===p&&(Qt(t,n,s),s={},n=void 0),r=void 0,c=u=-1}else-1===u&&(u=h)}if(-1===c||a)throw new SyntaxError("Unexpected end of input");-1===u&&(u=h);const p=e.slice(c,u);return void 0===n?Qt(t,p,{}):(void 0===r?Qt(s,p,!0):Qt(s,r,o?p.replace(/\\/g,""):p),Qt(t,n,s)),t}},en=D(function(e,t){try{const e=m;t.isValidUTF8="object"==typeof e?e.Validation.isValidUTF8:e}catch(e){t.isValidUTF8=(()=>!0)}t.isValidStatusCode=(e=>e>=1e3&&1013>=e&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&4999>=e)});const tn=0,nn=1,rn=2,sn=3,on=4,an=5;var cn=class extends y.Writable{constructor(e,t,n){super(),this._binaryType=e||At.BINARY_TYPES[0],this[At.kWebSocket]=void 0,this._extensions=t||{},this._maxPayload=0|n,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=tn,this._loop=!1}_write(e,t,n){if(8===this._opcode&&this._state==tn)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(this._buffers[0].length>e){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const n=this._buffers[0];n.length>e?(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)):this._buffers.shift().copy(t,t.length-e),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do{switch(this._state){case tn:t=this.getInfo();break;case nn:t=this.getPayloadLength16();break;case rn:t=this.getPayloadLength64();break;case sn:this.getMask();break;case on:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(2>this._bufferedBytes)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,un(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const t=64==(64&e[0]);if(t&&!this._extensions[qt.extensionName])return this._loop=!1,un(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,un(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,un(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,un(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else{if(7>=this._opcode||this._opcode>=11)return this._loop=!1,un(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin)return this._loop=!1,un(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,un(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,un(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),126===this._payloadLength)this._state=nn;else{if(127!==this._payloadLength)return this.haveLength();this._state=rn}}getPayloadLength16(){if(this._bufferedBytes>=2)return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(8>this._bufferedBytes)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>2097151?(this._loop=!1,un(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=4294967296*t+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&8>this._opcode&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,un(RangeError,"Max payload size exceeded",!1,1009);this._state=this._masked?sn:on}getMask(){4>this._bufferedBytes?this._loop=!1:(this._mask=this.consume(4),this._state=on)}getData(e){var t=At.EMPTY_BUFFER;if(this._payloadLength){if(this._payloadLength>this._bufferedBytes)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&Pt.unmask(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=an,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[qt.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(un(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(n)}const r=this.dataMessage();if(r)return t(r);this.startLoop(t)})}dataMessage(){if(this._fin){const n=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){var e;e="nodebuffer"===this._binaryType?hn(r,n):"arraybuffer"===this._binaryType?(t=hn(r,n)).byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength):r,this.emit("message",e)}else{const e=hn(r,n);if(!en.isValidUTF8(e))return this._loop=!1,un(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",""+e)}}var t;this._state=tn}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return un(RangeError,"invalid payload length 1",!0,1002);{const t=e.readUInt16BE(0);if(!en.isValidStatusCode(t))return un(RangeError,`invalid status code ${t}`,!0,1002);const n=e.slice(2);if(!en.isValidUTF8(n))return un(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,""+n),this.end()}}else this.emit(9===this._opcode?"ping":"pong",e);this._state=tn}};function un(e,t,n,r){const s=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,un),s[At.kStatusCode]=r,s}function hn(e,t){return 1===e.length?e[0]:e.length>1?Pt.concat(e,t):At.EMPTY_BUFFER}class ln{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const n=1024>e.length||t.mask&&t.readOnly;var r=t.mask?6:2,s=e.length;65536>e.length?e.length>125&&(r+=2,s=126):(r+=8,s=127);const o=Buffer.allocUnsafe(n?e.length+r:r);if(o[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(o[0]|=64),126===s?o.writeUInt16BE(e.length,2):127===s&&(o.writeUInt32BE(0,2),o.writeUInt32BE(e.length,6)),!t.mask)return o[1]=s,n?(e.copy(o,r),[o]):[o,e];const i=h.randomBytes(4);return o[1]=128|s,o[r-4]=i[0],o[r-3]=i[1],o[r-2]=i[2],o[r-1]=i[3],n?(Pt.mask(e,i,o,r,e.length),[o]):(Pt.mask(e,i,e,0,e.length),[o,e])}close(e,t,n,r){var s;if(void 0===e)s=At.EMPTY_BUFFER;else{if("number"!=typeof e||!en.isValidStatusCode(e))throw new TypeError("First argument must be a valid error code number");void 0===t||""===t?(s=Buffer.allocUnsafe(2)).writeUInt16BE(e,0):((s=Buffer.allocUnsafe(2+Buffer.byteLength(t))).writeUInt16BE(e,0),s.write(t,2))}this._deflating?this.enqueue([this.doClose,s,n,r]):this.doClose(s,n,r)}doClose(e,t,n){this.sendFrame(ln.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=fn(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPing,e,t,r,n]):this.doPing(e,t,r,n)}doPing(e,t,n,r){this.sendFrame(ln.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),r)}pong(e,t,n){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=fn(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPong,e,t,r,n]):this.doPong(e,t,r,n)}doPong(e,t,n,r){this.sendFrame(ln.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),r)}send(e,t,n){var r=t.binary?2:1,s=t.compress,o=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=fn(e):(e=Buffer.from(e),o=!1));const i=this._extensions[qt.extensionName];if(this._firstFragment?(this._firstFragment=!1,s&&i&&(s=e.length>=i._threshold),this._compress=s):(s=!1,r=0),t.fin&&(this._firstFragment=!0),i){const i={fin:t.fin,rsv1:s,opcode:r,mask:t.mask,readOnly:o};this._deflating?this.enqueue([this.dispatch,e,this._compress,i,n]):this.dispatch(e,this._compress,i,n)}else this.sendFrame(ln.frame(e,{fin:t.fin,rsv1:!1,opcode:r,mask:t.mask,readOnly:o}),n)}dispatch(e,t,n,r){if(!t)return void this.sendFrame(ln.frame(e,n),r);const s=this._extensions[qt.extensionName];this._deflating=!0,s.compress(e,n.fin,(e,t)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(ln.frame(t,n),r),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.write(e[0]),this._socket.write(e[1],t)):this._socket.write(e[0],t)}}var pn=ln;function fn(e){const t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength?t.slice(e.byteOffset,e.byteOffset+e.byteLength):t}const dn=["CONNECTING","OPEN","CLOSING","CLOSED"],yn=At.kWebSocket,mn=[8,13],gn=3e4;class bn extends u{constructor(e,t,n){super(),this.readyState=bn.CONNECTING,this.protocol="",this._binaryType=At.BINARY_TYPES[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._isServer=!0,this._receiver=null,this._sender=null,this._socket=null,null!==e&&(Array.isArray(t)?t=t.join(", "):"object"==typeof t&&null!==t&&(n=t,t=void 0),function(e,t,n){if(n=Object.assign({protocolVersion:mn[1],perMessageDeflate:!0,maxPayload:104857600},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0}),!mn.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} `+`(supported versions: ${mn.join(", ")})`);var r;this._isServer=!1,"object"==typeof e&&void 0!==e.href?(r=e,this.url=e.href):(r=o.URL?new o.URL(e):o.parse(e),this.url=e);const s="ws+unix:"===r.protocol;if(!(r.host||s&&r.pathname))throw Error(`Invalid URL: ${this.url}`);const i="wss:"===r.protocol||"https:"===r.protocol,u=i?443:80,l=h.randomBytes(16).toString("base64"),p=i?c:a,f=r.search?`${r.pathname||"/"}${r.search}`:r.pathname||"/";var d;n.createConnection=i?wn:_n,n.defaultPort=n.defaultPort||u,n.port=r.port||u,n.host=r.hostname.startsWith("[")?r.hostname.slice(1,-1):r.hostname,n.headers=Object.assign({"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},n.headers),n.path=f,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(d=new qt(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=Zt.format({[qt.extensionName]:d.offer()}));t&&(n.headers["Sec-WebSocket-Protocol"]=t);n.origin&&(13>n.protocolVersion?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin);r.auth?n.auth=r.auth:(r.username||r.password)&&(n.auth=`${r.username}:${r.password}`);if(s){const e=f.split(":");n.socketPath=e[0],n.path=e[1]}var y=this._req=p.get(n);n.handshakeTimeout&&y.on("timeout",()=>{On(this,y,"Opening handshake has timed out")});y.on("error",e=>{this._req.aborted||(y=this._req=null,this.readyState=bn.CLOSING,this.emit("error",e),this.emitClose())}),y.on("response",e=>{this.emit("unexpected-response",y,e)||On(this,y,`Unexpected server response: ${e.statusCode}`)}),y.on("upgrade",(e,r,s)=>{if(this.emit("upgrade",e),this.readyState!==bn.CONNECTING)return;y=this._req=null;const o=h.createHash("sha1").update(l+At.GUID,"binary").digest("base64");if(e.headers["sec-websocket-accept"]!==o)return void On(this,r,"Invalid Sec-WebSocket-Accept header");const i=e.headers["sec-websocket-protocol"],a=(t||"").split(/, */);var c;if(!t&&i?c="Server sent a subprotocol but none was requested":t&&!i?c="Server sent no subprotocol":i&&!a.includes(i)&&(c="Server sent an invalid subprotocol"),c)On(this,r,c);else{if(i&&(this.protocol=i),d)try{const t=Zt.parse(e.headers["sec-websocket-extensions"]);t[qt.extensionName]&&(d.accept(t[qt.extensionName]),this._extensions[qt.extensionName]=d)}catch(e){return void On(this,r,"Invalid Sec-WebSocket-Extensions header")}this.setSocket(r,s,n.maxPayload)}})}.call(this,e,t,n))}get CONNECTING(){return bn.CONNECTING}get CLOSING(){return bn.CLOSING}get CLOSED(){return bn.CLOSED}get OPEN(){return bn.OPEN}get binaryType(){return this._binaryType}set binaryType(e){At.BINARY_TYPES.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){const r=new cn(this._binaryType,this._extensions,n);this._sender=new pn(e,this._extensions),this._receiver=r,this._socket=e,r[yn]=this,e[yn]=this,r.on("conclude",En),r.on("drain",kn),r.on("error",Sn),r.on("message",Cn),r.on("ping",Rn),r.on("pong",Pn),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",An),e.on("data",Tn),e.on("end",Nn),e.on("error",Dn),this.readyState=bn.OPEN,this.emit("open")}emitClose(){this.readyState=bn.CLOSED,this._socket?(this._extensions[qt.extensionName]&&this._extensions[qt.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)):this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==bn.CLOSED){if(this.readyState===bn.CONNECTING){return On(this,this._req,"WebSocket was closed before the connection was established")}this.readyState!==bn.CLOSING?(this.readyState=bn.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,this._socket.writable&&(this._closeFrameReceived&&this._socket.end(),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),gn)))})):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(e,t,n){if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),this.readyState!==bn.OPEN){const e=Error(`WebSocket is not open: readyState ${this.readyState} `+`(${dn[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=""+e),void 0===t&&(t=!this._isServer),this._sender.ping(e||At.EMPTY_BUFFER,t,n)}pong(e,t,n){if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),this.readyState!==bn.OPEN){const e=Error(`WebSocket is not open: readyState ${this.readyState} `+`(${dn[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=""+e),void 0===t&&(t=!this._isServer),this._sender.pong(e||At.EMPTY_BUFFER,t,n)}send(e,t,n){if("function"==typeof t&&(n=t,t={}),this.readyState!==bn.OPEN){const e=Error(`WebSocket is not open: readyState ${this.readyState} `+`(${dn[this.readyState]})`);if(n)return n(e);throw e}"number"==typeof e&&(e=""+e);const r=Object.assign({binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[qt.extensionName]||(r.compress=!1),this._sender.send(e||At.EMPTY_BUFFER,r,n)}terminate(){if(this.readyState!==bn.CLOSED){if(this.readyState===bn.CONNECTING){return On(this,this._req,"WebSocket was closed before the connection was established")}this._socket&&(this.readyState=bn.CLOSING,this._socket.destroy())}}}dn.forEach((e,t)=>{bn[e]=t}),["open","error","close","message"].forEach(e=>{Object.defineProperty(bn.prototype,`on${e}`,{get(){const t=this.listeners(e);for(var n=0;t.length>n;n++)if(t[n]._listener)return t[n]._listener},set(t){const n=this.listeners(e);for(var r=0;n.length>r;r++)n[r]._listener&&this.removeListener(e,n[r]);this.addEventListener(e,t)}})}),bn.prototype.addEventListener=Jt.addEventListener,bn.prototype.removeEventListener=Jt.removeEventListener;var vn=bn;function _n(e){return e.protocolVersion&&(e.path=e.socketPath),l.connect(e)}function wn(e){return e.path=void 0,e.servername=e.servername||e.host,p.connect(e)}function On(e,t,n){e.readyState=bn.CLOSING;const r=Error(n);Error.captureStackTrace(r,On),t.setHeader?(t.abort(),t.once("abort",e.emitClose.bind(e)),e.emit("error",r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function En(e,t){const n=this[yn];n._socket.removeListener("data",Tn),n._socket.resume(),n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,1005===e?n.close():n.close(e,t)}function kn(){this[yn]._socket.resume()}function Sn(e){const t=this[yn];t._socket.removeListener("data",Tn),t.readyState=bn.CLOSING,t._closeCode=e[At.kStatusCode],t.emit("error",e),t._socket.destroy()}function xn(){this[yn].emitClose()}function Cn(e){this[yn].emit("message",e)}function Rn(e){const t=this[yn];t.pong(e,!t._isServer,At.NOOP),t.emit("ping",e)}function Pn(e){this[yn].emit("pong",e)}function An(){const e=this[yn];this.removeListener("close",An),this.removeListener("end",Nn),e.readyState=bn.CLOSING,e._socket.read(),e._receiver.end(),this.removeListener("data",Tn),this[yn]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",xn),e._receiver.on("finish",xn))}function Tn(e){this[yn]._receiver.write(e)||this.pause()}function Nn(){const e=this[yn];e.readyState=bn.CLOSING,e._receiver.end(),this.end()}function Dn(){const e=this[yn];this.removeListener("error",Dn),this.on("error",At.NOOP),e&&(e.readyState=bn.CLOSING,this.destroy())}var Ln=class extends u{constructor(e,t){if(super(),null==(e=Object.assign({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e)).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');null!=e.port?(this._server=a.createServer((e,t)=>{const n=a.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=function(e,t){for(const n of Object.keys(t))e.on(n,t[n]);return function(){for(const n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(e,t,n)=>{this.handleUpgrade(e,t,n,t=>{this.emit("connection",t,e)})}})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(const e of this.clients)e.terminate();const t=this._server;t&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)?t.close(()=>this.emit("close")):process.nextTick(Fn,this)}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,r){t.on("error",Bn);const s=+e.headers["sec-websocket-version"],o={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!e.headers["sec-websocket-key"]||8!==s&&13!==s||!this.shouldHandle(e))return Mn(t,400);if(this.options.perMessageDeflate){const n=new qt(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const r=Zt.parse(e.headers["sec-websocket-extensions"]);r[qt.extensionName]&&(n.accept(r[qt.extensionName]),o[qt.extensionName]=n)}catch(e){return Mn(t,400)}}if(this.options.verifyClient){const i={origin:e.headers[`${8===s?"sec-websocket-origin":"origin"}`],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(i,(s,i,a,c)=>{if(!s)return Mn(t,i||401,a,c);this.completeUpgrade(o,e,t,n,r)});if(!this.options.verifyClient(i))return Mn(t,401)}this.completeUpgrade(o,e,t,n,r)}completeUpgrade(e,t,n,r,s){if(!n.readable||!n.writable)return n.destroy();const o=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${h.createHash("sha1").update(t.headers["sec-websocket-key"]+At.GUID,"binary").digest("base64")}`],i=new vn(null);var a=t.headers["sec-websocket-protocol"];if(a&&(a=a.trim().split(/ *, */),(a=this.options.handleProtocols?this.options.handleProtocols(a,t):a[0])&&(o.push(`Sec-WebSocket-Protocol: ${a}`),i.protocol=a)),e[qt.extensionName]){const t=Zt.format({[qt.extensionName]:[e[qt.extensionName].params]});o.push(`Sec-WebSocket-Extensions: ${t}`),i._extensions=e}this.emit("headers",o,t),n.write(o.concat("\r\n").join("\r\n")),n.removeListener("error",Bn),i.setSocket(n,r,this.options.maxPayload),this.clients&&(this.clients.add(i),i.on("close",()=>this.clients.delete(i))),s(i)}};function Fn(e){e.emit("close")}function Bn(){this.destroy()}function Mn(e,t,n,r){e.writable&&(n=n||a.STATUS_CODES[t],r=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(n)},r),e.write(`HTTP/1.1 ${t} ${a.STATUS_CODES[t]}\r\n`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+n)),e.removeListener("error",Bn),e.destroy()}vn.Server=Ln,vn.Receiver=cn,vn.Sender=pn;var In,Un,jn=vn,qn=pe("engine.io-client:websocket");if("undefined"!=typeof WebSocket?In=WebSocket:"undefined"!=typeof self&&(In=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{Un=jn}catch(e){}var Wn=In||Un,Vn=$n;function $n(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=In&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(Wn=Un),Je.call(this,e)}et($n,Je),$n.prototype.name="websocket",$n.prototype.supportsBinary=!0,$n.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={};this.isReactNative||(n.agent=this.agent,n.perMessageDeflate=this.perMessageDeflate,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new Wn(e,t):new Wn(e):new Wn(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},$n.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},$n.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,r=0,s=n;s>r;r++)!function(e){Ye.encodePacket(e,t.supportsBinary,function(r){if(!t.usingBrowserWebSocket){var s={};if(e.options&&(s.compress=e.options.compress),t.perMessageDeflate){var i="string"==typeof r?Buffer.byteLength(r):r.length;t.perMessageDeflate.threshold>i&&(s.compress=!1)}}try{t.usingBrowserWebSocket?t.ws.send(r):t.ws.send(r,s)}catch(e){qn("websocket closed before onclose event")}--n||o()})}(e[r]);function o(){t.emit("flush"),setTimeout(function(){t.writable=!0,t.emit("drain")},0)}},$n.prototype.onClose=function(){Je.prototype.onClose.call(this)},$n.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},$n.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!=+this.port||"ws"===t&&80!=+this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=ct()),this.supportsBinary||(e.b64=1),(e=Ze.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},$n.prototype.check=function(){return!(!Wn||"__initialize"in Wn&&this.name===$n.prototype.name)};var Gn={polling:function(e){var t=!1,n=!1,r=!1!==e.jsonp;if("undefined"!=typeof location){var s="https:"===location.protocol,o=location.port;o||(o=s?443:80),t=e.hostname!==location.hostname||o!==e.port,n=e.secure!==s}if(e.xdomain=t,e.xscheme=n,"open"in new xe(e)&&!e.forceJSONP)return new yt(e);if(!r)throw Error("JSONP disabled");return new Ot(e)},websocket:Vn},Hn=[].indexOf,zn=function(e,t){if(Hn)return e.indexOf(t);for(var n=0;e.length>n;++n)if(e[n]===t)return n;return-1},Yn=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Jn=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var s,o=Yn.exec(e||""),i={},a=14;a--;)i[Xn[a]]=o[a]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(e,t){var n=t.replace(/\/{2,9}/g,"/").split("/");"/"!=t.substr(0,1)&&0!==t.length||n.splice(0,1);"/"==t.substr(t.length-1,1)&&n.splice(n.length-1,1);return n}(0,i.path),i.queryKey=(s={},i.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(e,t,n){t&&(s[t]=n)}),s),i};var Kn=pe("engine.io-client:socket"),Qn=Zn;function Zn(e,t){if(!(this instanceof Zn))return new Zn(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=Jn(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Jn(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=Ze.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Zn.priorWebsocketSuccess=!1,Xe(Zn.prototype),Zn.protocol=Ye.protocol,Zn.Socket=Zn,Zn.Transport=Je,Zn.transports=Gn,Zn.parser=Ye,Zn.prototype.createTransport=function(e){Kn('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=Ye.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new Gn[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Zn.prototype.open=function(){var e;if(this.rememberUpgrade&&Zn.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Zn.prototype.setTransport=function(e){Kn("setting transport %s",e.name);var t=this;this.transport&&(Kn("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},Zn.prototype.probe=function(e){Kn('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function s(){r.onlyBinaryUpgrades&&(n=n||!this.supportsBinary&&r.transport.supportsBinary);n||(Kn('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(s){if(!n)if("pong"===s.type&&"probe"===s.data){if(Kn('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;Zn.priorWebsocketSuccess="websocket"===t.name,Kn('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(Kn("changing transport and sending upgrade packet"),h(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())})}else{Kn('probe transport "%s" failed',e);var o=Error("probe error");o.transport=t.name,r.emit("upgradeError",o)}}))}function o(){n||(n=!0,h(),t.close(),t=null)}function i(n){var s=Error("probe error: "+n);s.transport=t.name,o(),Kn('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",s)}function a(){i("transport closed")}function c(){i("socket closed")}function u(e){t&&e.name!==t.name&&(Kn('"%s" works - aborting "%s"',e.name,t.name),o())}function h(){t.removeListener("open",s),t.removeListener("error",i),t.removeListener("close",a),r.removeListener("close",c),r.removeListener("upgrading",u)}Zn.priorWebsocketSuccess=!1,t.once("open",s),t.once("error",i),t.once("close",a),this.once("close",c),this.once("upgrading",u),t.open()},Zn.prototype.onOpen=function(){if(Kn("socket open"),this.readyState="open",Zn.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Kn("starting upgrade probes");for(var e=0,t=this.upgrades.length;t>e;e++)this.probe(this.upgrades[e])}},Zn.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Kn('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Kn('packet received with socket readyState "%s"',this.readyState)},Zn.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Zn.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},Zn.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){Kn("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},Zn.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},Zn.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Zn.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Kn("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Zn.prototype.write=Zn.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},Zn.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var s={type:e,data:t,options:n};this.emit("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}},Zn.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():t()}):this.upgrading?r():t()}function t(){e.onClose("forced close"),Kn("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},Zn.prototype.onError=function(e){Kn("socket error %j",e),Zn.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Zn.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Kn('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},Zn.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;r>n;n++)~zn(this.transports,e[n])&&t.push(e[n]);return t};var er=Qn;er.parser=Ye;var tr=D(function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;r.length>s;s++)if((n=r[s])===t||n.fn===t){r.splice(s,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,s=(n=n.slice(0)).length;s>r;++r)n[r].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}),nr=function(e,t){for(var n=[],r=(t=t||0)||0;e.length>r;r++)n[r-t]=e[r];return n};var rr=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}};var sr=[].slice,or=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw Error("bind() requires a function");var n=sr.call(arguments,2);return function(){return t.apply(e,n.concat(sr.call(arguments)))}},ir=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},ar=D(function(e,t){var n=Z("socket.io-client:socket");e.exports=o;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},s=tr.prototype.emit;function o(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}tr(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[rr(e,"open",or(this,"onopen")),rr(e,"packet",or(this,"onpacket")),rr(e,"close",or(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},o.prototype.send=function(){var e=nr(arguments);return e.unshift("message"),this.emit.apply(this,e),this},o.prototype.emit=function(e){if(r.hasOwnProperty(e))return s.apply(this,arguments),this;var t=nr(arguments),o={type:(void 0!==this.flags.binary?this.flags.binary:$e(t))?ke.BINARY_EVENT:ke.EVENT,data:t,options:{}};return o.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},o.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},o.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?ir(this.query):this.query;n("sending connect packet with query %s",e),this.packet({type:ke.CONNECT,query:e})}else this.packet({type:ke.CONNECT})},o.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},o.prototype.onpacket=function(e){if(e.nsp===this.nsp||e.type===ke.ERROR&&"/"===e.nsp)switch(e.type){case ke.CONNECT:this.onconnect();break;case ke.EVENT:case ke.BINARY_EVENT:this.onevent(e);break;case ke.ACK:case ke.BINARY_ACK:this.onack(e);break;case ke.DISCONNECT:this.ondisconnect();break;case ke.ERROR:this.emit("error",e.data)}},o.prototype.onevent=function(e){var t=e.data||[];n("emitting event %j",t),null!=e.id&&(n("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?s.apply(this,t):this.receiveBuffer.push(t)},o.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var s=nr(arguments);n("sending ack %j",s),t.packet({type:$e(s)?ke.BINARY_ACK:ke.ACK,id:e,data:s})}}},o.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var e;for(e=0;this.receiveBuffer.length>e;e++)s.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;this.sendBuffer.length>e;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var e=0;this.subs.length>e;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:ke.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(e){return this.flags.compress=e,this},o.prototype.binary=function(e){return this.flags.binary=e,this}}),cr=ur;function ur(e){this.ms=(e=e||{}).min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&1>=e.jitter?e.jitter:0,this.attempts=0}ur.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},ur.prototype.reset=function(){this.attempts=0},ur.prototype.setMin=function(e){this.ms=e},ur.prototype.setMax=function(e){this.max=e},ur.prototype.setJitter=function(e){this.jitter=e};var hr=Z("socket.io-client:manager"),lr=Object.prototype.hasOwnProperty,pr=fr;function fr(e,t){if(!(this instanceof fr))return new fr(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new cr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||ke;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}fr.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)lr.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},fr.prototype.updateSocketIds=function(){for(var e in this.nsps)lr.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},fr.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},tr(fr.prototype),fr.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},fr.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},fr.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},fr.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},fr.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},fr.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},fr.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},fr.prototype.open=fr.prototype.connect=function(e,t){if(hr("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;hr("opening %s",this.uri),this.engine=er(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var s=rr(n,"open",function(){r.onopen(),e&&e()}),o=rr(n,"error",function(t){if(hr("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var i=this._timeout;hr("connect attempt will timeout after %d",i);var a=setTimeout(function(){hr("connect attempt timed out after %d",i),s.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",i)},i);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(s),this.subs.push(o),this},fr.prototype.onopen=function(){hr("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(rr(e,"data",or(this,"ondata"))),this.subs.push(rr(e,"ping",or(this,"onping"))),this.subs.push(rr(e,"pong",or(this,"onpong"))),this.subs.push(rr(e,"error",or(this,"onerror"))),this.subs.push(rr(e,"close",or(this,"onclose"))),this.subs.push(rr(this.decoder,"decoded",or(this,"ondecoded")))},fr.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},fr.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},fr.prototype.ondata=function(e){this.decoder.add(e)},fr.prototype.ondecoded=function(e){this.emit("packet",e)},fr.prototype.onerror=function(e){hr("error",e),this.emitAll("error",e)},fr.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new ar(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",s),n.on("connect",function(){n.id=r.generateId(e)}),this.autoConnect&&s()}function s(){~zn(r.connecting,n)||r.connecting.push(n)}return n},fr.prototype.destroy=function(e){var t=zn(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},fr.prototype.packet=function(e){hr("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var r=0;n.length>r;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()}))},fr.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},fr.prototype.cleanup=function(){hr("cleanup");for(var e=this.subs.length,t=0;e>t;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},fr.prototype.close=fr.prototype.disconnect=function(){hr("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},fr.prototype.onclose=function(e){hr("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},fr.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts<this._reconnectionAttempts){var t=this.backoff.duration();hr("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(hr("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(hr("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(hr("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}else hr("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1},fr.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var dr,yr=D(function(e,t){var n=Z("socket.io-client");e.exports=t=s;var r=t.managers={};function s(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var s,o=te(e),i=o.source,a=o.id;return t.forceNew||t["force new connection"]||!1===t.multiplex||r[a]&&o.path in r[a].nsps?(n("ignoring socket cache for %s",i),s=pr(i,t)):(r[a]||(n("new io instance for %s",i),r[a]=pr(i,t)),s=r[a]),o.query&&!t.query&&(t.query=o.query),s.socket(o.path,t)}t.protocol=ke.protocol,t.connect=s,t.Manager=pr,t.Socket=ar}),mr=function(e,t){for(var n=e.split("."),r=t.split("."),s=0;3>s;s++){var o=+n[s],i=+r[s];if(o>i)return 1;if(i>o)return-1;if(!isNaN(o)&&isNaN(i))return 1;if(isNaN(o)&&!isNaN(i))return-1}return 0},gr=D(function(e,t){var n=N&&N.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;n>t;t++)e+=arguments[t].length;var r=Array(e),s=0;for(t=0;n>t;t++)for(var o=arguments[t],i=0,a=o.length;a>i;i++,s++)r[s]=o[i];return r};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t,n){this.name=e,this.version=t,this.os=n}}();t.BrowserInfo=r;var s=function(){return function(e){this.version=e,this.name="node",this.os=process.platform}}();t.NodeInfo=s;var o=function(){return function(){this.bot=!0,this.name="bot",this.version=null,this.os=null}}();t.BotInfo=o;var i=3,a=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],c=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function u(e){var t=""!==e&&a.reduce(function(t,n){var r=n[0];if(t)return t;var s=n[1].exec(e);return!!s&&[r,s]},!1);if(!t)return null;var s=t[0],c=t[1];if("searchbot"===s)return new o;var u=c[1]&&c[1].split(/[._]/).slice(0,3);return u?i>u.length&&(u=n(u,function(e){for(var t=[],n=0;e>n;n++)t.push("0");return t}(i-u.length))):u=[],new r(s,u.join("."),h(e))}function h(e){for(var t=0,n=c.length;n>t;t++){var r=c[t],s=r[0];if(r[1].test(e))return s}return null}function l(){return"undefined"!=typeof process&&process.version?new s(process.version.slice(1)):null}t.detect=function(e){return e?u(e):"undefined"!=typeof navigator?u(navigator.userAgent):l()},t.parseUserAgent=u,t.detectOS=h,t.getNodeVersion=l});(dr=gr)&&dr.__esModule&&Object.prototype.hasOwnProperty.call(dr,"default");var br=gr.detect,vr=function(e,t){return(vr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function _r(e,t){function n(){this.constructor=e}vr(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function wr(e){return"function"==typeof e}var Or=!1,Er={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e);Or=e},get useDeprecatedSynchronousErrorHandling(){return Or}};function kr(e){setTimeout(function(){throw e},0)}var Sr={closed:!0,next:function(e){},error:function(e){if(Er.useDeprecatedSynchronousErrorHandling)throw e;kr(e)},complete:function(){}},xr=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function Cr(e){return null!==e&&"object"==typeof e}var Rr=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Pr=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this._parentOrParents,r=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var o=0;n.length>o;++o){n[o].remove(this)}if(wr(r))try{r.call(this)}catch(e){t=e instanceof Rr?Ar(e.errors):[e]}if(xr(s)){o=-1;for(var i=s.length;++o<i;){var a=s[o];if(Cr(a))try{a.unsubscribe()}catch(e){t=t||[],e instanceof Rr?t=t.concat(Ar(e.errors)):t.push(e)}}}if(t)throw new Rr(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}var s=n._parentOrParents;if(null===s)n._parentOrParents=this;else if(s instanceof e){if(s===this)return n;n._parentOrParents=[s,this]}else{if(-1!==s.indexOf(this))return n;s.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=((t=new e).closed=!0,t),e}();function Ar(e){return e.reduce(function(e,t){return e.concat(t instanceof Rr?t.errors:t)},[])}var Tr=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Nr=function(e){function t(n,r,s){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Sr;break;case 1:if(!n){o.destination=Sr;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new Dr(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new Dr(o,n,r,s)}return o}return _r(t,e),t.prototype[Tr]=function(){return this},t.create=function(e,n,r){var s=new t(e,n,r);return s.syncErrorThrowable=!1,s},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(Pr),Dr=function(e){function t(t,n,r,s){var o,i=e.call(this)||this;i._parentSubscriber=t;var a=i;return wr(n)?o=n:n&&(o=n.next,r=n.error,s=n.complete,n!==Sr&&(wr((a=Object.create(n)).unsubscribe)&&i.add(a.unsubscribe.bind(a)),a.unsubscribe=i.unsubscribe.bind(i))),i._context=a,i._next=o,i._error=r,i._complete=s,i}return _r(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Er.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Er.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):kr(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;kr(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Er.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Er.useDeprecatedSynchronousErrorHandling)throw e;kr(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Er.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return Er.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(kr(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(Nr);var Lr=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function Fr(){}var Br=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,s=function(e,t,n){if(e){if(e instanceof Nr)return e;if(e[Tr])return e[Tr]()}return e||t||n?new Nr(e,t,n):new Nr(Sr)}(e,t,n);if(s.add(r?r.call(s,this.source):this.source||Er.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),Er.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Er.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),!function(e){for(;e;){var t=e.destination;if(e.closed||e.isStopped)return!1;e=t&&t instanceof Nr?t:null}return!0}(e)?console.warn(t):e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Mr(t))(function(t,r){var s;s=n.subscribe(function(t){try{e(t)}catch(e){r(e),s&&s.unsubscribe()}},r,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Lr]=function(){return this},e.prototype.pipe=function(){for(var e,t=[],n=0;arguments.length>n;n++)t[n]=arguments[n];return 0===t.length?this:((e=t)?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:Fr)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Mr(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function Mr(e){if(e||(e=Promise),!e)throw Error("no Promise impl found");return e}var Ir=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Ur=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return _r(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(Pr),jr=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return _r(t,e),t}(Nr),qr=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return _r(t,e),t.prototype[Tr]=function(){return new jr(this)},t.prototype.lift=function(e){var t=new Wr(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Ir;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),s=0;n>s;s++)r[s].next(e)},t.prototype.error=function(e){if(this.closed)throw new Ir;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),s=0;n>s;s++)r[s].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ir;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;t>r;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Ir;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Ir;return this.hasError?(e.error(this.thrownError),Pr.EMPTY):this.isStopped?(e.complete(),Pr.EMPTY):(this.observers.push(e),new Ur(this,e))},t.prototype.asObservable=function(){var e=new Br;return e.source=this,e},t.create=function(e,t){return new Wr(e,t)},t}(Br),Wr=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return _r(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Pr.EMPTY},t}(qr),Vr=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return _r(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ir;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(qr),$r=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return _r(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return _r(t,e),t.prototype.schedule=function(e,t){return this},t}(Pr)),Gr=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),Hr=function(e){function t(n,r){void 0===r&&(r=Gr.now);var s=e.call(this,n,function(){return t.delegate&&t.delegate!==s?t.delegate.now():r()})||this;return s.actions=[],s.active=!1,s.scheduled=void 0,s}return _r(t,e),t.prototype.schedule=function(n,r,s){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,s):e.prototype.schedule.call(this,n,r,s)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Gr),zr=new Br(function(e){return e.complete()});function Yr(e){return e?function(e){return new Br(function(t){return e.schedule(function(){return t.complete()})})}(e):zr}function Xr(e){return e&&"function"==typeof e.schedule}var Jr=function(e){return function(t){for(var n=0,r=e.length;r>n&&!t.closed;n++)t.next(e[n]);t.complete()}};function Kr(e,t){return new Br(function(n){var r=new Pr,s=0;return r.add(t.schedule(function(){s!==e.length?(n.next(e[s++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function Qr(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];var n=e[e.length-1];return Xr(n)?(e.pop(),Kr(e,n)):function(e,t){return t?Kr(e,t):new Br(Jr(e))}(e)}var Zr=new Hr($r);function es(e){return e}var ts=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),ns=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}();var rs=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ss(e,this.project,this.thisArg))},e}(),ss=function(e){function t(t,n,r){var s=e.call(this,t)||this;return s.project=n,s.count=0,s.thisArg=r||s,s}return _r(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Nr),os=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return _r(t,e),t.prototype.notifyNext=function(e,t,n,r,s){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(Nr),is=function(e){function t(t,n,r){var s=e.call(this)||this;return s.parent=t,s.outerValue=n,s.outerIndex=r,s.index=0,s}return _r(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(Nr);function as(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var cs=as(),us=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function hs(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var ls=function(e){if(e&&"function"==typeof e[Lr])return r=e,function(e){var t=r[Lr]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(us(e))return Jr(e);if(hs(e))return n=e,function(e){return n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,kr),e};if(e&&"function"==typeof e[cs])return t=e,function(e){for(var n=t[cs]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add(function(){n.return&&n.return()}),e};var t,n,r,s=Cr(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function ps(e,t,n,r,s){if(void 0===s&&(s=new is(e,n,r)),!s.closed)return t instanceof Br?t.subscribe(s):ls(t)(s)}function fs(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[Lr]}(e))return function(e,t){return new Br(function(n){var r=new Pr;return r.add(t.schedule(function(){var s=e[Lr]();r.add(s.subscribe({next:function(e){r.add(t.schedule(function(){return n.next(e)}))},error:function(e){r.add(t.schedule(function(){return n.error(e)}))},complete:function(){r.add(t.schedule(function(){return n.complete()}))}}))})),r})}(e,t);if(hs(e))return function(e,t){return new Br(function(n){var r=new Pr;return r.add(t.schedule(function(){return e.then(function(e){r.add(t.schedule(function(){n.next(e),r.add(t.schedule(function(){return n.complete()}))}))},function(e){r.add(t.schedule(function(){return n.error(e)}))})})),r})}(e,t);if(us(e))return Kr(e,t);if(function(e){return e&&"function"==typeof e[cs]}(e)||"string"==typeof e)return function(e,t){if(!e)throw Error("Iterable cannot be null");return new Br(function(n){var r,s=new Pr;return s.add(function(){r&&"function"==typeof r.return&&r.return()}),s.add(t.schedule(function(){r=e[cs](),s.add(t.schedule(function(){if(!n.closed){var e,t;try{var s=r.next();e=s.value,t=s.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}}))})),s})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function ds(e,t,n){return void 0===n&&(n=1/0),"function"==typeof t?function(r){return r.pipe(ds(function(n,r){return(s=e(n,r),o?fs(s,o):s instanceof Br?s:new Br(ls(s))).pipe(function(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new rs(e,t))}}(function(e,s){return t(n,e,r,s)}));var s,o},n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new ys(e,n))})}var ys=function(){function e(e,t){void 0===t&&(t=1/0),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new ms(e,this.project,this.concurrent))},e}(),ms=function(e){function t(t,n,r){void 0===r&&(r=1/0);var s=e.call(this,t)||this;return s.project=n,s.concurrent=r,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return _r(t,e),t.prototype._next=function(e){this.concurrent>this.active?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=new is(this,void 0,void 0);this.destination.add(r),ps(this,e,t,n,r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e,t,n,r,s){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(os);function gs(){return void 0===(e=1)&&(e=1/0),ds(es,e);var e}function bs(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];return gs()(Qr.apply(void 0,e))}function vs(e){return!xr(e)&&e-parseFloat(e)+1>=0}function _s(e,t){return void 0===e&&(e=0),void 0===t&&(t=Zr),vs(e)&&e>=0||(e=0),t&&"function"==typeof t.schedule||(t=Zr),new Br(function(n){return n.add(t.schedule(ws,e,{subscriber:n,counter:0,period:e})),n})}function ws(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}function Os(e,t){return function(n){return n.lift(new Es(e,t))}}var Es=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ks(e,this.predicate,this.thisArg))},e}(),ks=function(e){function t(t,n,r){var s=e.call(this,t)||this;return s.predicate=n,s.thisArg=r,s.count=0,s}return _r(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(Nr);function Ss(e,t,n){void 0===e&&(e=0);var r=-1;return vs(t)?r=1>+t?1:+t:Xr(t)&&(n=t),Xr(n)||(n=Zr),new Br(function(t){var s=vs(e)?e:+e-n.now();return n.schedule(xs,s,{index:0,period:r,subscriber:t})})}function xs(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}var Cs=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Rs(e,this.defaultValue))},e}(),Rs=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return _r(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(Nr);function Ps(e,t){return function(n){return n.lift(new As(e,t))}}var As=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ts(e,this.compare,this.keySelector))},e}(),Ts=function(e){function t(t,n,r){var s=e.call(this,t)||this;return s.keySelector=r,s.hasKey=!1,"function"==typeof n&&(s.compare=n),s}return _r(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(Nr);var Ns=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Ds(e,this.errorFactory))},e}(),Ds=function(e){function t(t,n){var r=e.call(this,t)||this;return r.errorFactory=n,r.hasValue=!1,r}return _r(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(Nr);function Ls(){return new ns}var Fs=function(){function e(e){if(this.total=e,0>this.total)throw new ts}return e.prototype.call=function(e,t){return t.subscribe(new Bs(e,this.total))},e}(),Bs=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return _r(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n>t||(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(Nr);function Ms(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Os(function(t,n){return e(t,n,r)}):es,(o=1,function(e){return 0===o?Yr():e.lift(new Fs(o))}),n?function(e){return void 0===e&&(e=null),function(t){return t.lift(new Cs(e))}}(t):(void 0===(s=function(){return new ns})&&(s=Ls),function(e){return e.lift(new Ns(s))}));var s,o}}function Is(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];var n=e[e.length-1];return Xr(n)?(e.pop(),function(t){return bs(e,t,n)}):function(t){return bs(e,t)}}function Us(e){return function(t){return t.lift(new js(e))}}var js=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new qs(e),r=ps(n,this.notifier);return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n},e}(),qs=function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}return _r(t,e),t.prototype.notifyNext=function(e,t,n,r,s){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(os),Ws=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://builder.arduino.cc/v3/boards";v(this,e),this.BOARDS_URL=n,this.UPLOAD_NOPE="UPLOAD_NOPE",this.UPLOAD_DONE="UPLOAD_DONE",this.UPLOAD_ERROR="UPLOAD_ERROR",this.UPLOAD_IN_PROGRESS="UPLOAD_IN_PROGRESS",this.DOWNLOAD_DONE="DOWNLOAD_DONE",this.DOWNLOAD_NOPE="DOWNLOAD_NOPE",this.DOWNLOAD_ERROR="DOWNLOAD_ERROR",this.DOWNLOAD_IN_PROGRESS="DOWNLOAD_IN_PROGRESS",this.agentInfo={},this.agentFound=new Vr(null),this.channelOpen=new Vr(null),this.channelOpenStatus=this.channelOpen.pipe(Ps()),this.error=new Vr(null).pipe(Ps()),this.serialMonitorError=new Vr(null),this.appMessages=new qr,this.serialMonitorOpened=new Vr(!1),this.serialMonitorMessages=new qr,this.serialMonitorMessagesWithPort=new qr,this.uploading=new Vr({status:this.UPLOAD_NOPE}),this.uploadInProgress=this.uploading.pipe(Os(function(e){return e.status===t.UPLOAD_IN_PROGRESS})),this.uploadingDone=this.uploading.pipe(Os(function(e){return e.status===t.UPLOAD_DONE})).pipe(Ms()).pipe(Us(this.uploading.pipe(Os(function(e){return e.status===t.UPLOAD_ERROR})))),this.uploadingError=this.uploading.pipe(Os(function(e){return e.status===t.UPLOAD_ERROR})).pipe(Ms()).pipe(Us(this.uploadingDone)),this.devicesList=new Vr({serial:[],network:[]}),this.supportedBoards=new Vr([]),this.appMessages.subscribe(function(e){return t.handleAppMessage(e)}),this.devicesList.pipe(Os(function(e){return e.serial&&e.serial.length>0})).pipe(Ms()).subscribe(function(){return t.closeAllPorts()}),this.downloading=new Vr({status:this.DOWNLOAD_NOPE}),this.downloadingDone=this.downloading.pipe(Os(function(e){return e.status===t.DOWNLOAD_DONE})).pipe(Ms()).pipe(Us(this.downloading.pipe(Os(function(e){return e.status===t.DOWNLOAD_ERROR})))),this.downloadingError=this.downloading.pipe(Os(function(e){return e.status===t.DOWNLOAD_ERROR})).pipe(Ms()).pipe(Us(this.downloadingDone)),this.boardPortAfterUpload=(new qr).pipe(Ms()),this.uploadingPort=null}return w(e,[{key:"notifyUploadError",value:function(e){this.uploading.next({status:this.UPLOAD_ERROR,err:e})}},{key:"openChannel",value:function(e){var t=this;this.channelOpen.subscribe(function(n){n?_s(1500).pipe(Is(0)).pipe(Us(t.channelOpen.pipe(Os(function(e){return!e})))).subscribe(e):(t.devicesList.next({serial:[],network:[]}),t.agentFound.next(!1))})}},{key:"uploadSerial",value:function(e,t,n){var r=this,s=3>=arguments.length||void 0===arguments[3]||arguments[3];this.uploadingPort=e.port,this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"Upload started"}),this.serialDevicesBeforeUpload=this.devicesList.getValue().serial,this.closeSerialMonitor(e.port),fetch("".concat(this.BOARDS_URL,"/").concat(e.board,"/compute"),{method:"POST",body:JSON.stringify({action:"upload",verbose:s,os:this.agentInfo.os})}).then(function(e){return e.json()}).then(function(s){var o=s.commandline.indexOf("{build.project_name}"),i=s.commandline.substring(o+21,o+24),a=n[i]||n.bin;i&&a||(console.log("we received a faulty ext property, defaulting to .bin"),i="bin");var c=b(b({},e),{},{commandline:s.commandline,filename:"".concat(t,".").concat(i),hex:a,data:a});r.uploadingDone.subscribe(function(){r.waitingForPortToComeUp=Ss(1e3).subscribe(function(){var e=r.devicesList.getValue().serial,t=e.find(function(e){return e.Name===r.uploadingPort});t||(t=e.find(function(e){return r.serialDevicesBeforeUpload.every(function(t){return t.Name!==e.Name})}))&&(r.uploadingPort=t.Name,r.boardPortAfterUpload.next({hasChanged:!0,newPort:r.uploadingPort})),t&&(r.waitingForPortToComeUp.unsubscribe(),r.uploadingPort=null,r.serialDevicesBeforeUpload=null,r.boardPortAfterUpload.next({hasChanged:!1}))})});var u=[].concat(P(s.files||[]),P(n.files||[]));r._upload(c,b(b({},s),{},{files:u}))})}},{key:"stopUpload",value:function(){if("function"!=typeof this.stopUploadCommand)throw Error("Stop Upload not supported on Chrome OS");this.stopUploadCommand()}},{key:"setBootloaderMode",value:function(e){var t=this;this.serialMonitorOpened.pipe(Os(function(e){return e})).pipe(Ms()).subscribe(function(){Ss(1e3).subscribe(function(){return t.closeSerialMonitor(e)})}),this.openSerialMonitor(e,1200)}}],[{key:"devicesListAreEquals",value:function(e,t){return!(!e||!t||e.length!==t.length)&&e.every(function(e,n){return t[n].Name===e.Name&&t[n].IsOpen===e.IsOpen})}}]),e}(),Vs=function(){function e(t){v(this,e),this.daemonURL="".concat(t,"/v2")}return w(e,[{key:"init",value:function(){return fetch("".concat(this.daemonURL,"/pkgs/tools/installed"),{method:"HEAD"}).then(function(e){if(200!==e.status)throw Error("v2 not available");return e})}},{key:"installedTools",value:function(){return fetch("".concat(this.daemonURL,"/pkgs/tools/installed"),{method:"GET"}).then(function(e){return e.json()})}},{key:"installTool",value:function(e){return fetch("".concat(this.daemonURL,"/pkgs/tools/installed"),{method:"POST",body:JSON.stringify(e)}).then(function(e){return e.json().then(function(t){if(!e.ok){var n=b(b({},t),{},{status:e.status,statusText:e.statusText});return Promise.reject(n)}return t})})}}]),e}(),$s=br(),Gs={HTTP:"http",HTTPS:"https"},Hs="".concat(Gs.HTTP,"://127.0.0.1"),zs="".concat(Gs.HTTPS,"://localhost"),Ys=[Hs,zs],Xs=!1,Js=0;"chrome"!==$s.name&&"firefox"!==$s.name&&(Ys=[zs,Hs]);var Ks=function(e){E(n,Ws);var t=C(n);function n(e){var r;return v(this,n),(r=t.call(this,e)).selectedProtocol=Gs.HTTP,r.socket=null,r.pluginURL=null,r.disabled=!1,r.openChannel(function(){return r.socket.emit("command","list")}),r.agentV2Found=new Vr(null),r.agentFound.subscribe(function(e){if(e){r._wsConnect();var t=new Vs(r.pluginURL);t.init().then(function(){r.v2=t,r.agentV2Found.next(r.v2)})}else r.findAgent()}),r}return w(n,[{key:"initSocket",value:function(){var e=this;this.socket.on("message",function(t){try{e.appMessages.next(JSON.parse(t))}catch(n){e.appMessages.next(t)}})}},{key:"notifyDownloadError",value:function(e){this.downloading.next({status:this.DOWNLOAD_ERROR,err:e})}},{key:"findAgent",value:function(){var e=this;this.disabled||(this.pluginURL?fetch("".concat(this.pluginURL,"/info")).then(function(t){return t.json().then(function(t){e.agentInfo=t,e.agentFound.next(!0)})}).catch(function(){return Ss(3500).subscribe(function(){e.pluginURL=null,e.findAgent()})}):this._tryPorts(Ys[0]).catch(function(){return e._tryPorts(Ys[1])}).then(function(){return e.agentFound.next(!0)}).catch(function(){return Ss(3500).subscribe(function(){return e.findAgent()})}))}},{key:"_tryPorts",value:function(e){for(var t=this,n=[],r=8991;9e3>r;r+=1)n.push(fetch("".concat(e,":").concat(r,"/info")).then(function(e){return e.json().then(function(t){return{response:e,data:t}})}).catch(function(){return Promise.resolve(!1)}));return Promise.all(n).then(function(n){return n.some(function(e){return!(!e||!e.response||200!==e.response.status)&&(t.agentInfo=e.data,-1===t.agentInfo.update_url.indexOf("downloads.arduino.cc")&&t.error.next("unofficial plugin"),0===e.response.url.indexOf(Gs.HTTPS)?t.selectedProtocol=Gs.HTTPS:t.agentInfo[t.selectedProtocol]=t.agentInfo[t.selectedProtocol].replace("localhost","127.0.0.1"),t.pluginURL=t.agentInfo[t.selectedProtocol],!0)})?fetch("https://s3.amazonaws.com/arduino-create-static/agent-metadata/agent-version.json").then(function(e){return e.json().then(function(e){return!t.agentInfo.version||0!==mr(t.agentInfo.version,e.Version)&&-1===t.agentInfo.version.indexOf("dev")&&-1===t.agentInfo.version.indexOf("rc")?0===Js?t.update():3>Js?Ss(1e4).subscribe(function(){return t.update()}):(Js+=1,t.error.next("plugin version incompatible"),Promise.reject(Error("plugin version incompatible"))):t.agentInfo})}).catch(function(){return t.agentInfo}):(null===t.channelOpen.getValue()&&t.channelOpen.next(!1),Promise.reject(Error("".concat("Arduino Create Agent cannot be found"," at ").concat(e))))})}},{key:"_wsConnect",value:function(){var e=this,t=this.agentInfo[this.selectedProtocol===Gs.HTTPS?"wss":"ws"];this.socket&&(this.socket.destroy(),delete this.socket,this.socket=null),this.socket=yr(t),this.socket.on("connect",function(){Xs||(e.downloadTool("windows-drivers","latest","arduino"),e.downloadTool("bossac","1.7.0","arduino"),e.downloadTool("fwupdater","latest","arduino"),e.downloadTool("rp2040tools","latest","arduino"),Xs=!1),e.initSocket(),e.channelOpen.next(!0)}),this.socket.on("error",function(t){e.socket.disconnect(),e.error.next(t)}),this.socket.on("disconnect",function(){e.socket.disconnect(),e.channelOpen.next(!1)})}},{key:"handleAppMessage",value:function(e){e.Ports&&this.handleListMessage(e),e.D&&(this.serialMonitorMessages.next(e.D),this.serialMonitorMessagesWithPort.next(e)),e.ProgrammerStatus&&this.handleUploadMessage(e),e.DownloadStatus&&this.handleDownloadMessage(e),e.Err&&this.uploading.next({status:this.UPLOAD_ERROR,err:e.Err}),e.Error&&-1!==e.Error.indexOf("trying to close")&&this.serialMonitorOpened.next(!1)}},{key:"handleListMessage",value:function(e){var t=this.devicesList.getValue();e.Network&&!Ws.devicesListAreEquals(t.network,e.Ports)?this.devicesList.next({serial:t.serial,network:e.Ports}):e.Network||Ws.devicesListAreEquals(t.serial,e.Ports)||this.devicesList.next({serial:e.Ports,network:t.network})}},{key:"update",value:function(){var e=this;return fetch("".concat(this.agentInfo[this.selectedProtocol],"/update"),{method:"POST"}).then(function(e){return e.json()}).then(function(t){return t&&t.error&&(-1!==t.error.indexOf("proxy")||-1!==t.error.indexOf("dial tcp"))?(e.error.next("proxy error"),Error("proxy error")):Promise.reject()}).catch(function(){console.log("update plugin failed")})}},{key:"stopPlugin",value:function(){if(this.agentFound.getValue())return fetch("".concat(this.agentInfo[this.selectedProtocol],"/pause"),{method:"POST"})}},{key:"closeAllPorts",value:function(){var e=this;this.devicesList.getValue().serial.forEach(function(t){e.socket.emit("command","close ".concat(t.Name))})}},{key:"writeSerial",value:function(e,t){this.socket.emit("command","send ".concat(e," ").concat(t))}},{key:"openSerialMonitor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9600,r=this.devicesList.getValue().serial.find(function(t){return t.Name===e});if(!r)return this.serialMonitorError.next("Can't find board at ".concat(e));this.uploading.getValue().status===this.UPLOAD_IN_PROGRESS||r.IsOpen||(this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(e){return e})))).subscribe(function(n){"Open"===n.Cmd&&t.serialMonitorOpened.next(!0),"OpenFail"===n.Cmd&&t.serialMonitorError.next("Failed to open serial monitor at ".concat(e))}),this.socket.emit("command","open ".concat(e," ").concat(n," timed")))}},{key:"closeSerialMonitor",value:function(e){var t=this,n=this.devicesList.getValue().serial.find(function(t){return t.Name===e});n&&n.IsOpen&&(this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(e){return!e})))).subscribe(function(n){"Close"===n.Cmd&&t.serialMonitorOpened.next(!1),"CloseFail"===n.Cmd&&t.serialMonitorError.next("Failed to close serial monitor at ".concat(e))}),this.socket.emit("command","close ".concat(e)))}},{key:"handleUploadMessage",value:function(e){var t=this;if("Ok"===e.Flash&&"Done"===e.ProgrammerStatus)return Ss(5e3).subscribe(function(){return t.uploading.next({status:t.UPLOAD_DONE,msg:e.Flash})});switch(e.ProgrammerStatus){case"Starting":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"Programming with: ".concat(e.Cmd)});break;case"Busy":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:e.Msg});break;case"Error":this.uploading.next({status:this.UPLOAD_ERROR,err:e.Msg});break;case"Killed":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"terminated by user"}),this.uploading.next({status:this.UPLOAD_ERROR,err:"terminated by user"});break;case"Error 404 Not Found":this.uploading.next({status:this.UPLOAD_ERROR,err:e.Msg});break;default:this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:e.Msg})}}},{key:"handleDownloadMessage",value:function(e){switch(e.DownloadStatus){case"Pending":this.downloading.next({status:this.DOWNLOAD_IN_PROGRESS,msg:e.Msg});break;case"Success":this.downloading.next({status:this.DOWNLOAD_DONE,msg:e.Msg});break;case"Error":this.downloading.next({status:this.DOWNLOAD_ERROR,err:e.Msg});break;default:this.downloading.next({status:this.DOWNLOAD_IN_PROGRESS,msg:e.Msg})}}},{key:"daemonUpload",value:function(e){var t=this;fetch("".concat(this.pluginURL,"/upload"),{method:"POST",body:JSON.stringify(e)}).then(function(e){e.ok||t.uploading.next({status:t.UPLOAD_ERROR,err:e.statusText})}).catch(function(e){t.uploading.next({status:t.UPLOAD_ERROR,err:e})})}},{key:"_upload",value:function(e,t){var n=this,r=[];Array.isArray(t.tools)&&t.tools.forEach(function(e){n.v2?(n.downloading.next({status:n.DOWNLOAD_IN_PROGRESS}),r.push(n.v2.installTool(e).then(function(){n.downloading.next({status:n.DOWNLOAD_DONE})}))):n.downloadTool(e.name,e.version,e.packager)});var s=b(b({},e),{},{extra:b(b({},e.extra),{},{wait_for_upload_port:"true"===t.options.wait_for_upload_port||!0===t.options.wait_for_upload_port,use_1200bps_touch:"true"===t.options.use_1200bps_touch||!0===t.options.use_1200bps_touch}),extrafiles:t.files||[]});s.extra.network||(s.signature=t.signature),Promise.all(r).then(function(){n.serialMonitorOpened.pipe(Os(function(e){return!e})).pipe(Ms()).subscribe(function(){n.daemonUpload(s)})}),this.downloadingError.subscribe(function(e){return n.uploading.next({status:n.UPLOAD_ERROR,err:e})})}},{key:"uploadNetwork",value:function(e,t,n){this.uploading.next({status:this.UPLOAD_IN_PROGRESS});var r=b(b({},e),{},{filename:"".concat(t,".hex"),hex:n.hex});this.daemonUpload(r)}},{key:"uploadConnector",value:function(e,t,n,r){this.uploading.next({status:this.UPLOAD_IN_PROGRESS});var s=b(b({},e),{},{commandline:r.commandline,signature:r.signature,filename:t,hex:n});this.daemonUpload(s)}},{key:"downloadTool",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"keep";this.downloading.next({status:this.DOWNLOAD_IN_PROGRESS}),this.socket.emit("command","downloadtool ".concat(e," ").concat(t," ").concat(n," ").concat(r))}},{key:"stopUploadCommand",value:function(){this.uploading.next({status:this.UPLOAD_ERROR,err:"upload stopped"}),this.socket.emit("command","killupload")}},{key:"disable",value:function(){this.disabled=!0}},{key:"enable",value:function(){this.disable=!1,this.findAgent()}}]),n}(),Qs=function(e){E(n,Ws);var t=C(n);function n(e,r){var s;return v(this,n),(s=t.call(this,e)).port=null,s.channelOpenStatus.next(!0),s.channel=r,s.connectedPorts=[],s.init(),s}return w(n,[{key:"init",value:function(){var e=this;this.agentFound.pipe(Ps()).subscribe(function(t){t?e.openChannel(function(){return e.channel.postMessage({command:"listPorts"})}):(null===e.channelOpen.getValue()&&e.channelOpen.next(!1),e.connectToChannel())})}},{key:"connectToChannel",value:function(){var e=this;this.channel.onMessage(function(t){t.version?(e.agentInfo=t.version,e.agentFound.next(!0),e.channelOpen.next(!0)):e.appMessages.next(t)}),this.channel.onDisconnect(function(){e.channelOpen.next(!1),e.agentFound.next(!1)})}},{key:"_appConnect",value:function(){var e=this;this.channel.onMessage(function(t){t.version?(e.agentInfo={version:t.version,os:"ChromeOS"},e.agentFound.next(!0),e.channelOpen.next(!0)):e.appMessages.next(t)}),this.channel.onDisconnect(function(){e.channelOpen.next(!1),e.agentFound.next(!1)})}},{key:"handleAppMessage",value:function(e){e.ports?this.handleListMessage(e):e.supportedBoards&&this.supportedBoards.next(e.supportedBoards),e.serialData&&this.serialMonitorMessages.next(e.serialData),e.uploadStatus&&this.handleUploadMessage(e),e.err&&this.uploading.next({status:this.UPLOAD_ERROR,err:e.Err})}},{key:"handleUploadMessage",value:function(e){if(this.uploading.getValue().status===this.UPLOAD_IN_PROGRESS)switch(e.uploadStatus){case"message":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:e.message,operation:e.operation,port:e.port});break;case"error":this.uploading.next({status:this.UPLOAD_ERROR,err:e.message});break;case"success":this.uploading.next({status:this.UPLOAD_DONE,msg:e.message,operation:e.operation,port:e.port});break;default:this.uploading.next({status:this.UPLOAD_IN_PROGRESS})}}},{key:"handleListMessage",value:function(e){var t=this.devicesList.getValue();Ws.devicesListAreEquals(t.serial,e.ports)||this.devicesList.next({serial:e.ports.map(function(e){return{Name:e.name,SerialNumber:e.serialNumber,IsOpen:e.isOpen,VendorID:e.vendorId,ProductID:e.productId}}),network:[]})}},{key:"closeAllPorts",value:function(){console.log("should be closing serial ports here")}},{key:"openSerialMonitor",value:function(e,t){var n=this;if(!this.serialMonitorOpened.getValue()){if(!this.devicesList.getValue().serial.find(function(t){return t.Name===e}))return this.serialMonitorError.next("Can't find port ".concat(e));this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(e){return e})))).subscribe(function(t){"success"===t.portOpenStatus&&n.serialMonitorOpened.next(!0),"error"===t.portOpenStatus&&n.serialMonitorError.next("Failed to open serial ".concat(e))}),this.channel.postMessage({command:"openPort",data:{name:e,baudrate:t}})}}},{key:"closeSerialMonitor",value:function(e){var t=this;if(this.serialMonitorOpened.getValue()){if(!this.devicesList.getValue().serial.find(function(t){return t.Name===e}))return this.serialMonitorError.next("Can't find port ".concat(e));this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(e){return!e})))).subscribe(function(n){"success"===n.portCloseStatus&&t.serialMonitorOpened.next(!1),"error"===n.portCloseStatus&&t.serialMonitorError.next("Failed to close serial ".concat(e))}),this.channel.postMessage({command:"closePort",data:{name:e}})}}},{key:"cdcReset",value:function(e){var t=e.fqbn,n=e.port;this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"CDC reset started"}),this.channel.postMessage({command:"cdcReset",data:{fqbn:t,port:n}})}},{key:"connectToSerialDevice",value:function(e){var t=e.fqbn;this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"Board selection started"}),this.channel.postMessage({command:"connectToSerial",data:{fqbn:t}})}},{key:"_upload",value:function(e,t){var n=this,r=e.board,s=e.port,o=e.commandline,i=e.data,a=e.pid,c=e.vid,u=t&&t.files&&Array.isArray(t.files)?t.files:[];try{window.oauth.getAccessToken().then(function(e){n.channel.postMessage({command:"upload",data:{board:r,port:s,commandline:o,data:i,token:e.token,extrafiles:u,pid:a,vid:c}})})}catch(e){this.uploading.next({status:this.UPLOAD_ERROR,err:"you need to be logged in on a Create site to upload by Chrome App"})}}}]),n}(),Zs=function(e){E(n,Ws);var t=C(n);function n(e,r){var s;return v(this,n),(s=t.call(this,e)).chromeExtensionId=r,s.channel=null,s.init(),s}return w(n,[{key:"init",value:function(){var e=this;this.openChannel(function(){return e.channel.postMessage({command:"listPorts"})}),this.agentFound.pipe(Ps()).subscribe(function(t){t||e.findApp()})}},{key:"findApp",value:function(){var e=this;_s(2e3).pipe(Is(0)).pipe(Us(this.channelOpen.pipe(Os(function(e){return e})))).subscribe(function(){return e._appConnect()})}},{key:"_appConnect",value:function(){var e=this;chrome.runtime&&(this.channel=chrome.runtime.connect(this.chromeExtensionId),this.channel.onMessage.addListener(function(t){t.version?(e.agentInfo=t,e.agentFound.next(!0),e.channelOpen.next(!0)):e.appMessages.next(t)}),this.channel.onDisconnect.addListener(function(){e.channelOpen.next(!1),e.agentFound.next(!1)}))}},{key:"handleAppMessage",value:function(e){e.ports&&this.handleListMessage(e),e.supportedBoards&&this.supportedBoards.next(e.supportedBoards),e.serialData&&this.serialMonitorMessages.next(e.serialData),e.uploadStatus&&this.handleUploadMessage(e),e.err&&this.uploading.next({status:this.UPLOAD_ERROR,err:e.Err})}},{key:"handleListMessage",value:function(e){var t=this.devicesList.getValue();Ws.devicesListAreEquals(t.serial,e.ports)||this.devicesList.next({serial:e.ports.map(function(e){return{Name:e.name,SerialNumber:e.serialNumber,IsOpen:e.isOpen,VendorID:e.vendorId,ProductID:e.productId}}),network:[]})}},{key:"closeAllPorts",value:function(){var e=this;this.devicesList.getValue().serial.forEach(function(t){e.channel.postMessage({command:"closePort",data:{name:t.Name}})})}},{key:"writeSerial",value:function(e,t){this.channel.postMessage({command:"writePort",data:{name:e,data:t}})}},{key:"openSerialMonitor",value:function(e,t){var n=this;if(!this.serialMonitorOpened.getValue()){if(!this.devicesList.getValue().serial.find(function(t){return t.Name===e}))return this.serialMonitorError.next("Can't find port ".concat(e));this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(e){return e})))).subscribe(function(t){"success"===t.portOpenStatus&&n.serialMonitorOpened.next(!0),"error"===t.portOpenStatus&&n.serialMonitorError.next("Failed to open serial ".concat(e))}),this.channel.postMessage({command:"openPort",data:{name:e,baudrate:t}})}}},{key:"closeSerialMonitor",value:function(e){var t=this;if(this.serialMonitorOpened.getValue()){if(!this.devicesList.getValue().serial.find(function(t){return t.Name===e}))return this.serialMonitorError.next("Can't find port ".concat(e));this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(e){return!e})))).subscribe(function(n){"success"===n.portCloseStatus&&t.serialMonitorOpened.next(!1),"error"===n.portCloseStatus&&t.serialMonitorError.next("Failed to close serial ".concat(e))}),this.channel.postMessage({command:"closePort",data:{name:e}})}}},{key:"handleUploadMessage",value:function(e){if(this.uploading.getValue().status===this.UPLOAD_IN_PROGRESS)switch(e.uploadStatus){case"message":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:e.message});break;case"error":this.uploading.next({status:this.UPLOAD_ERROR,err:e.message});break;case"success":this.uploading.next({status:this.UPLOAD_DONE,msg:e.message});break;default:this.uploading.next({status:this.UPLOAD_IN_PROGRESS})}}},{key:"_upload",value:function(e,t){var n=this,r=e.board,s=e.port,o=e.commandline,i=e.data,a=t&&t.files&&Array.isArray(t.files)?t.files:[];try{window.oauth.token().then(function(e){n.channel.postMessage({command:"upload",data:{board:r,port:s,commandline:o,data:i,token:e.token,extrafiles:a}})})}catch(e){this.uploading.next({status:this.UPLOAD_ERROR,err:"you need to be logged in on a Create site to upload by Chrome App"})}}},{key:"downloadTool",value:function(){this.downloading.next({status:this.DOWNLOAD_DONE})}}]),n}();var eo=Object.freeze({GET_FIRMWARE_INFO:"5aae0c2b9cfa783ab6d791491b6ebcb7ffb69644dcc8984def2a5f69029a46701dc8c95fc38a60efebb78c2802b6d172d7f38852b44ae1d2697c0211b6ac389f574c4ff85593ccae55e7c8c415f8d07f932fc64aec620ddb925dbd97b77cf395b9929911b6d4c40b8d3d5a4720a0613fe301344a45f505a430c956a527831896b42fddd0f737d630a3dc3714ce421bd30e9229b2ed503667a915bfc696b6221759640ff492e37356ef025ba9802d578227b8f15fd0f647c395bf73a84adf7a57281c31bc743ca92c09f8eec64d428acd25ced8f8420fdbf989db3625662970d3f16693fec44a418e8c7b12e9f4e94d353e4d6f6876bd74fc543eaeba20a09dc6",UPLOAD_FIRMWARE_BOSSAC:"a965a14ec42c35a67f8d2f3f5235aaacbcc1b998b367d07a02d12992ec691f1723d00f0c3c1c64566e10823cca4947d7dd91e9ba4b28dffc112953f4ccf230adca274133f14ab3a13697c932c6c19ba05b4cd6d93141a31977ce7a53b253d761e2a503f55599a03605264d32e31c938966041709a824e64ddb0a2371e68c8d298dcd93cc8d451b8df1a7c1244e30b310fb10ec13448df3238bd0db5be0d1ec938b82b7c4f81262155c75b805700d0ff20b0404e27142014a2d74c3db677f32854dcda9052ccad9028e16cfb5151c09763e93a3a285be226dac849c519d79301962488c92723781d6a2063ee0021fa9f2c8d2dfcb7a6f01bcb4dbcd6b9f0d6322",UPLOAD_FIRMWARE_AVRDUDE:"67e99fc73b0c9359219d30c11851d728a5e5559426c0151518aa947b48af3f58de4d0997143cad18bc1a2f6ae22863baab2e8b0de6fff549185f3dc82cbcce44690e0c50a92cebf0bd4377ae85f3961330c5fda40f3a567242eb74fe3d937b1abfe8be77a9fd658eed1a765bbc264702577fdd63da8d3073dd36dcdd37dc5762b162e18c284715012c1f303c77475703a5c8ef8bfc685e1650eb26058016d771bd4f53929a51666aef70126aabda80431671eb2ba9b729ee166079abac806567b9ae63ce2801f88964250596b8450fda112ac43b868634b91cb59d91d13c286d3ec19eb4a840d3af89413d24b198e2da616cb2bbff45cc58645aa1b1d52f71bf",UPLOAD_FIRMWARE_RP2040:"422df04bfb4fc0eea4df716b3d9b075558c6094a2953795cf0f9cfdc58e97f9df80f51f8981d11e23a17fe1c220a164a87e24e1b10442cb6e06bda96737f1c30d7ef5928f4d926428a36ff4ea7d6cd379d2d755cda76f1fc9884628da519197007f9db1233401af387a6684f2a74855168f878d8c67239d99fdf7597379650cd9df6a56c430dc09ccc14fec3ceba56b9a0ab1e7b0a71cb9c9016ee3595a7d914e14d9f333a388aca31093ec77f347ceb0ed3f1d57861c7304bf53e45188ce3a976d294afd1e919496856b760dc708cb2db5cde585c44e8f023ad3ef2353edee5d172c2da936e321bbf11dec51779447534465df9c275eb391f1ada2c089ecb15"}),to=Object.freeze({GET_FIRMWARE_INFO:"aceffd98d331df0daa5bb3308bb49a95767d77e7a1557c07a0ec544d2f41c3ec67269f01ce9a63e01f3b43e087ab8eb22b7f1d34135b6686e8ce27d4b5dc083ec8e6149df11880d32486448a71280ef3128efccbd45a84dbd7990a9420a65ee86b3822edba3554fa8e6ca11aec12d4dd99ad072285b98bfdf7b2b64f677da50feb8bddef25a36f52d7605078487d8a5d7cbdc84bfa65d510cee97b46baefea149139a9a6ed4b545346040536e33d850e6ad84c83fe605f677e2ca77439de3fa42350ce504ad9a49cf62c6751d4c2a284500d2c628cd52cd73b4c3e7ef08ae823eb8941383f9c6ff0686da532369d3b266ded8fdd33cca1a128068a4795920f25",UPLOAD_FIRMWARE_BOSSAC:"b4fca4587e784952c53ad05bff80ed0b2880be885cb3f6bd9935864863cd36d3c9c26b30b2598727b03b1b409873fa2ce0560bf1933768d5ca45c64d5f0e5032b19146cba60d8f3aa2b19ba107be0c4fa592d86e44bc87f2330fc1c9995db0cc5ec884d8f294af5cbff3a81593849465eb0e4123e9b7ddb3be74b444bed40d539e724f9a41617f2e9c70b145c4a2688d47894319fd65d660ad7d8382fb56a455e28fa78042337d55f8b5ec4f2c16f3410d15c1551973eec2a80a1792c344f7835e2133f9279009a40054bf234f7bc194f7c18d0e6c7102d13823db1ad60d81b40e3e43f89eb26a0cc5fd9759286f11ba4b649829bda8a52d0013ee59e2df3b3b",UPLOAD_FIRMWARE_AVRDUDE:"38bb99d99e00d91166ef095477b24b7a52eda0685db819486a723ee09e84ea84422b7f6c973466e97b832c5afa54a84a6d2dfad17a38f8f91059c5f62212c2a3e8a887c63b3b679eb1c4c2e76f2f4e943d8bd59a5f21283c9a3a7a9b5584c14b8adfc881315bcc605d26bfe31c9b2dfa5979d501b2333963614337668f0303ef6ddd3ec72a39b448d38c6af501a1357c6b8527f27ca8a096b7bc0413b1cb5f504d44bd502cee59444c00fae11cc59c51ae8153e4e481fb58a3ee3a7f23447aa9aa368b8cc0d0d107b77b234a7528ab10cbb5dc09de874ef2a6bd427aa2f83f99faabd54b272c7df3922fa5439e54e9d8b2793bc5ce1c5979f3f5e5db03853f53"}),no=Object.freeze({NOPE:"NOPE",OK:"OK",CHECKING:"CHECKING",ERROR:"ERROR DOWNLOADING TOOL"}),ro=eo,so="FirmwareUploader";var oo=function(){function e(t){var n=this;v(this,e),this.updateStatusEnum=Object.freeze({NOPE:"NOPE",STARTED:"STARTED",GETTING_INFO:"GETTING_INFO",GOT_INFO:"GOT_INFO",UPLOADING:"UPLOADING",DONE:"DONE",ERROR:"ERROR"}),this.Daemon=t,this.FWUToolStatus=no.NOPE,this.Daemon.downloadingDone.subscribe(function(){n.FWUToolStatus=no.OK}),this.updating=new Vr({status:this.updateStatusEnum.NOPE}),this.updatingDone=this.updating.pipe(Os(function(e){return e.status===n.updateStatusEnum.DONE})).pipe(Ms()).pipe(Us(this.updating.pipe(Os(function(e){return e.status===n.updateStatusEnum.ERROR})))),this.updatingError=this.updating.pipe(Os(function(e){return e.status===n.updateStatusEnum.ERROR})).pipe(Ms()).pipe(Us(this.updatingDone)),this.gotFWInfo=this.updating.pipe(Os(function(e){return e.status===n.updateStatusEnum.GOT_INFO})).pipe(Ms()).pipe(Us(this.updatingDone)).pipe(Us(this.updatingError))}return w(e,[{key:"setToolVersion",value:function(e){this.toolVersion=e,0>mr(e,"0.1.2")&&(ro=to,so="updater")}},{key:"getFirmwareInfo",value:function(e,t,n){var r=this;this.firmwareVersionData=null,this.loaderPath=null,this.updating.next({status:this.updateStatusEnum.GETTING_INFO});var s,o=[];if(this.FWUToolStatus===no.OK){s=this.Daemon.appMessages.subscribe(function(t){t.ProgrammerStatus&&function(t){var i;switch(t.ProgrammerStatus){case"Starting":break;case"Busy":if(t.Msg.indexOf("Flashing with command:")>=0)return;i=JSON.parse(t.Msg),Object.keys(i).forEach(function(e){i[e][0].IsLoader?r.loaderPath=i[e][0].Path:o=[].concat(P(o),P(i[e]))}),r.firmwareVersionData=o.find(function(e){return e.Name.split(" ").splice(-1)[0].trim()===n}),r.firmwareVersionData?(s.unsubscribe(),r.updating.next({status:r.updateStatusEnum.GOT_INFO})):r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't get firmware info: couldn't find version '".concat(n,"' for board '").concat(e,"'")});break;case"Error":r.updating.next({status:r.updateStatusEnum.ERROR,err:"Couldn't get firmware info: ".concat(t.Msg)}),s.unsubscribe()}}(t)});var i={board:e,port:t,commandline:'"{runtime.tools.fwupdater.path}/'.concat(so,'" -get_available_for {network.password}'),signature:ro.GET_FIRMWARE_INFO,extra:{auth:{password:e}},filename:"ListFirmwareVersionsInfo.bin"};return fetch("".concat(this.Daemon.pluginURL,"/upload"),{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(i)}).then(function(e){e.ok||r.updating.next({status:r.updateStatusEnum.ERROR,err:"Error fetching ".concat(r.Daemon.pluginURL,"/upload")})}).catch(function(){r.updating.next({status:r.updateStatusEnum.ERROR,err:"Coudln't list firmware versions info."})})}this.updating.next({status:this.updateStatusEnum.ERROR,err:"Can't get firmware info: couldn't find firmware updater tool"})}},{key:"updateFirmware",value:function(e,t,n){var r=this;this.updating.next({status:this.updateStatusEnum.STARTED}),this.Daemon.closeSerialMonitor(t),this.Daemon.serialMonitorOpened.pipe(Os(function(e){return!e})).pipe(Ms()).subscribe(function(){t?(r.gotFWInfo.subscribe(function(){if(r.firmwareVersionData){var s;s=r.Daemon.appMessages.subscribe(function(e){e.ProgrammerStatus&&function(e){switch(e.ProgrammerStatus){case"Busy":0>e.Msg.indexOf("Operation completed: success! :-)")||(r.updating.next({status:r.updateStatusEnum.DONE}),s.unsubscribe());break;case"Error":r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: ".concat(e.Msg)}),s.unsubscribe()}}(e)});var o=R(function(e){return"uno2018"===e?["{runtime.tools.avrdude}/bin/avrdude",ro.UPLOAD_FIRMWARE_AVRDUDE]:"nanorp2040connect"===e?["{runtime.tools.rp2040tools.path}/rp2040load",ro.UPLOAD_FIRMWARE_RP2040]:["{runtime.tools.bossac}/bossac",ro.UPLOAD_FIRMWARE_BOSSAC]}(e),2),i=o[0],a=o[1];if(r.loaderPath){var c={board:e,port:t,commandline:'"{runtime.tools.fwupdater.path}/'.concat(so,'" -flasher {network.password} -port {serial.port} -programmer "').concat(i,'"'),hex:"",extra:{auth:{password:'"'.concat(r.loaderPath,'" -firmware "').concat(r.firmwareVersionData.Path,'"')}},signature:a,filename:"CheckFirmwareVersion.bin"};fetch("".concat(r.Daemon.pluginURL,"/upload"),{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(c)}).then(function(e){e.ok||r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: error fetching ".concat(r.Daemon.pluginURL,"/upload")})}).catch(function(e){r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: ".concat(e)})})}else r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: 'loaderPath' is empty or 'null'"})}else r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: couldn't find version '".concat(n,"' for board '").concat(e,"'")})}),r.getFirmwareInfo(e,t,n)):r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: no port selected."})})}}]),e}(),io=-1!==window.navigator.userAgent.indexOf(" CrOS ")?function(e,t){var n,r,s,o=this;return"string"==typeof t?r=t:(r=t.chromeExtensionId,n=t.useWebSerial,s=t.uploader),"serial"in navigator&&n&&s?(console.debug("Instantiating WebSerialDaemon"),this.flavour=new Qs(e,s)):(console.debug("Instantiating ChromeAppDaemon"),this.flavour=new Zs(e,r)),new Proxy(this,{get:function(e,t){return o.flavour[t]},set:function(e,t,n){return o.flavour[t]=n,!0}})}:Ks;e.FirmwareUpdater=oo,e.default=io,Object.defineProperty(e,"__esModule",{value:!0})});
