!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("tty"),require("util"),require("os"),require("fs"),require("url"),require("child_process"),require("http"),require("https"),require("events"),require("crypto"),require("net"),require("tls"),require("zlib"),require("bufferutil"),require("stream"),require("utf-8-validate")):"function"==typeof define&&define.amd?define(["exports","tty","util","os","fs","url","child_process","http","https","events","crypto","net","tls","zlib","bufferutil","stream","utf-8-validate"],e):e((t=t||self).CreatePlugin={},t.tty,t.util,t.os,t.fs,t.url$1,t.child_process,t.http,t.https,t.events,t.crypto,t.net,t.tls,t.zlib,t.bufferutil,t.stream,t.utf8Validate)}(this,function(t,e,n,r,s,o,i,a,c,u,h,p,l,f,d,y,b){"use strict";function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function g(t){for(var e=1;arguments.length>e;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach(function(e){O(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e,n){return e&&_(t.prototype,e),n&&_(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function O(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function E(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e)}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var n,r=k(t);if(e){var s=k(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return x(this,n)}}function R(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,s,o=[],i=!0,a=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);i=!0);}catch(t){a=!0,s=t}finally{try{i||null==n.return||n.return()}finally{if(a)throw s}}return o}(t,e)||A(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||A(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(t,e){if(t){if("string"==typeof t)return T(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(t,e):void 0}}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=[];e>n;n++)r[n]=t[n];return r}e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r,s=s&&s.hasOwnProperty("default")?s.default:s,o=o&&o.hasOwnProperty("default")?o.default:o,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,c=c&&c.hasOwnProperty("default")?c.default:c,u=u&&u.hasOwnProperty("default")?u.default:u,h=h&&h.hasOwnProperty("default")?h.default:h,p=p&&p.hasOwnProperty("default")?p.default:p,l=l&&l.hasOwnProperty("default")?l.default:l,f=f&&f.hasOwnProperty("default")?f.default:f,d=d&&d.hasOwnProperty("default")?d.default:d,y=y&&y.hasOwnProperty("default")?y.default:y,b=b&&b.hasOwnProperty("default")?b.default:b;var N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function D(t,e){return t(e={exports:{}},e.exports),e.exports}var L=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,F=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],B=function(t){var e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));for(var s=L.exec(t||""),o={},i=14;i--;)o[F[i]]=s[i]||"";return-1!=n&&-1!=r&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o},I=1e3,M=60*I,U=60*M,j=24*U,q=7*j,W=365.25*j,V=function(t,e){e=e||{};var n=typeof t;if("string"===n&&t.length>0)return function(t){if((t+="").length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*W;case"weeks":case"week":case"w":return n*q;case"days":case"day":case"d":return n*j;case"hours":case"hour":case"hrs":case"hr":case"h":return n*U;case"minutes":case"minute":case"mins":case"min":case"m":return n*M;case"seconds":case"second":case"secs":case"sec":case"s":return n*I;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===n&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=j)return $(t,e,j,"day");if(e>=U)return $(t,e,U,"hour");if(e>=M)return $(t,e,M,"minute");if(e>=I)return $(t,e,I,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=j)return Math.round(t/j)+"d";if(e>=U)return Math.round(t/U)+"h";if(e>=M)return Math.round(t/M)+"m";if(e>=I)return Math.round(t/I)+"s";return t+"ms"}(t);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function $(t,e,n,r){var s=e>=1.5*n;return Math.round(t/n)+" "+r+(s?"s":"")}var H=function(t){function e(t){let e=0;for(let n=0;t.length>n;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){let o;function i(...t){if(!i.enabled)return;const e=i,r=+new Date;e.diff=r-(o||r),e.prev=o,e.curr=r,o=r,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let s=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;s++;const i=n.formatters[o];return"function"==typeof i&&(r=i.call(e,t[s]),t.splice(s,1),s--),r}),n.formatArgs.call(e,t),(e.log||n.log).apply(e,t)}return i.namespace=t,i.enabled=n.enabled(t),i.useColors=n.useColors(),i.color=e(t),i.destroy=r,i.extend=s,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function r(){const t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function s(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function o(t){return(""+t).substring(2,(""+t).length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){return t instanceof Error?t.stack||t.message:t},n.disable=function(){const t=[...n.names.map(o),...n.skips.map(o).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),s=r.length;for(e=0;s>e;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(RegExp("^"+t.substr(1)+"$")):n.names.push(RegExp("^"+t+"$")));for(e=0;n.instances.length>e;e++){const t=n.instances[e];t.enabled=n.enabled(t.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;r>e;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;r>e;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=V,Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n},G=D(function(t,e){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,s=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(r++,"%c"===t&&(s=r))}),e.splice(s,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=H(e);const{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}),z=(t,e)=>{e=e||process.argv;const n=t.startsWith("-")?"":1===t.length?"-":"--",r=e.indexOf(n+t),s=e.indexOf("--");return-1!==r&&(-1===s||s>r)};const Y=process.env;let X;function J(t){return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function(t){if(!1===X)return 0;if(z("color=16m")||z("color=full")||z("color=truecolor"))return 3;if(z("color=256"))return 2;if(t&&!t.isTTY&&!0!==X)return 0;const e=X?1:0;if("win32"===process.platform){const t=r.release().split(".");return 8>+process.versions.node.split(".")[0]||10>+t[0]||10586>+t[2]?1:14931>+t[2]?2:3}if("CI"in Y)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Y)||"codeship"===Y.CI_NAME?1:e;if("TEAMCITY_VERSION"in Y)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Y.TEAMCITY_VERSION)?1:0;if("truecolor"===Y.COLORTERM)return 3;if("TERM_PROGRAM"in Y){const t=parseInt((Y.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Y.TERM_PROGRAM){case"iTerm.app":return 3>t?2:3;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Y.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Y.TERM)?1:"COLORTERM"in Y?1:e}(t))}z("no-color")||z("no-colors")||z("color=false")?X=!1:(z("color")||z("colors")||z("color=true")||z("color=always"))&&(X=!0),"FORCE_COLOR"in Y&&(X=0===Y.FORCE_COLOR.length||0!==parseInt(Y.FORCE_COLOR,10));var K={supportsColor:J,stdout:J(process.stdout),stderr:J(process.stderr)},Q=D(function(t,r){r.init=function(t){t.inspectOpts={};const e=Object.keys(r.inspectOpts);for(let n=0;e.length>n;n++)t.inspectOpts[e[n]]=r.inspectOpts[e[n]]},r.log=function(...t){return process.stderr.write(n.format(...t)+"\n")},r.formatArgs=function(e){const{namespace:n,useColors:s}=this;if(s){const r=this.color,s="[3"+(8>r?r:"8;5;"+r),o=`  ${s};1m${n} [0m`;e[0]=o+e[0].split("\n").join("\n"+o),e.push(s+"m+"+t.exports.humanize(this.diff)+"[0m")}else e[0]=function(){if(r.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+n+" "+e[0]},r.save=function(t){t?process.env.DEBUG=t:delete process.env.DEBUG},r.load=function(){return process.env.DEBUG},r.useColors=function(){return"colors"in r.inspectOpts?!!r.inspectOpts.colors:e.isatty(process.stderr.fd)},r.colors=[6,2,3,4,5,1];try{const t=K;t&&(t.stderr||t).level>=2&&(r.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(t){}r.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{const n=e.substring(6).toLowerCase().replace(/_([a-z])/g,(t,e)=>e.toUpperCase());let r=process.env[e];return t[n]=r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:+r),t},{}),t.exports=H(r);const{formatters:s}=t.exports;s.o=function(t){return this.inspectOpts.colors=this.useColors,n.inspect(t,this.inspectOpts).replace(/\s*\n\s*/g," ")},s.O=function(t){return this.inspectOpts.colors=this.useColors,n.inspect(t,this.inspectOpts)}}),Z=D(function(t){t.exports="undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?G:Q}),tt=Z("socket.io-client:url"),et=function(t,e){var n=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host);"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(tt("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),tt("parse %s",t),n=B(t));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(e&&e.port===n.port?"":":"+n.port),n};var nt=1e3,rt=60*nt,st=60*rt,ot=24*st,it=365.25*ot,at=function(t,e){e=e||{};var n,r=typeof t;if("string"===r&&t.length>0)return function(t){if((t+="").length>100)return;var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*it;case"days":case"day":case"d":return n*ot;case"hours":case"hour":case"hrs":case"hr":case"h":return n*st;case"minutes":case"minute":case"mins":case"min":case"m":return n*rt;case"seconds":case"second":case"secs":case"sec":case"s":return n*nt;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===r&&!1===isNaN(t))return e.long?ct(n=t,ot,"day")||ct(n,st,"hour")||ct(n,rt,"minute")||ct(n,nt,"second")||n+" ms":function(t){if(t>=ot)return Math.round(t/ot)+"d";if(t>=st)return Math.round(t/st)+"h";if(t>=rt)return Math.round(t/rt)+"m";if(t>=nt)return Math.round(t/nt)+"s";return t+"ms"}(t);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function ct(t,e,n){if(t>=e)return 1.5*e>t?Math.floor(t/e)+" "+n:Math.ceil(t/e)+" "+n+"s"}var ut=D(function(t,e){function n(t){var n;function s(){if(s.enabled){var t=s,r=+new Date;t.diff=r-(n||r),t.prev=n,t.curr=r,n=r;for(var o=[],i=0;o.length>i;i++)o[i]=arguments[i];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(n,r){if("%%"===n)return n;a++;var s=e.formatters[r];"function"==typeof s&&(n=s.call(t,o[a]),o.splice(a,1),a--);return n}),e.formatArgs.call(t,o),(s.log||e.log||console.log.bind(console)).apply(t,o)}}return s.namespace=t,s.enabled=e.enabled(t),s.useColors=e.useColors(),s.color=function(t){var n,r=0;for(n in t)r=(r<<5)-r+t.charCodeAt(n),r|=0;return e.colors[Math.abs(r)%e.colors.length]}(t),s.destroy=r,"function"==typeof e.init&&e.init(s),e.instances.push(s),s}function r(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=n.debug=n.default=n).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var r=("string"==typeof t?t:"").split(/[\s,]+/),s=r.length;for(n=0;s>n;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(RegExp("^"+t.substr(1)+"$")):e.names.push(RegExp("^"+t+"$")));for(n=0;e.instances.length>n;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,r;for(n=0,r=e.skips.length;r>n;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;r>n;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=at,e.instances=[],e.names=[],e.skips=[],e.formatters={}}),ht=D(function(t,e){function n(){var t;try{t=e.storage.debug}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t}(e=t.exports=ut).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+t[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!n)return;var r="color: "+this.color;t.splice(1,0,r,"color: inherit");var s=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(s++,"%c"===t&&(o=s))}),t.splice(o,0,r)},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=n,e.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(n())}),pt=D(function(t,r){(r=t.exports=ut).init=function(t){t.inspectOpts={};for(var e=Object.keys(r.inspectOpts),n=0;e.length>n;n++)t.inspectOpts[e[n]]=r.inspectOpts[e[n]]},r.log=function(){return process.stderr.write(n.format.apply(n,arguments)+"\n")},r.formatArgs=function(t){var e=this.namespace;if(this.useColors){var n=this.color,s="[3"+(8>n?n:"8;5;"+n),o="  "+s+";1m"+e+" [0m";t[0]=o+t[0].split("\n").join("\n"+o),t.push(s+"m+"+r.humanize(this.diff)+"[0m")}else t[0]=(r.inspectOpts.hideDate?"":(new Date).toISOString()+" ")+e+" "+t[0]},r.save=function(t){null==t?delete process.env.DEBUG:process.env.DEBUG=t},r.load=s,r.useColors=function(){return"colors"in r.inspectOpts?!!r.inspectOpts.colors:e.isatty(process.stderr.fd)},r.colors=[6,2,3,4,5,1];try{K&&K.level>=2&&(r.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(t){}function s(){return process.env.DEBUG}r.inspectOpts=Object.keys(process.env).filter(function(t){return/^debug_/i.test(t)}).reduce(function(t,e){var n=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(t,e){return e.toUpperCase()}),r=process.env[e];return t[n]=r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:+r),t},{}),r.formatters.o=function(t){return this.inspectOpts.colors=this.useColors,n.inspect(t,this.inspectOpts).split("\n").map(function(t){return t.trim()}).join(" ")},r.formatters.O=function(t){return this.inspectOpts.colors=this.useColors,n.inspect(t,this.inspectOpts)},r.enable(s())}),lt=D(function(t){t.exports="undefined"==typeof process||"renderer"===process.type?ht:pt}),ft=D(function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;r.length>s;s++)if((n=r[s])===e||n.fn===e){r.splice(s,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=[],n=this._callbacks["$"+t],r=1;arguments.length>r;r++)e[r-1]=arguments[r];if(n){r=0;for(var s=(n=n.slice(0)).length;s>r;++r)n[r].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),dt={}.toString,yt=Array.isArray||function(t){return"[object Array]"==dt.call(t)},bt=function(t){return mt&&Buffer.isBuffer(t)||gt&&(t instanceof ArrayBuffer||vt(t))},mt="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,gt="function"==typeof ArrayBuffer,vt=function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer};var _t=Object.prototype.toString,wt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===_t.call(Blob),Ot="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===_t.call(File);var Et={deconstructPacket:function(t){var e=[],n=t;return n.data=function t(e,n){if(!e)return e;if(bt(e)){var r={_placeholder:!0,num:n.length};return n.push(e),r}if(yt(e)){for(var s=[],o=0;e.length>o;o++)s[o]=t(e[o],n);return s}if("object"==typeof e&&!(e instanceof Date)){var s={};for(var i in e)s[i]=t(e[i],n);return s}return e}(t.data,e),n.attachments=e.length,{packet:n,buffers:e}},reconstructPacket:function(t,e){return t.data=function t(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(yt(e))for(var r=0;e.length>r;r++)e[r]=t(e[r],n);else if("object"==typeof e)for(var s in e)e[s]=t(e[s],n);return e}(t.data,e),t.attachments=void 0,t},removeBlobs:function(t,e){var n=0,r=t;!function t(s,o,i){if(!s)return s;if(wt&&s instanceof Blob||Ot&&s instanceof File){n++;var a=new FileReader;a.onload=function(){i?i[o]=this.result:r=this.result,--n||e(r)},a.readAsArrayBuffer(s)}else if(yt(s))for(var c=0;s.length>c;c++)t(s[c],c,s);else if("object"==typeof s&&!bt(s))for(var u in s)t(s[u],u,s)}(r),n||e(r)}},kt=D(function(t,e){var n=lt("socket.io-parser");function r(){}e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=r,e.Decoder=i;var s=e.ERROR+'"encode error"';function o(t){var r=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(r+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(r+=t.nsp+","),null!=t.id&&(r+=t.id),null!=t.data){var o=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===o)return s;r+=o}return n("encoded %j as %s",t,r),r}function i(){this.reconstructor=null}function a(t){this.reconPack=t,this.buffers=[]}function c(t){return{type:e.ERROR,data:"parser error: "+t}}r.prototype.encode=function(t,r){(n("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)?function(t,e){Et.removeBlobs(t,function(t){var n=Et.deconstructPacket(t),r=o(n.packet),s=n.buffers;s.unshift(r),e(s)})}(t,r):r([o(t)])},ft(i.prototype),i.prototype.add=function(t){var r;if("string"==typeof t)r=function(t){var r=0,s={type:+t.charAt(0)};if(null==e.types[s.type])return c("unknown packet type "+s.type);if(e.BINARY_EVENT===s.type||e.BINARY_ACK===s.type){for(var o=r+1;"-"!==t.charAt(++r)&&r!=t.length;);var i=t.substring(o,r);if(i!=+i||"-"!==t.charAt(r))throw Error("Illegal attachments");s.attachments=+i}if("/"===t.charAt(r+1)){for(var o=r+1;++r;){var a=t.charAt(r);if(","===a)break;if(r===t.length)break}s.nsp=t.substring(o,r)}else s.nsp="/";var u=t.charAt(r+1);if(""!==u&&+u==u){for(var o=r+1;++r;){var a=t.charAt(r);if(null==a||+a!=a){--r;break}if(r===t.length)break}s.id=+t.substring(o,r+1)}if(t.charAt(++r)){var h=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(r)),p=!1!==h&&(s.type===e.ERROR||yt(h));if(!p)return c("invalid payload");s.data=h}return n("decoded %s as %j",t,s),s}(t),e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type?(this.reconstructor=new a(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!bt(t)&&!t.base64)throw Error("Unknown type: "+t);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",r))}},i.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=Et.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}),St=i.spawn,xt=Ct;function Ct(t){t=t||{};var e,n,r=this,i=a,u=c,h={},p=!1,l={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},f=Object.assign({},l),d=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],y=["TRACE","TRACK","CONNECT"],b=!1,m=!1,g={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.status=null,this.statusText=null;this.open=function(t,e,n,r,s){if(this.abort(),m=!1,!function(t){return t&&-1===y.indexOf(t)}(t))throw"SecurityError: Request method not allowed";h={method:t,url:""+e,async:"boolean"!=typeof n||n,user:r||null,password:s||null},v(this.OPENED)},this.setDisableHeaderCheck=function(t){p=t},this.setRequestHeader=function(t,e){if(this.readyState!=this.OPENED)throw"INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN";if(!function(t){return p||t&&-1===d.indexOf(t.toLowerCase())}(t))return console.warn('Refused to set unsafe header "'+t+'"'),!1;if(b)throw"INVALID_STATE_ERR: send flag is true";return f[t]=e,!0},this.getResponseHeader=function(t){return"string"==typeof t&&this.readyState>this.OPENED&&n.headers[t.toLowerCase()]&&!m?n.headers[t.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.HEADERS_RECEIVED>this.readyState||m)return"";var t="";for(var e in n.headers)"set-cookie"!==e&&"set-cookie2"!==e&&(t+=e+": "+n.headers[e]+"\r\n");return t.substr(0,t.length-2)},this.getRequestHeader=function(t){return"string"==typeof t&&f[t]?f[t]:""},this.send=function(a){if(this.readyState!=this.OPENED)throw"INVALID_STATE_ERR: connection must be opened before send() is called";if(b)throw"INVALID_STATE_ERR: send has already been called";var c,p=!1,l=!1,d=o.parse(h.url);switch(d.protocol){case"https:":p=!0;case"http:":c=d.hostname;break;case"file:":l=!0;break;case void 0:case"":c="localhost";break;default:throw"Protocol not supported."}if(l){if("GET"!==h.method)throw"XMLHttpRequest: Only GET method is supported";if(h.async)s.readFile(d.pathname,"utf8",function(t,e){t?r.handleError(t):(r.status=200,r.responseText=e,v(r.DONE))});else try{this.responseText=s.readFileSync(d.pathname,"utf8"),this.status=200,v(r.DONE)}catch(t){this.handleError(t)}}else{var y=d.port||(p?443:80),g=d.pathname+(d.search?d.search:"");if(f.Host=c,p&&443===y||80===y||(f.Host+=":"+d.port),h.user){void 0===h.password&&(h.password="");var _=new Buffer(h.user+":"+h.password);f.Authorization="Basic "+_.toString("base64")}"GET"===h.method||"HEAD"===h.method?a=null:a?(f["Content-Length"]=Buffer.isBuffer(a)?a.length:Buffer.byteLength(a),f["Content-Type"]||(f["Content-Type"]="text/plain;charset=UTF-8")):"POST"===h.method&&(f["Content-Length"]=0);var w={host:c,port:y,path:g,method:h.method,headers:f,agent:t.agent||!1};if(p&&(w.pfx=t.pfx,w.key=t.key,w.passphrase=t.passphrase,w.cert=t.cert,w.ca=t.ca,w.ciphers=t.ciphers,w.rejectUnauthorized=t.rejectUnauthorized),m=!1,h.async){var O=p?u.request:i.request;b=!0,r.dispatchEvent("readystatechange");var E=function(s){if(302===(n=s).statusCode||303===n.statusCode||307===n.statusCode){h.url=n.headers.location;var i=o.parse(h.url);c=i.hostname;var a={hostname:i.hostname,port:i.port,path:i.path,method:303===n.statusCode?"GET":h.method,headers:f};return p&&(a.pfx=t.pfx,a.key=t.key,a.passphrase=t.passphrase,a.cert=t.cert,a.ca=t.ca,a.ciphers=t.ciphers,a.rejectUnauthorized=t.rejectUnauthorized),void(e=O(a,E).on("error",k)).end()}n&&n.setEncoding&&n.setEncoding("utf8"),v(r.HEADERS_RECEIVED),r.status=n.statusCode,n.on("data",function(t){t&&(r.responseText+=t),b&&v(r.LOADING)}),n.on("end",function(){b&&(b=!1,v(r.DONE))}),n.on("error",function(t){r.handleError(t)})},k=function(t){r.handleError(t)};e=O(w,E).on("error",k),a&&e.write(a),e.end(),r.dispatchEvent("loadstart")}else{var S=".node-xmlhttprequest-content-"+process.pid,x=".node-xmlhttprequest-sync-"+process.pid;s.writeFileSync(x,"","utf8");for(var C="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(p?"s":"")+".request;var options = "+JSON.stringify(w)+";var responseText = '';var req = doRequest(options, function(response) {response.setEncoding('utf8');response.on('data', function(chunk) {  responseText += chunk;});response.on('end', function() {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-STATUS:' + response.statusCode + ',' + responseText, 'utf8');fs.unlinkSync('"+x+"');});response.on('error', function(error) {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+x+"');});}).on('error', function(error) {fs.writeFileSync('"+S+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+x+"');});"+(a?"req.write('"+a.replace(/'/g,"\\'")+"');":"")+"req.end();",R=St(process.argv[0],["-e",C]);s.existsSync(x););if(r.responseText=s.readFileSync(S,"utf8"),R.stdin.end(),s.unlinkSync(S),r.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var P=r.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,"");r.handleError(P)}else r.status=r.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1"),r.responseText=r.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"),v(r.DONE)}}},this.handleError=function(t){this.status=503,this.statusText=t,this.responseText=t.stack,m=!0,v(this.DONE)},this.abort=function(){e&&(e.abort(),e=null),f=Object.assign({},l),this.responseText="",this.responseXML="",m=!0,this.readyState===this.UNSENT||this.readyState===this.OPENED&&!b||this.readyState===this.DONE||(b=!1,v(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(t,e){t in g||(g[t]=[]),g[t].push(e)},this.removeEventListener=function(t,e){t in g&&(g[t]=g[t].filter(function(t){return t!==e}))},this.dispatchEvent=function(t){if("function"==typeof r["on"+t]&&r["on"+t](),t in g)for(var e=0,n=g[t].length;n>e;e++)g[t][e].call(r)};var v=function(t){r.readyState!==t&&(r.readyState=t,(h.async||r.OPENED>r.readyState||r.readyState===r.DONE)&&r.dispatchEvent("readystatechange"),r.readyState!==r.DONE||m||(r.dispatchEvent("load"),r.dispatchEvent("loadend")))}}Ct.XMLHttpRequest=Ct;var Rt,Pt,At,Tt=String.fromCharCode;function Nt(t){for(var e,n,r=[],s=0,o=t.length;o>s;)55296>(e=t.charCodeAt(s++))||e>56319||s>=o?r.push(e):56320==(64512&(n=t.charCodeAt(s++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),s--);return r}function Dt(t,e){if(t>=55296&&57343>=t){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Lt(t,e){return Tt(t>>e&63|128)}function Ft(t,e){if(0==(4294967168&t))return Tt(t);var n="";return 0==(4294965248&t)?n=Tt(t>>6&31|192):0==(4294901760&t)?(Dt(t,e)||(t=65533),n=Tt(t>>12&15|224),n+=Lt(t,6)):0==(4292870144&t)&&(n=Tt(t>>18&7|240),n+=Lt(t,12),n+=Lt(t,6)),n+=Tt(63&t|128)}function Bt(){if(At>=Pt)throw Error("Invalid byte index");var t=255&Rt[At];if(At++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function It(t){var e,n;if(At>Pt)throw Error("Invalid byte index");if(At==Pt)return!1;if(e=255&Rt[At],At++,0==(128&e))return e;if(192==(224&e)){if(128>(n=(31&e)<<6|Bt()))throw Error("Invalid continuation byte");return n}if(224==(240&e)){if(2048>(n=(15&e)<<12|Bt()<<6|Bt()))throw Error("Invalid continuation byte");return Dt(n,t)?n:65533}if(240==(248&e)&&(n=(7&e)<<18|Bt()<<12|Bt()<<6|Bt())>=65536&&1114111>=n)return n;throw Error("Invalid UTF-8 detected")}var Mt={version:"2.1.2",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,r=Nt(t),s=r.length,o=-1,i="";++o<s;)i+=Ft(r[o],n);return i},decode:function(t,e){var n=!1!==(e=e||{}).strict;Rt=Nt(t),Pt=Rt.length,At=0;for(var r,s=[];!1!==(r=It(n));)s.push(r);return function(t){for(var e,n=t.length,r=-1,s="";++r<n;)(e=t[r])>65535&&(s+=Tt((e-=65536)>>>10&1023|55296),e=56320|1023&e),s+=Tt(e);return s}(s)}},Ut={}.toString,jt=Array.isArray||function(t){return"[object Array]"==Ut.call(t)},qt=Object.prototype.toString,Wt="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===qt.call(Blob),Vt="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===qt.call(File),$t=function t(e){if(!e||"object"!=typeof e)return!1;if(jt(e)){for(var n=0,r=e.length;r>n;n++)if(t(e[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||Wt&&e instanceof Blob||Vt&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t(e[s]))return!0;return!1};var Ht=function(t,e,n){var r=!1;return n=n||Gt,s.count=t,0===t?e():s;function s(t,o){if(0>=s.count)throw Error("after called too many times");--s.count,t?(r=!0,e(t),e=n):0!==s.count||r||e(null,o)}};function Gt(){}var zt=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e},Yt=D(function(t,e){e.protocol=3;var n=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=zt(n),s={type:"error",data:"parser error"};const o=Buffer.concat([]);function i(t,r,s){if(!r)return e.encodeBase64Packet(t,s);var o=t.data,i=Buffer.allocUnsafe(1);return i[0]=n[t.type],s(Buffer.concat([i,o]))}function a(t,e,n){for(var r=[],s=Ht(t.length,n),o=0;t.length>o;o++)e(t[o],function(t,e){r[o]=e,s(t,r)})}function c(t){for(var e="",n=0,r=t.length;r>n;n++)e+=String.fromCharCode(t[n]);return e}function u(t){for(var e=Buffer.allocUnsafe(t.length),n=0,r=t.length;r>n;n++)e.writeUInt8(t.charCodeAt(n),n);return e}function h(t){return Buffer.from(t.buffer||t,t.byteOffset||0,t.byteLength||t.length)}function p(t,n){e.encodePacket(t,!0,!0,function(t){var e,r=""+t.length;if("string"==typeof t){(e=Buffer.allocUnsafe(r.length+2))[0]=0;for(var s=0;r.length>s;s++)e[s+1]=parseInt(r[s],10);return e[e.length-1]=255,n(null,Buffer.concat([e,u(t)]))}for((e=Buffer.allocUnsafe(r.length+2))[0]=1,s=0;r.length>s;s++)e[s+1]=parseInt(r[s],10);e[e.length-1]=255,n(null,Buffer.concat([e,t]))})}e.encodePacket=function(t,e,r,s){if("function"==typeof e&&(s=e,e=null),"function"==typeof r&&(s=r,r=null),Buffer.isBuffer(t.data))return i(t,e,s);if(t.data&&(t.data.buffer||t.data)instanceof ArrayBuffer)return i({type:t.type,data:h(t.data)},e,s);var o=n[t.type];return void 0!==t.data&&(o+=r?Mt.encode(t.data+"",{strict:!1}):t.data+""),s(""+o)},e.encodeBase64Packet=function(t,e){var r=Buffer.isBuffer(t.data)?t.data:h(t.data),s="b"+n[t.type];return e(s+=r.toString("base64"))},e.decodePacket=function(t,n,o){if(void 0===t)return s;var i;if("string"==typeof t)return"b"===(i=t.charAt(0))?e.decodeBase64Packet(t.substr(1),n):o&&!1===(t=function(t){try{t=Mt.decode(t,{strict:!1})}catch(t){return!1}return t}(t))?s:+i==i&&r[i]?t.length>1?{type:r[i],data:t.substring(1)}:{type:r[i]}:s;if("arraybuffer"===n){var a=new Uint8Array(t);return{type:r[i=a[0]],data:a.buffer.slice(1)}}return t instanceof ArrayBuffer&&(t=h(t)),{type:r[i=t[0]],data:t.slice(1)}},e.decodeBase64Packet=function(t,e){var n=r[t.charAt(0)],s=Buffer.from(t.substr(1),"base64");if("arraybuffer"===e){for(var o=new Uint8Array(s.length),i=0;o.length>i;i++)o[i]=s[i];s=o.buffer}return{type:n,data:s}},e.encodePayload=function(t,n,r){if("function"==typeof n&&(r=n,n=null),n&&$t(t))return e.encodePayloadAsBinary(t,r);if(!t.length)return r("0:");a(t,function(t,r){e.encodePacket(t,n,!1,function(t){r(null,function(t){return t.length+":"+t}(t))})},function(t,e){return r(e.join(""))})},e.decodePayload=function(t,n,r){if("string"!=typeof t)return e.decodePayloadAsBinary(t,n,r);if("function"==typeof n&&(r=n,n=null),""===t)return r(s,0,1);for(var o,i,a,c="",u=0,h=t.length;h>u;u++){var p=t.charAt(u);if(":"===p){if(""===c||c!=(o=+c))return r(s,0,1);if(c!=(i=t.substr(u+1,o)).length)return r(s,0,1);if(i.length){if(a=e.decodePacket(i,n,!1),s.type===a.type&&s.data===a.data)return r(s,0,1);if(!1===r(a,u+o,h))return}u+=o,c=""}else c+=p}return""!==c?r(s,0,1):void 0},e.encodePayloadAsBinary=function(t,e){if(!t.length)return e(o);a(t,p,function(t,n){return e(Buffer.concat(n))})},e.decodePayloadAsBinary=function(t,n,r){"function"==typeof n&&(r=n,n=null);for(var o,i=t,a=[];i.length>0;){var u="",h=0===i[0];for(o=1;255!==i[o];o++){if(u.length>310)return r(s,0,1);u+=""+i[o]}i=i.slice(u.length+1);var p=parseInt(u,10),l=i.slice(1,p+1);h&&(l=c(l)),a.push(l),i=i.slice(p+1)}var f=a.length;for(o=0;f>o;o++){r(e.decodePacket(a[o],n,!0),o,f)}}}),Xt=D(function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;r.length>s;s++)if((n=r[s])===e||n.fn===e){r.splice(s,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=[],n=this._callbacks["$"+t],r=1;arguments.length>r;r++)e[r-1]=arguments[r];if(n){r=0;for(var s=(n=n.slice(0)).length;s>r;++r)n[r].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),Jt=Kt;function Kt(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}Xt(Kt.prototype),Kt.prototype.onError=function(t,e){var n=Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},Kt.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Kt.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Kt.prototype.send=function(t){if("open"!==this.readyState)throw Error("Transport not open");this.write(t)},Kt.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Kt.prototype.onData=function(t){var e=Yt.decodePacket(t,this.socket.binaryType);this.onPacket(e)},Kt.prototype.onPacket=function(t){this.emit("packet",t)},Kt.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var Qt,Zt={encode:function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},decode:function(t){for(var e={},n=t.split("&"),r=0,s=n.length;s>r;r++){var o=n[r].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}},te=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t},ee="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),ne=64,re={},se=0,oe=0;function ie(t){var e="";do{e=ee[t%ne]+e,t=Math.floor(t/ne)}while(t>0);return e}function ae(){var t=ie(+new Date);return t!==Qt?(se=0,Qt=t):t+"."+ie(se++)}for(;ne>oe;oe++)re[ee[oe]]=oe;ae.encode=ie,ae.decode=function(t){var e=0;for(oe=0;t.length>oe;oe++)e=e*ne+re[t.charAt(oe)];return e};var ce=ae,ue=lt("engine.io-client:polling"),he=le,pe=null!=new xt({xdomain:!1}).responseType;function le(t){pe&&!(t&&t.forceBase64)||(this.supportsBinary=!1),Jt.call(this,t)}te(le,Jt),le.prototype.name="polling",le.prototype.doOpen=function(){this.poll()},le.prototype.pause=function(t){var e=this;function n(){ue("paused"),e.readyState="paused",t()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(ue("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){ue("pre-pause polling complete"),--r||n()})),this.writable||(ue("we are currently writing - waiting to pause"),r++,this.once("drain",function(){ue("pre-pause writing complete"),--r||n()}))}else n()},le.prototype.poll=function(){ue("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},le.prototype.onData=function(t){var e=this;ue("polling got data %s",t);Yt.decodePayload(t,this.socket.binaryType,function(t,n,r){if("opening"===e.readyState&&e.onOpen(),"close"===t.type)return e.onClose(),!1;e.onPacket(t)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():ue('ignoring poll - transport state "%s"',this.readyState))},le.prototype.doClose=function(){var t=this;function e(){ue("writing close packet"),t.write([{type:"close"}])}"open"===this.readyState?(ue("transport open - closing"),e()):(ue("transport not open - deferring close"),this.once("open",e))},le.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit("drain")};Yt.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},le.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(t[this.timestampParam]=ce()),this.supportsBinary||t.sid||(t.b64=1),t=Zt.encode(t),this.port&&("https"===e&&443!=+this.port||"http"===e&&80!=+this.port)&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t};var fe=N,de=lt("engine.io-client:polling-xhr"),ye=ge,be=ve;function me(){}function ge(t){if(he.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,n=location.port;n||(n=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}function ve(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(te(ge,he),ge.prototype.supportsBinary=!0,ge.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new ve(t)},ge.prototype.doWrite=function(t,e){var n=this.request({method:"POST",data:t,isBinary:"string"!=typeof t&&void 0!==t}),r=this;n.on("success",e),n.on("error",function(t){r.onError("xhr post error",t)}),this.sendXhr=n},ge.prototype.doPoll=function(){de("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},Xt(ve.prototype),ve.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new xt(t),n=this;try{de("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}catch(t){}if("POST"===this.method)try{e.setRequestHeader("Content-type",this.isBinary?"application/octet-stream":"text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout(function(){n.onError("number"==typeof e.status?e.status:0)},0))},de("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout(function(){n.onError(t)},0)}"undefined"!=typeof document&&(this.index=ve.requestsCount++,ve.requests[this.index]=this)},ve.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},ve.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},ve.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},ve.prototype.cleanup=function(t){if(null!=this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=me:this.xhr.onreadystatechange=me,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete ve.requests[this.index],this.xhr=null}},ve.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t=("application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},ve.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},ve.prototype.abort=function(){this.cleanup()},ve.requestsCount=0,ve.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",_e);else if("function"==typeof addEventListener){addEventListener("onpagehide"in fe?"pagehide":"unload",_e,!1)}function _e(){for(var t in ve.requests)ve.requests.hasOwnProperty(t)&&ve.requests[t].abort()}ye.Request=be;var we,Oe=xe,Ee=/\n/g,ke=/\\n/g;function Se(){}function xe(t){he.call(this,t),this.query=this.query||{},we||(we=fe.___eio=fe.___eio||[]),this.index=we.length;var e=this;we.push(function(t){e.onData(t)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){e.script&&(e.script.onerror=Se)},!1)}function Ce(t){if(!(this instanceof Ce))return new Ce(t);this.concurrency=(t=t||{}).concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=function(){this.pending--,this._run()}.bind(this)}te(xe,he),xe.prototype.supportsBinary=!1,xe.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),he.prototype.doClose.call(this)},xe.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},xe.prototype.doWrite=function(t,e){var n=this;if(!this.form){var r,s=document.createElement("form"),o=document.createElement("textarea"),i=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=i,s.method="POST",s.setAttribute("accept-charset","utf-8"),o.name="d",s.appendChild(o),document.body.appendChild(s),this.form=s,this.area=o}function a(){c(),e()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{r=document.createElement('<iframe src="javascript:0" name="'+n.iframeId+'">')}catch(t){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),t=t.replace(ke,"\\\n"),this.area.value=t.replace(Ee,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};["push","unshift","splice"].forEach(function(t){Ce.prototype[t]=function(){var e=Array.prototype[t].apply(this.jobs,arguments);return this._run(),e}}),Object.defineProperty(Ce.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),Ce.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var t=this.jobs.shift();this.pending++,t(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var e=this.cbs.pop();process.nextTick(e)}}},Ce.prototype.onDone=function(t){"function"==typeof t&&(this.cbs.push(t),this._run())};var Re=Ce,Pe=D(function(t){function e(t,e){const n=Buffer.allocUnsafe(e);for(var r=0,s=0;t.length>s;s++){const e=t[s];e.copy(n,r),r+=e.length}return n}function n(t,e,n,r,s){for(var o=0;s>o;o++)n[r+o]=t[o]^e[3&o]}function r(t,e){const n=t.length;for(var r=0;n>r;r++)t[r]^=e[3&r]}try{const s=d,o=s.BufferUtil||s;t.exports={mask(t,e,r,s,i){48>i?n(t,e,r,s,i):o.mask(t,e,r,s,i)},unmask(t,e){32>t.length?r(t,e):o.unmask(t,e)},concat:e}}catch(s){t.exports={concat:e,mask:n,unmask:r}}}),Ae={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}};const{kStatusCode:Te,NOOP:Ne}=Ae,De=Buffer.from([0,0,255,255]),Le=Buffer.from([0]),Fe=Symbol("permessage-deflate"),Be=Symbol("total-length"),Ie=Symbol("callback"),Me=Symbol("buffers"),Ue=Symbol("error");let je;var qe=class{constructor(t,e,n){this._maxPayload=0|n,this._options=t||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!e,this._deflate=null,this._inflate=null,this.params=null,je||(je=new Re({concurrency:void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10}))}static get extensionName(){return"permessage-deflate"}offer(){const t={};return this._options.serverNoContextTakeover&&(t.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(t.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(t.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?t.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(t.client_max_window_bits=!0),t}accept(t){return t=this.normalizeParams(t),this.params=this._isServer?this.acceptAsServer(t):this.acceptAsClient(t),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(t){const e=this._options,n=t.find(t=>!(!1===e.serverNoContextTakeover&&t.server_no_context_takeover||t.server_max_window_bits&&(!1===e.serverMaxWindowBits||"number"==typeof e.serverMaxWindowBits&&e.serverMaxWindowBits>t.server_max_window_bits)||"number"==typeof e.clientMaxWindowBits&&!t.client_max_window_bits));if(!n)throw Error("None of the extension offers can be accepted");return e.serverNoContextTakeover&&(n.server_no_context_takeover=!0),e.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof e.serverMaxWindowBits&&(n.server_max_window_bits=e.serverMaxWindowBits),"number"==typeof e.clientMaxWindowBits?n.client_max_window_bits=e.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==e.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(t){const e=t[0];if(!1===this._options.clientNoContextTakeover&&e.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(e.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&e.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(e.client_max_window_bits=this._options.clientMaxWindowBits);return e}normalizeParams(t){return t.forEach(t=>{Object.keys(t).forEach(e=>{var n=t[e];if(n.length>1)throw Error(`Parameter "${e}" must have only a single value`);if(n=n[0],"client_max_window_bits"===e){if(!0!==n){const t=+n;if(!Number.isInteger(t)||8>t||t>15)throw new TypeError(`Invalid value for parameter "${e}": ${n}`);n=t}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${e}": ${n}`)}else if("server_max_window_bits"===e){const t=+n;if(!Number.isInteger(t)||8>t||t>15)throw new TypeError(`Invalid value for parameter "${e}": ${n}`);n=t}else{if("client_no_context_takeover"!==e&&"server_no_context_takeover"!==e)throw Error(`Unknown parameter "${e}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${e}": ${n}`)}t[e]=n})}),t}decompress(t,e,n){je.push(r=>{this._decompress(t,e,(t,e)=>{r(),n(t,e)})})}compress(t,e,n){je.push(r=>{this._compress(t,e,(t,e)=>{r(),n(t,e)})})}_decompress(t,e,n){const r=this._isServer?"client":"server";if(!this._inflate){const t=`${r}_max_window_bits`;this._inflate=f.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:"number"!=typeof this.params[t]?f.Z_DEFAULT_WINDOWBITS:this.params[t]})),this._inflate[Fe]=this,this._inflate[Be]=0,this._inflate[Me]=[],this._inflate.on("error",$e),this._inflate.on("data",Ve)}this._inflate[Ie]=n,this._inflate.write(t),e&&this._inflate.write(De),this._inflate.flush(()=>{const t=this._inflate[Ue];if(t)return this._inflate.close(),this._inflate=null,void n(t);const s=Pe.concat(this._inflate[Me],this._inflate[Be]);e&&this.params[`${r}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[Be]=0,this._inflate[Me]=[]),n(null,s)})}_compress(t,e,n){if(!t||0===t.length)return void process.nextTick(n,null,Le);const r=this._isServer?"server":"client";if(!this._deflate){const t=`${r}_max_window_bits`;this._deflate=f.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:"number"!=typeof this.params[t]?f.Z_DEFAULT_WINDOWBITS:this.params[t]})),this._deflate[Be]=0,this._deflate[Me]=[],this._deflate.on("error",Ne),this._deflate.on("data",We)}this._deflate.write(t),this._deflate.flush(f.Z_SYNC_FLUSH,()=>{if(this._deflate){var t=Pe.concat(this._deflate[Me],this._deflate[Be]);e&&(t=t.slice(0,t.length-4)),e&&this.params[`${r}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[Be]=0,this._deflate[Me]=[]),n(null,t)}})}};function We(t){this[Me].push(t),this[Be]+=t.length}function Ve(t){this[Be]+=t.length,this[Fe]._maxPayload>=1&&this[Be]>this[Fe]._maxPayload?(this[Ue]=new RangeError("Max payload size exceeded"),this[Ue][Te]=1009,this.removeListener("data",Ve),this.reset()):this[Me].push(t)}function $e(t){this[Fe]._inflate=null,t[Te]=1007,this[Ie](t)}class He{constructor(t,e){this.target=e,this.type=t}}class Ge extends He{constructor(t,e){super("message",e),this.data=t}}class ze extends He{constructor(t,e,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=e,this.code=t}}class Ye extends He{constructor(t){super("open",t)}}class Xe extends He{constructor(t,e){super("error",e),this.message=t.message,this.error=t}}var Je={addEventListener(t,e){function n(t){e.call(this,new Ge(t,this))}function r(t,n){e.call(this,new ze(t,n,this))}function s(t){e.call(this,new Xe(t,this))}function o(){e.call(this,new Ye(this))}"function"==typeof e&&("message"===t?(n._listener=e,this.on(t,n)):"close"===t?(r._listener=e,this.on(t,r)):"error"===t?(s._listener=e,this.on(t,s)):"open"===t?(o._listener=e,this.on(t,o)):this.on(t,e))},removeEventListener(t,e){const n=this.listeners(t);for(var r=0;n.length>r;r++)n[r]!==e&&n[r]._listener!==e||this.removeListener(t,n[r])}};const Ke=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Qe(t,e,n){Object.prototype.hasOwnProperty.call(t,e)?t[e].push(n):t[e]=[n]}var Ze={format:function(t){return Object.keys(t).map(e=>{var n=t[e];return Array.isArray(n)||(n=[n]),n.map(t=>[e].concat(Object.keys(t).map(e=>{var n=t[e];return Array.isArray(n)||(n=[n]),n.map(t=>!0===t?e:`${e}=${t}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(t){const e={};if(void 0===t||""===t)return e;for(var n,r,s={},o=!1,i=!1,a=!1,c=-1,u=-1,h=0;t.length>h;h++){const l=t.charCodeAt(h);if(void 0===n)if(-1===u&&1===Ke[l])-1===c&&(c=h);else if(32===l||9===l)-1===u&&-1!==c&&(u=h);else{if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${h}`);-1===u&&(u=h);const r=t.slice(c,u);44===l?(Qe(e,r,s),s={}):n=r,c=u=-1}}else if(void 0===r)if(-1===u&&1===Ke[l])-1===c&&(c=h);else if(32===l||9===l)-1===u&&-1!==c&&(u=h);else if(59===l||44===l){if(-1===c)throw new SyntaxError(`Unexpected character at index ${h}`);-1===u&&(u=h),Qe(s,t.slice(c,u),!0),44===l&&(Qe(e,n,s),s={},n=void 0),c=u=-1}else{if(61!==l||-1===c||-1!==u)throw new SyntaxError(`Unexpected character at index ${h}`);r=t.slice(c,h),c=u=-1}else if(i){if(1!==Ke[l])throw new SyntaxError(`Unexpected character at index ${h}`);-1===c?c=h:o||(o=!0),i=!1}else if(a)if(1===Ke[l])-1===c&&(c=h);else if(34===l&&-1!==c)a=!1,u=h;else{if(92!==l)throw new SyntaxError(`Unexpected character at index ${h}`);i=!0}else if(34===l&&61===t.charCodeAt(h-1))a=!0;else if(-1===u&&1===Ke[l])-1===c&&(c=h);else if(-1===c||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${h}`);if(-1===c)throw new SyntaxError(`Unexpected character at index ${h}`);-1===u&&(u=h);var p=t.slice(c,u);o&&(p=p.replace(/\\/g,""),o=!1),Qe(s,r,p),44===l&&(Qe(e,n,s),s={},n=void 0),r=void 0,c=u=-1}else-1===u&&(u=h)}if(-1===c||a)throw new SyntaxError("Unexpected end of input");-1===u&&(u=h);const l=t.slice(c,u);return void 0===n?Qe(e,l,{}):(void 0===r?Qe(s,l,!0):Qe(s,r,o?l.replace(/\\/g,""):l),Qe(e,n,s)),e}},tn=D(function(t,e){try{const t=b;e.isValidUTF8="object"==typeof t?t.Validation.isValidUTF8:t}catch(t){e.isValidUTF8=(()=>!0)}e.isValidStatusCode=(t=>t>=1e3&&1013>=t&&1004!==t&&1005!==t&&1006!==t||t>=3e3&&4999>=t)});const en=0,nn=1,rn=2,sn=3,on=4,an=5;var cn=class extends y.Writable{constructor(t,e,n){super(),this._binaryType=t||Ae.BINARY_TYPES[0],this[Ae.kWebSocket]=void 0,this._extensions=e||{},this._maxPayload=0|n,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=en,this._loop=!1}_write(t,e,n){if(8===this._opcode&&this._state==en)return n();this._bufferedBytes+=t.length,this._buffers.push(t),this.startLoop(n)}consume(t){if(this._bufferedBytes-=t,t===this._buffers[0].length)return this._buffers.shift();if(this._buffers[0].length>t){const e=this._buffers[0];return this._buffers[0]=e.slice(t),e.slice(0,t)}const e=Buffer.allocUnsafe(t);do{const n=this._buffers[0];n.length>t?(n.copy(e,e.length-t,0,t),this._buffers[0]=n.slice(t)):this._buffers.shift().copy(e,e.length-t),t-=n.length}while(t>0);return e}startLoop(t){var e;this._loop=!0;do{switch(this._state){case en:e=this.getInfo();break;case nn:e=this.getPayloadLength16();break;case rn:e=this.getPayloadLength64();break;case sn:this.getMask();break;case on:e=this.getData(t);break;default:return void(this._loop=!1)}}while(this._loop);t(e)}getInfo(){if(2>this._bufferedBytes)return void(this._loop=!1);const t=this.consume(2);if(0!=(48&t[0]))return this._loop=!1,un(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const e=64==(64&t[0]);if(e&&!this._extensions[qe.extensionName])return this._loop=!1,un(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&t[0]),this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(e)return this._loop=!1,un(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,un(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,un(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=e}else{if(7>=this._opcode||this._opcode>=11)return this._loop=!1,un(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin)return this._loop=!1,un(RangeError,"FIN must be set",!0,1002);if(e)return this._loop=!1,un(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,un(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&t[1]),126===this._payloadLength)this._state=nn;else{if(127!==this._payloadLength)return this.haveLength();this._state=rn}}getPayloadLength16(){if(this._bufferedBytes>=2)return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(8>this._bufferedBytes)return void(this._loop=!1);const t=this.consume(8),e=t.readUInt32BE(0);return e>2097151?(this._loop=!1,un(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=4294967296*e+t.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&8>this._opcode&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,un(RangeError,"Max payload size exceeded",!1,1009);this._state=this._masked?sn:on}getMask(){4>this._bufferedBytes?this._loop=!1:(this._mask=this.consume(4),this._state=on)}getData(t){var e=Ae.EMPTY_BUFFER;if(this._payloadLength){if(this._payloadLength>this._bufferedBytes)return void(this._loop=!1);e=this.consume(this._payloadLength),this._masked&&Pe.unmask(e,this._mask)}return this._opcode>7?this.controlMessage(e):this._compressed?(this._state=an,void this.decompress(e,t)):(e.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(e)),this.dataMessage())}decompress(t,e){this._extensions[qe.extensionName].decompress(t,this._fin,(t,n)=>{if(t)return e(t);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return e(un(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(n)}const r=this.dataMessage();if(r)return e(r);this.startLoop(e)})}dataMessage(){if(this._fin){const n=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){var t;t="nodebuffer"===this._binaryType?hn(r,n):"arraybuffer"===this._binaryType?(e=hn(r,n)).byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength):r,this.emit("message",t)}else{const t=hn(r,n);if(!tn.isValidUTF8(t))return this._loop=!1,un(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",""+t)}}var e;this._state=en}controlMessage(t){if(8===this._opcode)if(this._loop=!1,0===t.length)this.emit("conclude",1005,""),this.end();else{if(1===t.length)return un(RangeError,"invalid payload length 1",!0,1002);{const e=t.readUInt16BE(0);if(!tn.isValidStatusCode(e))return un(RangeError,`invalid status code ${e}`,!0,1002);const n=t.slice(2);if(!tn.isValidUTF8(n))return un(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",e,""+n),this.end()}}else this.emit(9===this._opcode?"ping":"pong",t);this._state=en}};function un(t,e,n,r){const s=new t(n?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(s,un),s[Ae.kStatusCode]=r,s}function hn(t,e){return 1===t.length?t[0]:t.length>1?Pe.concat(t,e):Ae.EMPTY_BUFFER}class pn{constructor(t,e){this._extensions=e||{},this._socket=t,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(t,e){const n=1024>t.length||e.mask&&e.readOnly;var r=e.mask?6:2,s=t.length;65536>t.length?t.length>125&&(r+=2,s=126):(r+=8,s=127);const o=Buffer.allocUnsafe(n?t.length+r:r);if(o[0]=e.fin?128|e.opcode:e.opcode,e.rsv1&&(o[0]|=64),126===s?o.writeUInt16BE(t.length,2):127===s&&(o.writeUInt32BE(0,2),o.writeUInt32BE(t.length,6)),!e.mask)return o[1]=s,n?(t.copy(o,r),[o]):[o,t];const i=h.randomBytes(4);return o[1]=128|s,o[r-4]=i[0],o[r-3]=i[1],o[r-2]=i[2],o[r-1]=i[3],n?(Pe.mask(t,i,o,r,t.length),[o]):(Pe.mask(t,i,t,0,t.length),[o,t])}close(t,e,n,r){var s;if(void 0===t)s=Ae.EMPTY_BUFFER;else{if("number"!=typeof t||!tn.isValidStatusCode(t))throw new TypeError("First argument must be a valid error code number");void 0===e||""===e?(s=Buffer.allocUnsafe(2)).writeUInt16BE(t,0):((s=Buffer.allocUnsafe(2+Buffer.byteLength(e))).writeUInt16BE(t,0),s.write(e,2))}this._deflating?this.enqueue([this.doClose,s,n,r]):this.doClose(s,n,r)}doClose(t,e,n){this.sendFrame(pn.frame(t,{fin:!0,rsv1:!1,opcode:8,mask:e,readOnly:!1}),n)}ping(t,e,n){var r=!0;Buffer.isBuffer(t)||(t instanceof ArrayBuffer?t=Buffer.from(t):ArrayBuffer.isView(t)?t=fn(t):(t=Buffer.from(t),r=!1)),this._deflating?this.enqueue([this.doPing,t,e,r,n]):this.doPing(t,e,r,n)}doPing(t,e,n,r){this.sendFrame(pn.frame(t,{fin:!0,rsv1:!1,opcode:9,mask:e,readOnly:n}),r)}pong(t,e,n){var r=!0;Buffer.isBuffer(t)||(t instanceof ArrayBuffer?t=Buffer.from(t):ArrayBuffer.isView(t)?t=fn(t):(t=Buffer.from(t),r=!1)),this._deflating?this.enqueue([this.doPong,t,e,r,n]):this.doPong(t,e,r,n)}doPong(t,e,n,r){this.sendFrame(pn.frame(t,{fin:!0,rsv1:!1,opcode:10,mask:e,readOnly:n}),r)}send(t,e,n){var r=e.binary?2:1,s=e.compress,o=!0;Buffer.isBuffer(t)||(t instanceof ArrayBuffer?t=Buffer.from(t):ArrayBuffer.isView(t)?t=fn(t):(t=Buffer.from(t),o=!1));const i=this._extensions[qe.extensionName];if(this._firstFragment?(this._firstFragment=!1,s&&i&&(s=t.length>=i._threshold),this._compress=s):(s=!1,r=0),e.fin&&(this._firstFragment=!0),i){const i={fin:e.fin,rsv1:s,opcode:r,mask:e.mask,readOnly:o};this._deflating?this.enqueue([this.dispatch,t,this._compress,i,n]):this.dispatch(t,this._compress,i,n)}else this.sendFrame(pn.frame(t,{fin:e.fin,rsv1:!1,opcode:r,mask:e.mask,readOnly:o}),n)}dispatch(t,e,n,r){if(!e)return void this.sendFrame(pn.frame(t,n),r);const s=this._extensions[qe.extensionName];this._deflating=!0,s.compress(t,n.fin,(t,e)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(pn.frame(e,n),r),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const t=this._queue.shift();this._bufferedBytes-=t[1].length,t[0].apply(this,t.slice(1))}}enqueue(t){this._bufferedBytes+=t[1].length,this._queue.push(t)}sendFrame(t,e){2===t.length?(this._socket.write(t[0]),this._socket.write(t[1],e)):this._socket.write(t[0],e)}}var ln=pn;function fn(t){const e=Buffer.from(t.buffer);return t.byteLength!==t.buffer.byteLength?e.slice(t.byteOffset,t.byteOffset+t.byteLength):e}const dn=["CONNECTING","OPEN","CLOSING","CLOSED"],yn=Ae.kWebSocket,bn=[8,13],mn=3e4;class gn extends u{constructor(t,e,n){super(),this.readyState=gn.CONNECTING,this.protocol="",this._binaryType=Ae.BINARY_TYPES[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._isServer=!0,this._receiver=null,this._sender=null,this._socket=null,null!==t&&(Array.isArray(e)?e=e.join(", "):"object"==typeof e&&null!==e&&(n=e,e=void 0),function(t,e,n){if(n=Object.assign({protocolVersion:bn[1],perMessageDeflate:!0,maxPayload:104857600},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0}),!bn.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} `+`(supported versions: ${bn.join(", ")})`);var r;this._isServer=!1,"object"==typeof t&&void 0!==t.href?(r=t,this.url=t.href):(r=o.URL?new o.URL(t):o.parse(t),this.url=t);const s="ws+unix:"===r.protocol;if(!(r.host||s&&r.pathname))throw Error(`Invalid URL: ${this.url}`);const i="wss:"===r.protocol||"https:"===r.protocol,u=i?443:80,p=h.randomBytes(16).toString("base64"),l=i?c:a,f=r.search?`${r.pathname||"/"}${r.search}`:r.pathname||"/";var d;n.createConnection=i?wn:_n,n.defaultPort=n.defaultPort||u,n.port=r.port||u,n.host=r.hostname.startsWith("[")?r.hostname.slice(1,-1):r.hostname,n.headers=Object.assign({"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":p,Connection:"Upgrade",Upgrade:"websocket"},n.headers),n.path=f,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(d=new qe(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=Ze.format({[qe.extensionName]:d.offer()}));e&&(n.headers["Sec-WebSocket-Protocol"]=e);n.origin&&(13>n.protocolVersion?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin);r.auth?n.auth=r.auth:(r.username||r.password)&&(n.auth=`${r.username}:${r.password}`);if(s){const t=f.split(":");n.socketPath=t[0],n.path=t[1]}var y=this._req=l.get(n);n.handshakeTimeout&&y.on("timeout",()=>{On(this,y,"Opening handshake has timed out")});y.on("error",t=>{this._req.aborted||(y=this._req=null,this.readyState=gn.CLOSING,this.emit("error",t),this.emitClose())}),y.on("response",t=>{this.emit("unexpected-response",y,t)||On(this,y,`Unexpected server response: ${t.statusCode}`)}),y.on("upgrade",(t,r,s)=>{if(this.emit("upgrade",t),this.readyState!==gn.CONNECTING)return;y=this._req=null;const o=h.createHash("sha1").update(p+Ae.GUID,"binary").digest("base64");if(t.headers["sec-websocket-accept"]!==o)return void On(this,r,"Invalid Sec-WebSocket-Accept header");const i=t.headers["sec-websocket-protocol"],a=(e||"").split(/, */);var c;if(!e&&i?c="Server sent a subprotocol but none was requested":e&&!i?c="Server sent no subprotocol":i&&!a.includes(i)&&(c="Server sent an invalid subprotocol"),c)On(this,r,c);else{if(i&&(this.protocol=i),d)try{const e=Ze.parse(t.headers["sec-websocket-extensions"]);e[qe.extensionName]&&(d.accept(e[qe.extensionName]),this._extensions[qe.extensionName]=d)}catch(t){return void On(this,r,"Invalid Sec-WebSocket-Extensions header")}this.setSocket(r,s,n.maxPayload)}})}.call(this,t,e,n))}get CONNECTING(){return gn.CONNECTING}get CLOSING(){return gn.CLOSING}get CLOSED(){return gn.CLOSED}get OPEN(){return gn.OPEN}get binaryType(){return this._binaryType}set binaryType(t){Ae.BINARY_TYPES.includes(t)&&(this._binaryType=t,this._receiver&&(this._receiver._binaryType=t))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(t,e,n){const r=new cn(this._binaryType,this._extensions,n);this._sender=new ln(t,this._extensions),this._receiver=r,this._socket=t,r[yn]=this,t[yn]=this,r.on("conclude",En),r.on("drain",kn),r.on("error",Sn),r.on("message",Cn),r.on("ping",Rn),r.on("pong",Pn),t.setTimeout(0),t.setNoDelay(),e.length>0&&t.unshift(e),t.on("close",An),t.on("data",Tn),t.on("end",Nn),t.on("error",Dn),this.readyState=gn.OPEN,this.emit("open")}emitClose(){this.readyState=gn.CLOSED,this._socket?(this._extensions[qe.extensionName]&&this._extensions[qe.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)):this.emit("close",this._closeCode,this._closeMessage)}close(t,e){if(this.readyState!==gn.CLOSED){if(this.readyState===gn.CONNECTING){return On(this,this._req,"WebSocket was closed before the connection was established")}this.readyState!==gn.CLOSING?(this.readyState=gn.CLOSING,this._sender.close(t,e,!this._isServer,t=>{t||(this._closeFrameSent=!0,this._socket.writable&&(this._closeFrameReceived&&this._socket.end(),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),mn)))})):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(t,e,n){if("function"==typeof t?(n=t,t=e=void 0):"function"==typeof e&&(n=e,e=void 0),this.readyState!==gn.OPEN){const t=Error(`WebSocket is not open: readyState ${this.readyState} `+`(${dn[this.readyState]})`);if(n)return n(t);throw t}"number"==typeof t&&(t=""+t),void 0===e&&(e=!this._isServer),this._sender.ping(t||Ae.EMPTY_BUFFER,e,n)}pong(t,e,n){if("function"==typeof t?(n=t,t=e=void 0):"function"==typeof e&&(n=e,e=void 0),this.readyState!==gn.OPEN){const t=Error(`WebSocket is not open: readyState ${this.readyState} `+`(${dn[this.readyState]})`);if(n)return n(t);throw t}"number"==typeof t&&(t=""+t),void 0===e&&(e=!this._isServer),this._sender.pong(t||Ae.EMPTY_BUFFER,e,n)}send(t,e,n){if("function"==typeof e&&(n=e,e={}),this.readyState!==gn.OPEN){const t=Error(`WebSocket is not open: readyState ${this.readyState} `+`(${dn[this.readyState]})`);if(n)return n(t);throw t}"number"==typeof t&&(t=""+t);const r=Object.assign({binary:"string"!=typeof t,mask:!this._isServer,compress:!0,fin:!0},e);this._extensions[qe.extensionName]||(r.compress=!1),this._sender.send(t||Ae.EMPTY_BUFFER,r,n)}terminate(){if(this.readyState!==gn.CLOSED){if(this.readyState===gn.CONNECTING){return On(this,this._req,"WebSocket was closed before the connection was established")}this._socket&&(this.readyState=gn.CLOSING,this._socket.destroy())}}}dn.forEach((t,e)=>{gn[t]=e}),["open","error","close","message"].forEach(t=>{Object.defineProperty(gn.prototype,`on${t}`,{get(){const e=this.listeners(t);for(var n=0;e.length>n;n++)if(e[n]._listener)return e[n]._listener},set(e){const n=this.listeners(t);for(var r=0;n.length>r;r++)n[r]._listener&&this.removeListener(t,n[r]);this.addEventListener(t,e)}})}),gn.prototype.addEventListener=Je.addEventListener,gn.prototype.removeEventListener=Je.removeEventListener;var vn=gn;function _n(t){return t.protocolVersion&&(t.path=t.socketPath),p.connect(t)}function wn(t){return t.path=void 0,t.servername=t.servername||t.host,l.connect(t)}function On(t,e,n){t.readyState=gn.CLOSING;const r=Error(n);Error.captureStackTrace(r,On),e.setHeader?(e.abort(),e.once("abort",t.emitClose.bind(t)),t.emit("error",r)):(e.destroy(r),e.once("error",t.emit.bind(t,"error")),e.once("close",t.emitClose.bind(t)))}function En(t,e){const n=this[yn];n._socket.removeListener("data",Tn),n._socket.resume(),n._closeFrameReceived=!0,n._closeMessage=e,n._closeCode=t,1005===t?n.close():n.close(t,e)}function kn(){this[yn]._socket.resume()}function Sn(t){const e=this[yn];e._socket.removeListener("data",Tn),e.readyState=gn.CLOSING,e._closeCode=t[Ae.kStatusCode],e.emit("error",t),e._socket.destroy()}function xn(){this[yn].emitClose()}function Cn(t){this[yn].emit("message",t)}function Rn(t){const e=this[yn];e.pong(t,!e._isServer,Ae.NOOP),e.emit("ping",t)}function Pn(t){this[yn].emit("pong",t)}function An(){const t=this[yn];this.removeListener("close",An),this.removeListener("end",Nn),t.readyState=gn.CLOSING,t._socket.read(),t._receiver.end(),this.removeListener("data",Tn),this[yn]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",xn),t._receiver.on("finish",xn))}function Tn(t){this[yn]._receiver.write(t)||this.pause()}function Nn(){const t=this[yn];t.readyState=gn.CLOSING,t._receiver.end(),this.end()}function Dn(){const t=this[yn];this.removeListener("error",Dn),this.on("error",Ae.NOOP),t&&(t.readyState=gn.CLOSING,this.destroy())}var Ln=class extends u{constructor(t,e){if(super(),null==(t=Object.assign({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},t)).port&&!t.server&&!t.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');null!=t.port?(this._server=a.createServer((t,e)=>{const n=a.STATUS_CODES[426];e.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),e.end(n)}),this._server.listen(t.port,t.host,t.backlog,e)):t.server&&(this._server=t.server),this._server&&(this._removeListeners=function(t,e){for(const n of Object.keys(e))t.on(n,e[n]);return function(){for(const n of Object.keys(e))t.removeListener(n,e[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,e,n)=>{this.handleUpgrade(t,e,n,e=>{this.emit("connection",e,t)})}})),!0===t.perMessageDeflate&&(t.perMessageDeflate={}),t.clientTracking&&(this.clients=new Set),this.options=t}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(t){if(t&&this.once("close",t),this.clients)for(const t of this.clients)t.terminate();const e=this._server;e&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port)?e.close(()=>this.emit("close")):process.nextTick(Fn,this)}shouldHandle(t){if(this.options.path){const e=t.url.indexOf("?");if((-1!==e?t.url.slice(0,e):t.url)!==this.options.path)return!1}return!0}handleUpgrade(t,e,n,r){e.on("error",Bn);const s=+t.headers["sec-websocket-version"],o={};if("GET"!==t.method||"websocket"!==t.headers.upgrade.toLowerCase()||!t.headers["sec-websocket-key"]||8!==s&&13!==s||!this.shouldHandle(t))return In(e,400);if(this.options.perMessageDeflate){const n=new qe(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const r=Ze.parse(t.headers["sec-websocket-extensions"]);r[qe.extensionName]&&(n.accept(r[qe.extensionName]),o[qe.extensionName]=n)}catch(t){return In(e,400)}}if(this.options.verifyClient){const i={origin:t.headers[`${8===s?"sec-websocket-origin":"origin"}`],secure:!(!t.connection.authorized&&!t.connection.encrypted),req:t};if(2===this.options.verifyClient.length)return void this.options.verifyClient(i,(s,i,a,c)=>{if(!s)return In(e,i||401,a,c);this.completeUpgrade(o,t,e,n,r)});if(!this.options.verifyClient(i))return In(e,401)}this.completeUpgrade(o,t,e,n,r)}completeUpgrade(t,e,n,r,s){if(!n.readable||!n.writable)return n.destroy();const o=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${h.createHash("sha1").update(e.headers["sec-websocket-key"]+Ae.GUID,"binary").digest("base64")}`],i=new vn(null);var a=e.headers["sec-websocket-protocol"];if(a&&(a=a.trim().split(/ *, */),(a=this.options.handleProtocols?this.options.handleProtocols(a,e):a[0])&&(o.push(`Sec-WebSocket-Protocol: ${a}`),i.protocol=a)),t[qe.extensionName]){const e=Ze.format({[qe.extensionName]:[t[qe.extensionName].params]});o.push(`Sec-WebSocket-Extensions: ${e}`),i._extensions=t}this.emit("headers",o,e),n.write(o.concat("\r\n").join("\r\n")),n.removeListener("error",Bn),i.setSocket(n,r,this.options.maxPayload),this.clients&&(this.clients.add(i),i.on("close",()=>this.clients.delete(i))),s(i)}};function Fn(t){t.emit("close")}function Bn(){this.destroy()}function In(t,e,n,r){t.writable&&(n=n||a.STATUS_CODES[e],r=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(n)},r),t.write(`HTTP/1.1 ${e} ${a.STATUS_CODES[e]}\r\n`+Object.keys(r).map(t=>`${t}: ${r[t]}`).join("\r\n")+"\r\n\r\n"+n)),t.removeListener("error",Bn),t.destroy()}vn.Server=Ln,vn.Receiver=cn,vn.Sender=ln;var Mn,Un,jn=vn,qn=lt("engine.io-client:websocket");if("undefined"!=typeof WebSocket?Mn=WebSocket:"undefined"!=typeof self&&(Mn=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{Un=jn}catch(t){}var Wn=Mn||Un,Vn=$n;function $n(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=Mn&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(Wn=Un),Jt.call(this,t)}te($n,Jt),$n.prototype.name="websocket",$n.prototype.supportsBinary=!0,$n.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={};this.isReactNative||(n.agent=this.agent,n.perMessageDeflate=this.perMessageDeflate,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new Wn(t,e):new Wn(t):new Wn(t,e,n)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},$n.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},$n.prototype.write=function(t){var e=this;this.writable=!1;for(var n=t.length,r=0,s=n;s>r;r++)!function(t){Yt.encodePacket(t,e.supportsBinary,function(r){if(!e.usingBrowserWebSocket){var s={};if(t.options&&(s.compress=t.options.compress),e.perMessageDeflate){var i="string"==typeof r?Buffer.byteLength(r):r.length;e.perMessageDeflate.threshold>i&&(s.compress=!1)}}try{e.usingBrowserWebSocket?e.ws.send(r):e.ws.send(r,s)}catch(t){qn("websocket closed before onclose event")}--n||o()})}(t[r]);function o(){e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0)}},$n.prototype.onClose=function(){Jt.prototype.onClose.call(this)},$n.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},$n.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"===e&&443!=+this.port||"ws"===e&&80!=+this.port)&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=ce()),this.supportsBinary||(t.b64=1),(t=Zt.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+t},$n.prototype.check=function(){return!(!Wn||"__initialize"in Wn&&this.name===$n.prototype.name)};var Hn={polling:function(t){var e=!1,n=!1,r=!1!==t.jsonp;if("undefined"!=typeof location){var s="https:"===location.protocol,o=location.port;o||(o=s?443:80),e=t.hostname!==location.hostname||o!==t.port,n=t.secure!==s}if(t.xdomain=e,t.xscheme=n,"open"in new xt(t)&&!t.forceJSONP)return new ye(t);if(!r)throw Error("JSONP disabled");return new Oe(t)},websocket:Vn},Gn=[].indexOf,zn=function(t,e){if(Gn)return t.indexOf(e);for(var n=0;t.length>n;++n)if(t[n]===e)return n;return-1},Yn=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Xn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Jn=function(t){var e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));for(var s,o=Yn.exec(t||""),i={},a=14;a--;)i[Xn[a]]=o[a]||"";return-1!=n&&-1!=r&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=function(t,e){var n=e.replace(/\/{2,9}/g,"/").split("/");"/"!=e.substr(0,1)&&0!==e.length||n.splice(0,1);"/"==e.substr(e.length-1,1)&&n.splice(n.length-1,1);return n}(0,i.path),i.queryKey=(s={},i.query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(t,e,n){e&&(s[e]=n)}),s),i};var Kn=lt("engine.io-client:socket"),Qn=Zn;function Zn(t,e){if(!(this instanceof Zn))return new Zn(t,e);e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=Jn(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=Jn(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=Zt.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=!1!==e.withCredentials,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Zn.priorWebsocketSuccess=!1,Xt(Zn.prototype),Zn.protocol=Yt.protocol,Zn.Socket=Zn,Zn.Transport=Jt,Zn.transports=Hn,Zn.parser=Yt,Zn.prototype.createTransport=function(t){Kn('creating transport "%s"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=Yt.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new Hn[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Zn.prototype.open=function(){var t;if(this.rememberUpgrade&&Zn.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},Zn.prototype.setTransport=function(t){Kn("setting transport %s",t.name);var e=this;this.transport&&(Kn("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},Zn.prototype.probe=function(t){Kn('probing transport "%s"',t);var e=this.createTransport(t,{probe:1}),n=!1,r=this;function s(){r.onlyBinaryUpgrades&&(n=n||!this.supportsBinary&&r.transport.supportsBinary);n||(Kn('probe transport "%s" opened',t),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(s){if(!n)if("pong"===s.type&&"probe"===s.data){if(Kn('probe transport "%s" pong',t),r.upgrading=!0,r.emit("upgrading",e),!e)return;Zn.priorWebsocketSuccess="websocket"===e.name,Kn('pausing current transport "%s"',r.transport.name),r.transport.pause(function(){n||"closed"!==r.readyState&&(Kn("changing transport and sending upgrade packet"),h(),r.setTransport(e),e.send([{type:"upgrade"}]),r.emit("upgrade",e),e=null,r.upgrading=!1,r.flush())})}else{Kn('probe transport "%s" failed',t);var o=Error("probe error");o.transport=e.name,r.emit("upgradeError",o)}}))}function o(){n||(n=!0,h(),e.close(),e=null)}function i(n){var s=Error("probe error: "+n);s.transport=e.name,o(),Kn('probe transport "%s" failed because of error: %s',t,n),r.emit("upgradeError",s)}function a(){i("transport closed")}function c(){i("socket closed")}function u(t){e&&t.name!==e.name&&(Kn('"%s" works - aborting "%s"',t.name,e.name),o())}function h(){e.removeListener("open",s),e.removeListener("error",i),e.removeListener("close",a),r.removeListener("close",c),r.removeListener("upgrading",u)}Zn.priorWebsocketSuccess=!1,e.once("open",s),e.once("error",i),e.once("close",a),this.once("close",c),this.once("upgrading",u),e.open()},Zn.prototype.onOpen=function(){if(Kn("socket open"),this.readyState="open",Zn.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Kn("starting upgrade probes");for(var t=0,e=this.upgrades.length;e>t;t++)this.probe(this.upgrades[t])}},Zn.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Kn('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else Kn('packet received with socket readyState "%s"',this.readyState)},Zn.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Zn.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!==e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},Zn.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){Kn("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},Zn.prototype.ping=function(){var t=this;this.sendPacket("ping",function(){t.emit("ping")})},Zn.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Zn.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Kn("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Zn.prototype.write=Zn.prototype.send=function(t,e,n){return this.sendPacket("message",t,e,n),this},Zn.prototype.sendPacket=function(t,e,n,r){if("function"==typeof e&&(r=e,e=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var s={type:t,data:e,options:n};this.emit("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}},Zn.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var t=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():e()}):this.upgrading?r():e()}function e(){t.onClose("forced close"),Kn("socket closing - telling transport to close"),t.transport.close()}function n(){t.removeListener("upgrade",n),t.removeListener("upgradeError",n),e()}function r(){t.once("upgrade",n),t.once("upgradeError",n)}return this},Zn.prototype.onError=function(t){Kn("socket error %j",t),Zn.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},Zn.prototype.onClose=function(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Kn('socket close with reason: "%s"',t);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0}},Zn.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;r>n;n++)~zn(this.transports,t[n])&&e.push(t[n]);return e};var tr=Qn;tr.parser=Yt;var er=D(function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var s=0;r.length>s;s++)if((n=r[s])===e||n.fn===e){r.splice(s,1);break}return this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var r=0,s=(n=n.slice(0)).length;s>r;++r)n[r].apply(this,e);return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),nr=function(t,e){for(var n=[],r=(e=e||0)||0;t.length>r;r++)n[r-e]=t[r];return n};var rr=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}};var sr=[].slice,or=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw Error("bind() requires a function");var n=sr.call(arguments,2);return function(){return e.apply(t,n.concat(sr.call(arguments)))}},ir=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},ar=D(function(t,e){var n=Z("socket.io-client:socket");t.exports=o;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},s=er.prototype.emit;function o(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}er(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[rr(t,"open",or(this,"onopen")),rr(t,"packet",or(this,"onpacket")),rr(t,"close",or(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},o.prototype.send=function(){var t=nr(arguments);return t.unshift("message"),this.emit.apply(this,t),this},o.prototype.emit=function(t){if(r.hasOwnProperty(t))return s.apply(this,arguments),this;var e=nr(arguments),o={type:(void 0!==this.flags.binary?this.flags.binary:$t(e))?kt.BINARY_EVENT:kt.EVENT,data:e,options:{}};return o.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),o.id=this.ids++),this.connected?this.packet(o):this.sendBuffer.push(o),this.flags={},this},o.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},o.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?ir(this.query):this.query;n("sending connect packet with query %s",t),this.packet({type:kt.CONNECT,query:t})}else this.packet({type:kt.CONNECT})},o.prototype.onclose=function(t){n("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},o.prototype.onpacket=function(t){if(t.nsp===this.nsp||t.type===kt.ERROR&&"/"===t.nsp)switch(t.type){case kt.CONNECT:this.onconnect();break;case kt.EVENT:case kt.BINARY_EVENT:this.onevent(t);break;case kt.ACK:case kt.BINARY_ACK:this.onack(t);break;case kt.DISCONNECT:this.ondisconnect();break;case kt.ERROR:this.emit("error",t.data)}},o.prototype.onevent=function(t){var e=t.data||[];n("emitting event %j",e),null!=t.id&&(n("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?s.apply(this,e):this.receiveBuffer.push(e)},o.prototype.ack=function(t){var e=this,r=!1;return function(){if(!r){r=!0;var s=nr(arguments);n("sending ack %j",s),e.packet({type:$t(s)?kt.BINARY_ACK:kt.ACK,id:t,data:s})}}},o.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(n("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):n("bad ack %s",t.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var t;for(t=0;this.receiveBuffer.length>t;t++)s.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;this.sendBuffer.length>t;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var t=0;this.subs.length>t;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:kt.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(t){return this.flags.compress=t,this},o.prototype.binary=function(t){return this.flags.binary=t,this}}),cr=ur;function ur(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&1>=t.jitter?t.jitter:0,this.attempts=0}ur.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},ur.prototype.reset=function(){this.attempts=0},ur.prototype.setMin=function(t){this.ms=t},ur.prototype.setMax=function(t){this.max=t},ur.prototype.setJitter=function(t){this.jitter=t};var hr=Z("socket.io-client:manager"),pr=Object.prototype.hasOwnProperty,lr=fr;function fr(t,e){if(!(this instanceof fr))return new fr(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new cr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||kt;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}fr.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)pr.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},fr.prototype.updateSocketIds=function(){for(var t in this.nsps)pr.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},fr.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},er(fr.prototype),fr.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},fr.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},fr.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},fr.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},fr.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},fr.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},fr.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},fr.prototype.open=fr.prototype.connect=function(t,e){if(hr("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;hr("opening %s",this.uri),this.engine=tr(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var s=rr(n,"open",function(){r.onopen(),t&&t()}),o=rr(n,"error",function(e){if(hr("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",e),t){var n=Error("Connection error");n.data=e,t(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var i=this._timeout;hr("connect attempt will timeout after %d",i);var a=setTimeout(function(){hr("connect attempt timed out after %d",i),s.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",i)},i);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(s),this.subs.push(o),this},fr.prototype.onopen=function(){hr("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(rr(t,"data",or(this,"ondata"))),this.subs.push(rr(t,"ping",or(this,"onping"))),this.subs.push(rr(t,"pong",or(this,"onpong"))),this.subs.push(rr(t,"error",or(this,"onerror"))),this.subs.push(rr(t,"close",or(this,"onclose"))),this.subs.push(rr(this.decoder,"decoded",or(this,"ondecoded")))},fr.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},fr.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},fr.prototype.ondata=function(t){this.decoder.add(t)},fr.prototype.ondecoded=function(t){this.emit("packet",t)},fr.prototype.onerror=function(t){hr("error",t),this.emitAll("error",t)},fr.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new ar(this,t,e),this.nsps[t]=n;var r=this;n.on("connecting",s),n.on("connect",function(){n.id=r.generateId(t)}),this.autoConnect&&s()}function s(){~zn(r.connecting,n)||r.connecting.push(n)}return n},fr.prototype.destroy=function(t){var e=zn(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},fr.prototype.packet=function(t){hr("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var r=0;n.length>r;r++)e.engine.write(n[r],t.options);e.encoding=!1,e.processPacketQueue()}))},fr.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},fr.prototype.cleanup=function(){hr("cleanup");for(var t=this.subs.length,e=0;t>e;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},fr.prototype.close=fr.prototype.disconnect=function(){hr("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},fr.prototype.onclose=function(t){hr("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},fr.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts<this._reconnectionAttempts){var e=this.backoff.duration();hr("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(hr("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(hr("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(hr("reconnect success"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}else hr("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1},fr.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)};var dr,yr=D(function(t,e){var n=Z("socket.io-client");t.exports=e=s;var r=e.managers={};function s(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var s,o=et(t),i=o.source,a=o.id;return e.forceNew||e["force new connection"]||!1===e.multiplex||r[a]&&o.path in r[a].nsps?(n("ignoring socket cache for %s",i),s=lr(i,e)):(r[a]||(n("new io instance for %s",i),r[a]=lr(i,e)),s=r[a]),o.query&&!e.query&&(e.query=o.query),s.socket(o.path,e)}e.protocol=kt.protocol,e.connect=s,e.Manager=lr,e.Socket=ar}),br=function(t,e){for(var n=t.split("."),r=e.split("."),s=0;3>s;s++){var o=+n[s],i=+r[s];if(o>i)return 1;if(i>o)return-1;if(!isNaN(o)&&isNaN(i))return 1;if(isNaN(o)&&!isNaN(i))return-1}return 0},mr=D(function(t,e){var n=N&&N.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;n>e;e++)t+=arguments[e].length;var r=Array(t),s=0;for(e=0;n>e;e++)for(var o=arguments[e],i=0,a=o.length;a>i;i++,s++)r[s]=o[i];return r};Object.defineProperty(e,"__esModule",{value:!0});var r=function(){return function(t,e,n){this.name=t,this.version=e,this.os=n}}();e.BrowserInfo=r;var s=function(){return function(t){this.version=t,this.name="node",this.os=process.platform}}();e.NodeInfo=s;var o=function(){return function(){this.bot=!0,this.name="bot",this.version=null,this.os=null}}();e.BotInfo=o;var i=3,a=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["vivaldi",/Vivaldi\/([0-9\.]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/Edg\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],c=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/],["Search Bot",/(nuhk)|(Googlebot)|(Yammybot)|(Openbot)|(Slurp)|(MSNBot)|(Ask Jeeves\/Teoma)|(ia_archiver)/]];function u(t){var e=""!==t&&a.reduce(function(e,n){var r=n[0];if(e)return e;var s=n[1].exec(t);return!!s&&[r,s]},!1);if(!e)return null;var s=e[0],c=e[1];if("searchbot"===s)return new o;var u=c[1]&&c[1].split(/[._]/).slice(0,3);return u?i>u.length&&(u=n(u,function(t){for(var e=[],n=0;t>n;n++)e.push("0");return e}(i-u.length))):u=[],new r(s,u.join("."),h(t))}function h(t){for(var e=0,n=c.length;n>e;e++){var r=c[e],s=r[0];if(r[1].test(t))return s}return null}function p(){return"undefined"!=typeof process&&process.version?new s(process.version.slice(1)):null}e.detect=function(t){return t?u(t):"undefined"!=typeof navigator?u(navigator.userAgent):p()},e.parseUserAgent=u,e.detectOS=h,e.getNodeVersion=p});(dr=mr)&&dr.__esModule&&Object.prototype.hasOwnProperty.call(dr,"default");var gr=mr.detect,vr=function(t,e){return(vr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function _r(t,e){function n(){this.constructor=t}vr(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function wr(t){return"function"==typeof t}var Or=!1,Er={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t);Or=t},get useDeprecatedSynchronousErrorHandling(){return Or}};function kr(t){setTimeout(function(){throw t},0)}var Sr={closed:!0,next:function(t){},error:function(t){if(Er.useDeprecatedSynchronousErrorHandling)throw t;kr(t)},complete:function(){}},xr=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function Cr(t){return null!==t&&"object"==typeof t}var Rr=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),Pr=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this._parentOrParents,r=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(var o=0;n.length>o;++o){n[o].remove(this)}if(wr(r))try{r.call(this)}catch(t){e=t instanceof Rr?Ar(t.errors):[t]}if(xr(s)){o=-1;for(var i=s.length;++o<i;){var a=s[o];if(Cr(a))try{a.unsubscribe()}catch(t){e=e||[],t instanceof Rr?e=e.concat(Ar(t.errors)):e.push(t)}}}if(e)throw new Rr(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw Error("unrecognized teardown "+e+" added to Subscription.")}var s=n._parentOrParents;if(null===s)n._parentOrParents=this;else if(s instanceof t){if(s===this)return n;n._parentOrParents=[s,this]}else{if(-1!==s.indexOf(this))return n;s.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function Ar(t){return t.reduce(function(t,e){return t.concat(e instanceof Rr?e.errors:e)},[])}var Tr=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),Nr=function(t){function e(n,r,s){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Sr;break;case 1:if(!n){o.destination=Sr;break}if("object"==typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new Dr(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new Dr(o,n,r,s)}return o}return _r(e,t),e.prototype[Tr]=function(){return this},e.create=function(t,n,r){var s=new e(t,n,r);return s.syncErrorThrowable=!1,s},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(Pr),Dr=function(t){function e(e,n,r,s){var o,i=t.call(this)||this;i._parentSubscriber=e;var a=i;return wr(n)?o=n:n&&(o=n.next,r=n.error,s=n.complete,n!==Sr&&(wr((a=Object.create(n)).unsubscribe)&&i.add(a.unsubscribe.bind(a)),a.unsubscribe=i.unsubscribe.bind(i))),i._context=a,i._next=o,i._error=r,i._complete=s,i}return _r(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;Er.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=Er.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):kr(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;kr(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};Er.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),Er.useDeprecatedSynchronousErrorHandling)throw t;kr(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!Er.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{e.call(this._context,n)}catch(e){return Er.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(kr(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(Nr);var Lr=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function Fr(){}var Br=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,s=function(t,e,n){if(t){if(t instanceof Nr)return t;if(t[Tr])return t[Tr]()}return t||e||n?new Nr(t,e,n):new Nr(Sr)}(t,e,n);if(s.add(r?r.call(s,this.source):this.source||Er.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),Er.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=!1,s.syncErrorThrown))throw s.syncErrorValue;return s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){Er.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t.destination;if(t.closed||t.isStopped)return!1;t=e&&e instanceof Nr?e:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Ir(e))(function(e,r){var s;s=n.subscribe(function(e){try{t(e)}catch(t){r(t),s&&s.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[Lr]=function(){return this},t.prototype.pipe=function(){for(var t,e=[],n=0;arguments.length>n;n++)e[n]=arguments[n];return 0===e.length?this:((t=e)?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:Fr)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Ir(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function Ir(t){if(t||(t=Promise),!t)throw Error("no Promise impl found");return t}var Mr=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),Ur=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return _r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(Pr),jr=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return _r(e,t),e}(Nr),qr=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return _r(e,t),e.prototype[Tr]=function(){return new jr(this)},e.prototype.lift=function(t){var e=new Wr(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new Mr;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),s=0;n>s;s++)r[s].next(t)},e.prototype.error=function(t){if(this.closed)throw new Mr;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),s=0;n>s;s++)r[s].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new Mr;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;e>r;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new Mr;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new Mr;return this.hasError?(t.error(this.thrownError),Pr.EMPTY):this.isStopped?(t.complete(),Pr.EMPTY):(this.observers.push(t),new Ur(this,t))},e.prototype.asObservable=function(){var t=new Br;return t.source=this,t},e.create=function(t,e){return new Wr(t,e)},e}(Br),Wr=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return _r(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):Pr.EMPTY},e}(qr),Vr=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return _r(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Mr;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(qr),$r=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return _r(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return _r(e,t),e.prototype.schedule=function(t,e){return this},e}(Pr)),Hr=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),Gr=function(t){function e(n,r){void 0===r&&(r=Hr.now);var s=t.call(this,n,function(){return e.delegate&&e.delegate!==s?e.delegate.now():r()})||this;return s.actions=[],s.active=!1,s.scheduled=void 0,s}return _r(e,t),e.prototype.schedule=function(n,r,s){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,s):t.prototype.schedule.call(this,n,r,s)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(Hr),zr=new Br(function(t){return t.complete()});function Yr(t){return t?function(t){return new Br(function(e){return t.schedule(function(){return e.complete()})})}(t):zr}function Xr(t){return t&&"function"==typeof t.schedule}var Jr=function(t){return function(e){for(var n=0,r=t.length;r>n&&!e.closed;n++)e.next(t[n]);e.complete()}};function Kr(t,e){return new Br(function(n){var r=new Pr,s=0;return r.add(e.schedule(function(){s!==t.length?(n.next(t[s++]),n.closed||r.add(this.schedule())):n.complete()})),r})}function Qr(){for(var t=[],e=0;arguments.length>e;e++)t[e]=arguments[e];var n=t[t.length-1];return Xr(n)?(t.pop(),Kr(t,n)):function(t,e){return e?Kr(t,e):new Br(Jr(t))}(t)}var Zr=new Gr($r);function ts(t){return t}var es=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}(),ns=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}();var rs=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new ss(t,this.project,this.thisArg))},t}(),ss=function(t){function e(e,n,r){var s=t.call(this,e)||this;return s.project=n,s.count=0,s.thisArg=r||s,s}return _r(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Nr),os=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return _r(e,t),e.prototype.notifyNext=function(t,e,n,r,s){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(Nr),is=function(t){function e(e,n,r){var s=t.call(this)||this;return s.parent=e,s.outerValue=n,s.outerIndex=r,s.index=0,s}return _r(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(Nr);function as(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var cs=as(),us=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function hs(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var ps=function(t){if(t&&"function"==typeof t[Lr])return r=t,function(t){var e=r[Lr]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(us(t))return Jr(t);if(hs(t))return n=t,function(t){return n.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,kr),t};if(t&&"function"==typeof t[cs])return e=t,function(t){for(var n=e[cs]();;){var r=n.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t};var e,n,r,s=Cr(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function ls(t,e,n,r,s){if(void 0===s&&(s=new is(t,n,r)),!s.closed)return e instanceof Br?e.subscribe(s):ps(e)(s)}function fs(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[Lr]}(t))return function(t,e){return new Br(function(n){var r=new Pr;return r.add(e.schedule(function(){var s=t[Lr]();r.add(s.subscribe({next:function(t){r.add(e.schedule(function(){return n.next(t)}))},error:function(t){r.add(e.schedule(function(){return n.error(t)}))},complete:function(){r.add(e.schedule(function(){return n.complete()}))}}))})),r})}(t,e);if(hs(t))return function(t,e){return new Br(function(n){var r=new Pr;return r.add(e.schedule(function(){return t.then(function(t){r.add(e.schedule(function(){n.next(t),r.add(e.schedule(function(){return n.complete()}))}))},function(t){r.add(e.schedule(function(){return n.error(t)}))})})),r})}(t,e);if(us(t))return Kr(t,e);if(function(t){return t&&"function"==typeof t[cs]}(t)||"string"==typeof t)return function(t,e){if(!t)throw Error("Iterable cannot be null");return new Br(function(n){var r,s=new Pr;return s.add(function(){r&&"function"==typeof r.return&&r.return()}),s.add(e.schedule(function(){r=t[cs](),s.add(e.schedule(function(){if(!n.closed){var t,e;try{var s=r.next();t=s.value,e=s.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}}))})),s})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function ds(t,e,n){return void 0===n&&(n=1/0),"function"==typeof e?function(r){return r.pipe(ds(function(n,r){return(s=t(n,r),o?fs(s,o):s instanceof Br?s:new Br(ps(s))).pipe(function(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new rs(t,e))}}(function(t,s){return e(n,t,r,s)}));var s,o},n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new ys(t,n))})}var ys=function(){function t(t,e){void 0===e&&(e=1/0),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new bs(t,this.project,this.concurrent))},t}(),bs=function(t){function e(e,n,r){void 0===r&&(r=1/0);var s=t.call(this,e)||this;return s.project=n,s.concurrent=r,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return _r(e,t),e.prototype._next=function(t){this.concurrent>this.active?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e,t,n)},e.prototype._innerSub=function(t,e,n){var r=new is(this,void 0,void 0);this.destination.add(r),ls(this,t,e,n,r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t,e,n,r,s){this.destination.next(e)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(os);function ms(){return void 0===(t=1)&&(t=1/0),ds(ts,t);var t}function gs(){for(var t=[],e=0;arguments.length>e;e++)t[e]=arguments[e];return ms()(Qr.apply(void 0,t))}function vs(t){return!xr(t)&&t-parseFloat(t)+1>=0}function _s(t,e){return void 0===t&&(t=0),void 0===e&&(e=Zr),vs(t)&&t>=0||(t=0),e&&"function"==typeof e.schedule||(e=Zr),new Br(function(n){return n.add(e.schedule(ws,t,{subscriber:n,counter:0,period:t})),n})}function ws(t){var e=t.subscriber,n=t.counter,r=t.period;e.next(n),this.schedule({subscriber:e,counter:n+1,period:r},r)}function Os(t,e){return function(n){return n.lift(new Es(t,e))}}var Es=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new ks(t,this.predicate,this.thisArg))},t}(),ks=function(t){function e(e,n,r){var s=t.call(this,e)||this;return s.predicate=n,s.thisArg=r,s.count=0,s}return _r(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(Nr);function Ss(t,e,n){void 0===t&&(t=0);var r=-1;return vs(e)?r=1>+e?1:+e:Xr(e)&&(n=e),Xr(n)||(n=Zr),new Br(function(e){var s=vs(t)?t:+t-n.now();return n.schedule(xs,s,{index:0,period:r,subscriber:e})})}function xs(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}var Cs=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new Rs(t,this.defaultValue))},t}(),Rs=function(t){function e(e,n){var r=t.call(this,e)||this;return r.defaultValue=n,r.isEmpty=!0,r}return _r(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(Nr);function Ps(t,e){return function(n){return n.lift(new As(t,e))}}var As=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Ts(t,this.compare,this.keySelector))},t}(),Ts=function(t){function e(e,n,r){var s=t.call(this,e)||this;return s.keySelector=r,s.hasKey=!1,"function"==typeof n&&(s.compare=n),s}return _r(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(t){return this.destination.error(t)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;r||(this.key=e,this.destination.next(t))},e}(Nr);var Ns=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new Ds(t,this.errorFactory))},t}(),Ds=function(t){function e(e,n){var r=t.call(this,e)||this;return r.errorFactory=n,r.hasValue=!1,r}return _r(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(Nr);function Ls(){return new ns}var Fs=function(){function t(t){if(this.total=t,0>this.total)throw new es}return t.prototype.call=function(t,e){return e.subscribe(new Bs(t,this.total))},t}(),Bs=function(t){function e(e,n){var r=t.call(this,e)||this;return r.total=n,r.count=0,r}return _r(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n>e||(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(Nr);function Is(t,e){var n=arguments.length>=2;return function(r){return r.pipe(t?Os(function(e,n){return t(e,n,r)}):ts,(o=1,function(t){return 0===o?Yr():t.lift(new Fs(o))}),n?function(t){return void 0===t&&(t=null),function(e){return e.lift(new Cs(t))}}(e):(void 0===(s=function(){return new ns})&&(s=Ls),function(t){return t.lift(new Ns(s))}));var s,o}}function Ms(){for(var t=[],e=0;arguments.length>e;e++)t[e]=arguments[e];var n=t[t.length-1];return Xr(n)?(t.pop(),function(e){return gs(t,e,n)}):function(e){return gs(t,e)}}function Us(t){return function(e){return e.lift(new js(t))}}var js=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new qs(t),r=ls(n,this.notifier);return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n},t}(),qs=function(t){function e(e){var n=t.call(this,e)||this;return n.seenValue=!1,n}return _r(e,t),e.prototype.notifyNext=function(t,e,n,r,s){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(os),Ws=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://builder.arduino.cc/v3/boards";v(this,t),this.BOARDS_URL=n,this.UPLOAD_NOPE="UPLOAD_NOPE",this.UPLOAD_DONE="UPLOAD_DONE",this.UPLOAD_ERROR="UPLOAD_ERROR",this.UPLOAD_IN_PROGRESS="UPLOAD_IN_PROGRESS",this.DOWNLOAD_DONE="DOWNLOAD_DONE",this.DOWNLOAD_NOPE="DOWNLOAD_NOPE",this.DOWNLOAD_ERROR="DOWNLOAD_ERROR",this.DOWNLOAD_IN_PROGRESS="DOWNLOAD_IN_PROGRESS",this.agentInfo={},this.agentFound=new Vr(null),this.channelOpen=new Vr(null),this.channelOpenStatus=this.channelOpen.pipe(Ps()),this.error=new Vr(null).pipe(Ps()),this.serialMonitorError=new Vr(null),this.appMessages=new qr,this.serialMonitorOpened=new Vr(!1),this.serialMonitorMessages=new qr,this.serialMonitorMessagesWithPort=new qr,this.uploading=new Vr({status:this.UPLOAD_NOPE}),this.uploadingDone=this.uploading.pipe(Os(function(t){return t.status===e.UPLOAD_DONE})).pipe(Is()).pipe(Us(this.uploading.pipe(Os(function(t){return t.status===e.UPLOAD_ERROR})))),this.uploadingError=this.uploading.pipe(Os(function(t){return t.status===e.UPLOAD_ERROR})).pipe(Is()).pipe(Us(this.uploadingDone)),this.uploadInProgress=this.uploading.pipe(Os(function(t){return t.status===e.UPLOAD_IN_PROGRESS})),this.devicesList=new Vr({serial:[],network:[]}),this.supportedBoards=new Vr([]),this.appMessages.subscribe(function(t){return e.handleAppMessage(t)}),this.devicesList.pipe(Os(function(t){return t.serial&&t.serial.length>0})).pipe(Is()).subscribe(function(){return e.closeAllPorts()}),this.downloading=new Vr({status:this.DOWNLOAD_NOPE}),this.downloadingDone=this.downloading.pipe(Os(function(t){return t.status===e.DOWNLOAD_DONE})).pipe(Is()).pipe(Us(this.downloading.pipe(Os(function(t){return t.status===e.DOWNLOAD_ERROR})))),this.downloadingError=this.downloading.pipe(Os(function(t){return t.status===e.DOWNLOAD_ERROR})).pipe(Is()).pipe(Us(this.downloadingDone)),this.boardPortAfterUpload=(new qr).pipe(Is()),this.uploadingPort=null}return w(t,[{key:"notifyUploadError",value:function(t){this.uploading.next({status:this.UPLOAD_ERROR,err:t})}},{key:"openChannel",value:function(t){var e=this;this.channelOpen.subscribe(function(n){n?_s(1500).pipe(Ms(0)).pipe(Us(e.channelOpen.pipe(Os(function(t){return!t})))).subscribe(t):(e.devicesList.next({serial:[],network:[]}),e.agentFound.next(!1))})}},{key:"uploadSerial",value:function(t,e,n){var r=this,s=3>=arguments.length||void 0===arguments[3]||arguments[3];this.uploadingPort=t.port,this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"Upload started"}),this.serialDevicesBeforeUpload=this.devicesList.getValue().serial,this.closeSerialMonitor(t.port),fetch("".concat(this.BOARDS_URL,"/").concat(t.board,"/compute"),{method:"POST",body:JSON.stringify({action:"upload",verbose:s,os:this.agentInfo.os})}).then(function(t){return t.json()}).then(function(s){var o=s.commandline.indexOf("{build.project_name}"),i=s.commandline.substring(o+21,o+24),a=n[i]||n.bin;i&&a||(console.log("we received a faulty ext property, defaulting to .bin"),i="bin");var c=g(g({},t),{},{commandline:s.commandline,filename:"".concat(e,".").concat(i),hex:a,data:a});r.uploadingDone.subscribe(function(){r.waitingForPortToComeUp=Ss(1e3).subscribe(function(){var t=r.devicesList.getValue().serial,e=t.find(function(t){return t.Name===r.uploadingPort});e||(e=t.find(function(t){return r.serialDevicesBeforeUpload.every(function(e){return e.Name!==t.Name})}))&&(r.uploadingPort=e.Name,r.boardPortAfterUpload.next({hasChanged:!0,newPort:r.uploadingPort})),e&&(r.waitingForPortToComeUp.unsubscribe(),r.uploadingPort=null,r.serialDevicesBeforeUpload=null,r.boardPortAfterUpload.next({hasChanged:!1}))})});var u=[].concat(P(s.files||[]),P(n.files||[]));r._upload(c,g(g({},s),{},{files:u}))})}},{key:"stopUpload",value:function(){if("function"!=typeof this.stopUploadCommand)throw Error("Stop Upload not supported on Chrome OS");this.stopUploadCommand()}},{key:"setBootloaderMode",value:function(t){var e=this;this.serialMonitorOpened.pipe(Os(function(t){return t})).pipe(Is()).subscribe(function(){Ss(1e3).subscribe(function(){return e.closeSerialMonitor(t)})}),this.openSerialMonitor(t,1200)}}],[{key:"devicesListAreEquals",value:function(t,e){return!(!t||!e||t.length!==e.length)&&t.every(function(t,n){return e[n].Name===t.Name&&e[n].IsOpen===t.IsOpen})}}]),t}(),Vs=function(){function t(e){v(this,t),this.daemonURL="".concat(e,"/v2")}return w(t,[{key:"init",value:function(){return fetch("".concat(this.daemonURL,"/pkgs/tools/installed"),{method:"HEAD"}).then(function(t){if(200!==t.status)throw Error("v2 not available");return t})}},{key:"installedTools",value:function(){return fetch("".concat(this.daemonURL,"/pkgs/tools/installed"),{method:"GET"}).then(function(t){return t.json()})}},{key:"installTool",value:function(t){return fetch("".concat(this.daemonURL,"/pkgs/tools/installed"),{method:"POST",body:JSON.stringify(t)}).then(function(t){return t.json().then(function(e){if(!t.ok){var n=g(g({},e),{},{status:t.status,statusText:t.statusText});return Promise.reject(n)}return e})})}}]),t}(),$s=gr(),Hs={HTTP:"http",HTTPS:"https"},Gs="".concat(Hs.HTTP,"://127.0.0.1"),zs="".concat(Hs.HTTPS,"://localhost"),Ys=[Gs,zs],Xs=!1,Js=0;"chrome"!==$s.name&&"firefox"!==$s.name&&(Ys=[zs,Gs]);var Ks=function(t){E(n,Ws);var e=C(n);function n(t){var r;return v(this,n),(r=e.call(this,t)).selectedProtocol=Hs.HTTP,r.socket=null,r.pluginURL=null,r.disabled=!1,r.openChannel(function(){return r.socket.emit("command","list")}),r.agentV2Found=new Vr(null),r.agentFound.subscribe(function(t){if(t){r._wsConnect();var e=new Vs(r.pluginURL);e.init().then(function(){r.v2=e,r.agentV2Found.next(r.v2)})}else r.findAgent()}),r}return w(n,[{key:"initSocket",value:function(){var t=this;this.socket.on("message",function(e){try{t.appMessages.next(JSON.parse(e))}catch(n){t.appMessages.next(e)}})}},{key:"notifyDownloadError",value:function(t){this.downloading.next({status:this.DOWNLOAD_ERROR,err:t})}},{key:"findAgent",value:function(){var t=this;this.disabled||(this.pluginURL?fetch("".concat(this.pluginURL,"/info")).then(function(e){return e.json().then(function(e){t.agentInfo=e,t.agentFound.next(!0)})}).catch(function(){return Ss(3500).subscribe(function(){t.pluginURL=null,t.findAgent()})}):this._tryPorts(Ys[0]).catch(function(){return t._tryPorts(Ys[1])}).then(function(){return t.agentFound.next(!0)}).catch(function(){return Ss(3500).subscribe(function(){return t.findAgent()})}))}},{key:"_tryPorts",value:function(t){for(var e=this,n=[],r=8991;9e3>r;r+=1)n.push(fetch("".concat(t,":").concat(r,"/info")).then(function(t){return t.json().then(function(e){return{response:t,data:e}})}).catch(function(){return Promise.resolve(!1)}));return Promise.all(n).then(function(n){return n.some(function(t){return!(!t||!t.response||200!==t.response.status)&&(e.agentInfo=t.data,-1===e.agentInfo.update_url.indexOf("downloads.arduino.cc")&&e.error.next("unofficial plugin"),0===t.response.url.indexOf(Hs.HTTPS)?e.selectedProtocol=Hs.HTTPS:e.agentInfo[e.selectedProtocol]=e.agentInfo[e.selectedProtocol].replace("localhost","127.0.0.1"),e.pluginURL=e.agentInfo[e.selectedProtocol],!0)})?fetch("https://s3.amazonaws.com/arduino-create-static/agent-metadata/agent-version.json").then(function(t){return t.json().then(function(t){return!e.agentInfo.version||0!==br(e.agentInfo.version,t.Version)&&-1===e.agentInfo.version.indexOf("dev")&&-1===e.agentInfo.version.indexOf("rc")?0===Js?e.update():3>Js?Ss(1e4).subscribe(function(){return e.update()}):(Js+=1,e.error.next("plugin version incompatible"),Promise.reject(Error("plugin version incompatible"))):e.agentInfo})}).catch(function(){return e.agentInfo}):(null===e.channelOpen.getValue()&&e.channelOpen.next(!1),Promise.reject(Error("".concat("Arduino Create Agent cannot be found"," at ").concat(t))))})}},{key:"_wsConnect",value:function(){var t=this,e=this.agentInfo[this.selectedProtocol===Hs.HTTPS?"wss":"ws"];this.socket&&(this.socket.destroy(),delete this.socket,this.socket=null),this.socket=yr(e),this.socket.on("connect",function(){Xs||(t.downloadTool("windows-drivers","latest","arduino"),t.downloadTool("bossac","1.7.0","arduino"),t.downloadTool("fwupdater","latest","arduino"),t.downloadTool("rp2040tools","latest","arduino"),Xs=!1),t.initSocket(),t.channelOpen.next(!0)}),this.socket.on("error",function(e){t.socket.disconnect(),t.error.next(e)}),this.socket.on("disconnect",function(){t.socket.disconnect(),t.channelOpen.next(!1)})}},{key:"handleAppMessage",value:function(t){t.Ports&&this.handleListMessage(t),t.D&&(this.serialMonitorMessages.next(t.D),this.serialMonitorMessagesWithPort.next(t)),t.ProgrammerStatus&&this.handleUploadMessage(t),t.DownloadStatus&&this.handleDownloadMessage(t),t.Err&&this.uploading.next({status:this.UPLOAD_ERROR,err:t.Err}),t.Error&&-1!==t.Error.indexOf("trying to close")&&this.serialMonitorOpened.next(!1)}},{key:"handleListMessage",value:function(t){var e=this.devicesList.getValue();t.Network&&!Ws.devicesListAreEquals(e.network,t.Ports)?this.devicesList.next({serial:e.serial,network:t.Ports}):t.Network||Ws.devicesListAreEquals(e.serial,t.Ports)||this.devicesList.next({serial:t.Ports,network:e.network})}},{key:"update",value:function(){var t=this;return fetch("".concat(this.agentInfo[this.selectedProtocol],"/update"),{method:"POST"}).then(function(t){return t.json()}).then(function(e){return e&&e.error&&(-1!==e.error.indexOf("proxy")||-1!==e.error.indexOf("dial tcp"))?(t.error.next("proxy error"),Error("proxy error")):Promise.reject()}).catch(function(){console.log("update plugin failed")})}},{key:"stopPlugin",value:function(){if(this.agentFound.getValue())return fetch("".concat(this.agentInfo[this.selectedProtocol],"/pause"),{method:"POST"})}},{key:"closeAllPorts",value:function(){var t=this;this.devicesList.getValue().serial.forEach(function(e){t.socket.emit("command","close ".concat(e.Name))})}},{key:"writeSerial",value:function(t,e){this.socket.emit("command","send ".concat(t," ").concat(e))}},{key:"openSerialMonitor",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9600,r=this.devicesList.getValue().serial.find(function(e){return e.Name===t});if(!r)return this.serialMonitorError.next("Can't find board at ".concat(t));this.uploading.getValue().status===this.UPLOAD_IN_PROGRESS||r.IsOpen||(this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(t){return t})))).subscribe(function(n){"Open"===n.Cmd&&e.serialMonitorOpened.next(!0),"OpenFail"===n.Cmd&&e.serialMonitorError.next("Failed to open serial monitor at ".concat(t))}),this.socket.emit("command","open ".concat(t," ").concat(n," timed")))}},{key:"closeSerialMonitor",value:function(t){var e=this,n=this.devicesList.getValue().serial.find(function(e){return e.Name===t});n&&n.IsOpen&&(this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(t){return!t})))).subscribe(function(n){"Close"===n.Cmd&&e.serialMonitorOpened.next(!1),"CloseFail"===n.Cmd&&e.serialMonitorError.next("Failed to close serial monitor at ".concat(t))}),this.socket.emit("command","close ".concat(t)))}},{key:"handleUploadMessage",value:function(t){var e=this;if("Ok"===t.Flash&&"Done"===t.ProgrammerStatus)return Ss(5e3).subscribe(function(){return e.uploading.next({status:e.UPLOAD_DONE,msg:t.Flash})});switch(t.ProgrammerStatus){case"Starting":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"Programming with: ".concat(t.Cmd)});break;case"Busy":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:t.Msg});break;case"Error":this.uploading.next({status:this.UPLOAD_ERROR,err:t.Msg});break;case"Killed":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:"terminated by user"}),this.uploading.next({status:this.UPLOAD_ERROR,err:"terminated by user"});break;case"Error 404 Not Found":this.uploading.next({status:this.UPLOAD_ERROR,err:t.Msg});break;default:this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:t.Msg})}}},{key:"handleDownloadMessage",value:function(t){switch(t.DownloadStatus){case"Pending":this.downloading.next({status:this.DOWNLOAD_IN_PROGRESS,msg:t.Msg});break;case"Success":this.downloading.next({status:this.DOWNLOAD_DONE,msg:t.Msg});break;case"Error":this.downloading.next({status:this.DOWNLOAD_ERROR,err:t.Msg});break;default:this.downloading.next({status:this.DOWNLOAD_IN_PROGRESS,msg:t.Msg})}}},{key:"daemonUpload",value:function(t){var e=this;fetch("".concat(this.pluginURL,"/upload"),{method:"POST",body:JSON.stringify(t)}).then(function(t){t.ok||e.uploading.next({status:e.UPLOAD_ERROR,err:t.statusText})}).catch(function(t){e.uploading.next({status:e.UPLOAD_ERROR,err:t})})}},{key:"_upload",value:function(t,e){var n=this,r=[];Array.isArray(e.tools)&&e.tools.forEach(function(t){n.v2?(n.downloading.next({status:n.DOWNLOAD_IN_PROGRESS}),r.push(n.v2.installTool(t).then(function(){n.downloading.next({status:n.DOWNLOAD_DONE})}))):n.downloadTool(t.name,t.version,t.packager)});var s=g(g({},t),{},{extra:g(g({},t.extra),{},{wait_for_upload_port:"true"===e.options.wait_for_upload_port||!0===e.options.wait_for_upload_port,use_1200bps_touch:"true"===e.options.use_1200bps_touch||!0===e.options.use_1200bps_touch}),extrafiles:e.files||[]});s.extra.network||(s.signature=e.signature),Promise.all(r).then(function(){n.serialMonitorOpened.pipe(Os(function(t){return!t})).pipe(Is()).subscribe(function(){n.daemonUpload(s)})}),this.downloadingError.subscribe(function(t){return n.uploading.next({status:n.UPLOAD_ERROR,err:t})})}},{key:"uploadNetwork",value:function(t,e,n){this.uploading.next({status:this.UPLOAD_IN_PROGRESS});var r=g(g({},t),{},{filename:"".concat(e,".hex"),hex:n.hex});this.daemonUpload(r)}},{key:"uploadConnector",value:function(t,e,n,r){this.uploading.next({status:this.UPLOAD_IN_PROGRESS});var s=g(g({},t),{},{commandline:r.commandline,signature:r.signature,filename:e,hex:n});this.daemonUpload(s)}},{key:"downloadTool",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"keep";this.downloading.next({status:this.DOWNLOAD_IN_PROGRESS}),this.socket.emit("command","downloadtool ".concat(t," ").concat(e," ").concat(n," ").concat(r))}},{key:"stopUploadCommand",value:function(){this.uploading.next({status:this.UPLOAD_ERROR,err:"upload stopped"}),this.socket.emit("command","killupload")}},{key:"disable",value:function(){this.disabled=!0}},{key:"enable",value:function(){this.disable=!1,this.findAgent()}}]),n}(),Qs=function(t){E(n,Ws);var e=C(n);function n(t,r){var s;return v(this,n),(s=e.call(this,t)).port=null,s.agentFound.next(!0),s.channelOpenStatus.next(!0),s.uploader=r,s._populateSupportedBoards(),s}return w(n,[{key:"_populateSupportedBoards",value:function(){var t=this.uploader.getSupportedBoards();this.appMessages.next({supportedBoards:t})}},{key:"closeSerialMonitor",value:function(){}},{key:"handleAppMessage",value:function(t){t.ports&&this.devicesList.next({serial:t.ports,network:[]}),t.supportedBoards&&(console.dir("******** BEGIN: web-serial-daemon:53 ********"),console.dir(t.supportedBoards,{depth:null,colors:!0}),console.dir("********   END: web-serial-daemon:53 ********"),this.supportedBoards.next(Object.keys(t.supportedBoards)))}},{key:"closeAllPorts",value:function(){console.log("should be closing serial ports here")}},{key:"openSerialMonitor",value:function(t){var e=this;if(!this.serialMonitorOpened.getValue()){if(!this.devicesList.getValue().serial[0])return this.serialMonitorError.next("Can't find port ".concat(t));this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(t){return t})))).subscribe(function(n){"success"===n.portOpenStatus&&e.serialMonitorOpened.next(!0),"error"===n.portOpenStatus&&e.serialMonitorError.next("Failed to open serial ".concat(t))})}}},{key:"_upload",value:function(t){var e=this;this.uploader.upload(t).then(function(){e.uploading.next({status:e.UPLOAD_DONE,msg:"Sketch uploaded"})}).catch(function(t){e.notifyUploadError(t.message)})}}]),n}(),Zs=function(t){E(n,Ws);var e=C(n);function n(t,r){var s;return v(this,n),(s=e.call(this,t)).chromeExtensionId=r,s.channel=null,s.init(),s}return w(n,[{key:"init",value:function(){var t=this;this.openChannel(function(){return t.channel.postMessage({command:"listPorts"})}),this.agentFound.pipe(Ps()).subscribe(function(e){e||t.findApp()})}},{key:"findApp",value:function(){var t=this;_s(2e3).pipe(Ms(0)).pipe(Us(this.channelOpen.pipe(Os(function(t){return t})))).subscribe(function(){return t._appConnect()})}},{key:"_appConnect",value:function(){var t=this;chrome.runtime&&(this.channel=chrome.runtime.connect(this.chromeExtensionId),this.channel.onMessage.addListener(function(e){e.version?(t.agentInfo=e,t.agentFound.next(!0),t.channelOpen.next(!0)):t.appMessages.next(e)}),this.channel.onDisconnect.addListener(function(){t.channelOpen.next(!1),t.agentFound.next(!1)}))}},{key:"handleAppMessage",value:function(t){t.ports&&this.handleListMessage(t),t.supportedBoards&&this.supportedBoards.next(t.supportedBoards),t.serialData&&this.serialMonitorMessages.next(t.serialData),t.uploadStatus&&this.handleUploadMessage(t),t.err&&this.uploading.next({status:this.UPLOAD_ERROR,err:t.Err})}},{key:"handleListMessage",value:function(t){var e=this.devicesList.getValue();Ws.devicesListAreEquals(e.serial,t.ports)||this.devicesList.next({serial:t.ports.map(function(t){return{Name:t.name,SerialNumber:t.serialNumber,IsOpen:t.isOpen,VendorID:t.vendorId,ProductID:t.productId}}),network:[]})}},{key:"closeAllPorts",value:function(){var t=this;this.devicesList.getValue().serial.forEach(function(e){t.channel.postMessage({command:"closePort",data:{name:e.Name}})})}},{key:"writeSerial",value:function(t,e){this.channel.postMessage({command:"writePort",data:{name:t,data:e}})}},{key:"openSerialMonitor",value:function(t,e){var n=this;if(!this.serialMonitorOpened.getValue()){if(!this.devicesList.getValue().serial.find(function(e){return e.Name===t}))return this.serialMonitorError.next("Can't find port ".concat(t));this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(t){return t})))).subscribe(function(e){"success"===e.portOpenStatus&&n.serialMonitorOpened.next(!0),"error"===e.portOpenStatus&&n.serialMonitorError.next("Failed to open serial ".concat(t))}),this.channel.postMessage({command:"openPort",data:{name:t,baudrate:e}})}}},{key:"closeSerialMonitor",value:function(t){var e=this;if(this.serialMonitorOpened.getValue()){if(!this.devicesList.getValue().serial.find(function(e){return e.Name===t}))return this.serialMonitorError.next("Can't find port ".concat(t));this.appMessages.pipe(Us(this.serialMonitorOpened.pipe(Os(function(t){return!t})))).subscribe(function(n){"success"===n.portCloseStatus&&e.serialMonitorOpened.next(!1),"error"===n.portCloseStatus&&e.serialMonitorError.next("Failed to close serial ".concat(t))}),this.channel.postMessage({command:"closePort",data:{name:t}})}}},{key:"handleUploadMessage",value:function(t){if(this.uploading.getValue().status===this.UPLOAD_IN_PROGRESS)switch(t.uploadStatus){case"message":this.uploading.next({status:this.UPLOAD_IN_PROGRESS,msg:t.message});break;case"error":this.uploading.next({status:this.UPLOAD_ERROR,err:t.message});break;case"success":this.uploading.next({status:this.UPLOAD_DONE,msg:t.message});break;default:this.uploading.next({status:this.UPLOAD_IN_PROGRESS})}}},{key:"_upload",value:function(t,e){var n=this,r=t.board,s=t.port,o=t.commandline,i=t.data,a=e&&e.files&&Array.isArray(e.files)?e.files:[];try{window.oauth.token().then(function(t){n.channel.postMessage({command:"upload",data:{board:r,port:s,commandline:o,data:i,token:t.token,extrafiles:a}})})}catch(t){this.uploading.next({status:this.UPLOAD_ERROR,err:"you need to be logged in on a Create site to upload by Chrome App"})}}},{key:"downloadTool",value:function(){this.downloading.next({status:this.DOWNLOAD_DONE})}}]),n}();var to=Object.freeze({GET_FIRMWARE_INFO:"5aae0c2b9cfa783ab6d791491b6ebcb7ffb69644dcc8984def2a5f69029a46701dc8c95fc38a60efebb78c2802b6d172d7f38852b44ae1d2697c0211b6ac389f574c4ff85593ccae55e7c8c415f8d07f932fc64aec620ddb925dbd97b77cf395b9929911b6d4c40b8d3d5a4720a0613fe301344a45f505a430c956a527831896b42fddd0f737d630a3dc3714ce421bd30e9229b2ed503667a915bfc696b6221759640ff492e37356ef025ba9802d578227b8f15fd0f647c395bf73a84adf7a57281c31bc743ca92c09f8eec64d428acd25ced8f8420fdbf989db3625662970d3f16693fec44a418e8c7b12e9f4e94d353e4d6f6876bd74fc543eaeba20a09dc6",UPLOAD_FIRMWARE_BOSSAC:"a965a14ec42c35a67f8d2f3f5235aaacbcc1b998b367d07a02d12992ec691f1723d00f0c3c1c64566e10823cca4947d7dd91e9ba4b28dffc112953f4ccf230adca274133f14ab3a13697c932c6c19ba05b4cd6d93141a31977ce7a53b253d761e2a503f55599a03605264d32e31c938966041709a824e64ddb0a2371e68c8d298dcd93cc8d451b8df1a7c1244e30b310fb10ec13448df3238bd0db5be0d1ec938b82b7c4f81262155c75b805700d0ff20b0404e27142014a2d74c3db677f32854dcda9052ccad9028e16cfb5151c09763e93a3a285be226dac849c519d79301962488c92723781d6a2063ee0021fa9f2c8d2dfcb7a6f01bcb4dbcd6b9f0d6322",UPLOAD_FIRMWARE_AVRDUDE:"67e99fc73b0c9359219d30c11851d728a5e5559426c0151518aa947b48af3f58de4d0997143cad18bc1a2f6ae22863baab2e8b0de6fff549185f3dc82cbcce44690e0c50a92cebf0bd4377ae85f3961330c5fda40f3a567242eb74fe3d937b1abfe8be77a9fd658eed1a765bbc264702577fdd63da8d3073dd36dcdd37dc5762b162e18c284715012c1f303c77475703a5c8ef8bfc685e1650eb26058016d771bd4f53929a51666aef70126aabda80431671eb2ba9b729ee166079abac806567b9ae63ce2801f88964250596b8450fda112ac43b868634b91cb59d91d13c286d3ec19eb4a840d3af89413d24b198e2da616cb2bbff45cc58645aa1b1d52f71bf",UPLOAD_FIRMWARE_RP2040:"422df04bfb4fc0eea4df716b3d9b075558c6094a2953795cf0f9cfdc58e97f9df80f51f8981d11e23a17fe1c220a164a87e24e1b10442cb6e06bda96737f1c30d7ef5928f4d926428a36ff4ea7d6cd379d2d755cda76f1fc9884628da519197007f9db1233401af387a6684f2a74855168f878d8c67239d99fdf7597379650cd9df6a56c430dc09ccc14fec3ceba56b9a0ab1e7b0a71cb9c9016ee3595a7d914e14d9f333a388aca31093ec77f347ceb0ed3f1d57861c7304bf53e45188ce3a976d294afd1e919496856b760dc708cb2db5cde585c44e8f023ad3ef2353edee5d172c2da936e321bbf11dec51779447534465df9c275eb391f1ada2c089ecb15"}),eo=Object.freeze({GET_FIRMWARE_INFO:"aceffd98d331df0daa5bb3308bb49a95767d77e7a1557c07a0ec544d2f41c3ec67269f01ce9a63e01f3b43e087ab8eb22b7f1d34135b6686e8ce27d4b5dc083ec8e6149df11880d32486448a71280ef3128efccbd45a84dbd7990a9420a65ee86b3822edba3554fa8e6ca11aec12d4dd99ad072285b98bfdf7b2b64f677da50feb8bddef25a36f52d7605078487d8a5d7cbdc84bfa65d510cee97b46baefea149139a9a6ed4b545346040536e33d850e6ad84c83fe605f677e2ca77439de3fa42350ce504ad9a49cf62c6751d4c2a284500d2c628cd52cd73b4c3e7ef08ae823eb8941383f9c6ff0686da532369d3b266ded8fdd33cca1a128068a4795920f25",UPLOAD_FIRMWARE_BOSSAC:"b4fca4587e784952c53ad05bff80ed0b2880be885cb3f6bd9935864863cd36d3c9c26b30b2598727b03b1b409873fa2ce0560bf1933768d5ca45c64d5f0e5032b19146cba60d8f3aa2b19ba107be0c4fa592d86e44bc87f2330fc1c9995db0cc5ec884d8f294af5cbff3a81593849465eb0e4123e9b7ddb3be74b444bed40d539e724f9a41617f2e9c70b145c4a2688d47894319fd65d660ad7d8382fb56a455e28fa78042337d55f8b5ec4f2c16f3410d15c1551973eec2a80a1792c344f7835e2133f9279009a40054bf234f7bc194f7c18d0e6c7102d13823db1ad60d81b40e3e43f89eb26a0cc5fd9759286f11ba4b649829bda8a52d0013ee59e2df3b3b",UPLOAD_FIRMWARE_AVRDUDE:"38bb99d99e00d91166ef095477b24b7a52eda0685db819486a723ee09e84ea84422b7f6c973466e97b832c5afa54a84a6d2dfad17a38f8f91059c5f62212c2a3e8a887c63b3b679eb1c4c2e76f2f4e943d8bd59a5f21283c9a3a7a9b5584c14b8adfc881315bcc605d26bfe31c9b2dfa5979d501b2333963614337668f0303ef6ddd3ec72a39b448d38c6af501a1357c6b8527f27ca8a096b7bc0413b1cb5f504d44bd502cee59444c00fae11cc59c51ae8153e4e481fb58a3ee3a7f23447aa9aa368b8cc0d0d107b77b234a7528ab10cbb5dc09de874ef2a6bd427aa2f83f99faabd54b272c7df3922fa5439e54e9d8b2793bc5ce1c5979f3f5e5db03853f53"}),no=Object.freeze({NOPE:"NOPE",OK:"OK",CHECKING:"CHECKING",ERROR:"ERROR DOWNLOADING TOOL"}),ro=to,so="FirmwareUploader";var oo,io=function(){function t(e){var n=this;v(this,t),this.updateStatusEnum=Object.freeze({NOPE:"NOPE",STARTED:"STARTED",GETTING_INFO:"GETTING_INFO",GOT_INFO:"GOT_INFO",UPLOADING:"UPLOADING",DONE:"DONE",ERROR:"ERROR"}),this.Daemon=e,this.FWUToolStatus=no.NOPE,this.Daemon.downloadingDone.subscribe(function(){n.FWUToolStatus=no.OK}),this.updating=new Vr({status:this.updateStatusEnum.NOPE}),this.updatingDone=this.updating.pipe(Os(function(t){return t.status===n.updateStatusEnum.DONE})).pipe(Is()).pipe(Us(this.updating.pipe(Os(function(t){return t.status===n.updateStatusEnum.ERROR})))),this.updatingError=this.updating.pipe(Os(function(t){return t.status===n.updateStatusEnum.ERROR})).pipe(Is()).pipe(Us(this.updatingDone)),this.gotFWInfo=this.updating.pipe(Os(function(t){return t.status===n.updateStatusEnum.GOT_INFO})).pipe(Is()).pipe(Us(this.updatingDone)).pipe(Us(this.updatingError))}return w(t,[{key:"setToolVersion",value:function(t){this.toolVersion=t,0>br(t,"0.1.2")&&(ro=eo,so="updater")}},{key:"getFirmwareInfo",value:function(t,e,n){var r=this;this.firmwareVersionData=null,this.loaderPath=null,this.updating.next({status:this.updateStatusEnum.GETTING_INFO});var s,o=[];if(this.FWUToolStatus===no.OK){s=this.Daemon.appMessages.subscribe(function(e){e.ProgrammerStatus&&function(e){var i;switch(e.ProgrammerStatus){case"Starting":break;case"Busy":if(e.Msg.indexOf("Flashing with command:")>=0)return;i=JSON.parse(e.Msg),Object.keys(i).forEach(function(t){i[t][0].IsLoader?r.loaderPath=i[t][0].Path:o=[].concat(P(o),P(i[t]))}),r.firmwareVersionData=o.find(function(t){return t.Name.split(" ").splice(-1)[0].trim()===n}),r.firmwareVersionData?(s.unsubscribe(),r.updating.next({status:r.updateStatusEnum.GOT_INFO})):r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't get firmware info: couldn't find version '".concat(n,"' for board '").concat(t,"'")});break;case"Error":r.updating.next({status:r.updateStatusEnum.ERROR,err:"Couldn't get firmware info: ".concat(e.Msg)}),s.unsubscribe()}}(e)});var i={board:t,port:e,commandline:'"{runtime.tools.fwupdater.path}/'.concat(so,'" -get_available_for {network.password}'),signature:ro.GET_FIRMWARE_INFO,extra:{auth:{password:t}},filename:"ListFirmwareVersionsInfo.bin"};return fetch("".concat(this.Daemon.pluginURL,"/upload"),{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(i)}).then(function(t){t.ok||r.updating.next({status:r.updateStatusEnum.ERROR,err:"Error fetching ".concat(r.Daemon.pluginURL,"/upload")})}).catch(function(){r.updating.next({status:r.updateStatusEnum.ERROR,err:"Coudln't list firmware versions info."})})}this.updating.next({status:this.updateStatusEnum.ERROR,err:"Can't get firmware info: couldn't find firmware updater tool"})}},{key:"updateFirmware",value:function(t,e,n){var r=this;this.updating.next({status:this.updateStatusEnum.STARTED}),this.Daemon.closeSerialMonitor(e),this.Daemon.serialMonitorOpened.pipe(Os(function(t){return!t})).pipe(Is()).subscribe(function(){e?(r.gotFWInfo.subscribe(function(){if(r.firmwareVersionData){var s;s=r.Daemon.appMessages.subscribe(function(t){t.ProgrammerStatus&&function(t){switch(t.ProgrammerStatus){case"Busy":0>t.Msg.indexOf("Operation completed: success! :-)")||(r.updating.next({status:r.updateStatusEnum.DONE}),s.unsubscribe());break;case"Error":r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: ".concat(t.Msg)}),s.unsubscribe()}}(t)});var o=R(function(t){return"uno2018"===t?["{runtime.tools.avrdude}/bin/avrdude",ro.UPLOAD_FIRMWARE_AVRDUDE]:"nanorp2040connect"===t?["{runtime.tools.rp2040tools.path}/rp2040load",ro.UPLOAD_FIRMWARE_RP2040]:["{runtime.tools.bossac}/bossac",ro.UPLOAD_FIRMWARE_BOSSAC]}(t),2),i=o[0],a=o[1];if(r.loaderPath){var c={board:t,port:e,commandline:'"{runtime.tools.fwupdater.path}/'.concat(so,'" -flasher {network.password} -port {serial.port} -programmer "').concat(i,'"'),hex:"",extra:{auth:{password:'"'.concat(r.loaderPath,'" -firmware "').concat(r.firmwareVersionData.Path,'"')}},signature:a,filename:"CheckFirmwareVersion.bin"};fetch("".concat(r.Daemon.pluginURL,"/upload"),{method:"POST",headers:{"Content-Type":"text/plain; charset=utf-8"},body:JSON.stringify(c)}).then(function(t){t.ok||r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: error fetching ".concat(r.Daemon.pluginURL,"/upload")})}).catch(function(t){r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: ".concat(t)})})}else r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: 'loaderPath' is empty or 'null'"})}else r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: couldn't find version '".concat(n,"' for board '").concat(t,"'")})}),r.getFirmwareInfo(t,e,n)):r.updating.next({status:r.updateStatusEnum.ERROR,err:"Can't update Firmware: no port selected."})})}}]),t}();-1!==window.navigator.userAgent.indexOf(" CrOS ")?(console.debug("Instantiating ChromeOsDaemon"),oo=function(t,e){var n,r,s,o=this;return"string"==typeof e?r=e:(r=e.chromeExtensionId,n=e.useWebSerial,s=e.uploader),"serial"in navigator&&n&&s?(console.debug("Instantiating WebSerialDaemon"),this.flavour=new Qs(t,s)):(console.debug("Instantiating ChromeAppDaemon"),this.flavour=new Zs(t,r)),new Proxy(this,{get:function(t,e){return o.flavour[e]},set:function(t,e,n){return o.flavour[e]=n,!0}})}):(console.debug("Instantiating SocketDaemon"),oo=Ks);var ao=oo;t.FirmwareUpdater=io,t.default=ao,Object.defineProperty(t,"__esModule",{value:!0})});
